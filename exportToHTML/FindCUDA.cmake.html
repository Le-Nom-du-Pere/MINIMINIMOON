<html>
<head>
<title>FindCUDA.cmake</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #969896;}
.s1 { color: #333333;}
.s2 { color: #a71d5d;}
.s3 { color: #183691;}
.s4 { color: #0086b3;}
.s5 { color: #795da3;}
.ln { color: #333333; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
FindCUDA.cmake</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">#.rst:</span>
<a name="l2"><span class="ln">2    </span></a><span class="s0"># FindCUDA</span>
<a name="l3"><span class="ln">3    </span></a><span class="s0"># --------</span>
<a name="l4"><span class="ln">4    </span></a><span class="s0">#</span>
<a name="l5"><span class="ln">5    </span></a><span class="s0"># .. note::</span>
<a name="l6"><span class="ln">6    </span></a><span class="s0">#</span>
<a name="l7"><span class="ln">7    </span></a><span class="s0">#   The FindCUDA module has been superseded by first-class support</span>
<a name="l8"><span class="ln">8    </span></a><span class="s0">#   for the CUDA language in CMake.  It is no longer necessary to</span>
<a name="l9"><span class="ln">9    </span></a><span class="s0">#   use this module or call ``find_package(CUDA)``.  This module</span>
<a name="l10"><span class="ln">10   </span></a><span class="s0">#   now exists only for compatibility with projects that have not</span>
<a name="l11"><span class="ln">11   </span></a><span class="s0">#   been ported.</span>
<a name="l12"><span class="ln">12   </span></a><span class="s0">#</span>
<a name="l13"><span class="ln">13   </span></a><span class="s0">#   Instead, list ``CUDA`` among the languages named in the top-level</span>
<a name="l14"><span class="ln">14   </span></a><span class="s0">#   call to the :command:`project` command, or call the</span>
<a name="l15"><span class="ln">15   </span></a><span class="s0">#   :command:`enable_language` command with ``CUDA``.</span>
<a name="l16"><span class="ln">16   </span></a><span class="s0">#   Then one can add CUDA (``.cu``) sources to programs directly</span>
<a name="l17"><span class="ln">17   </span></a><span class="s0">#   in calls to :command:`add_library` and :command:`add_executable`.</span>
<a name="l18"><span class="ln">18   </span></a><span class="s0">#</span>
<a name="l19"><span class="ln">19   </span></a><span class="s0"># Tools for building CUDA C files: libraries and build dependencies.</span>
<a name="l20"><span class="ln">20   </span></a><span class="s0">#</span>
<a name="l21"><span class="ln">21   </span></a><span class="s0"># This script locates the NVIDIA CUDA C tools.  It should work on Linux,</span>
<a name="l22"><span class="ln">22   </span></a><span class="s0"># Windows, and macOS and should be reasonably up to date with CUDA C</span>
<a name="l23"><span class="ln">23   </span></a><span class="s0"># releases.</span>
<a name="l24"><span class="ln">24   </span></a><span class="s0">#</span>
<a name="l25"><span class="ln">25   </span></a><span class="s0"># This script makes use of the standard :command:`find_package` arguments of</span>
<a name="l26"><span class="ln">26   </span></a><span class="s0"># ``&lt;VERSION&gt;``, ``REQUIRED`` and ``QUIET``.  ``CUDA_FOUND`` will report if an</span>
<a name="l27"><span class="ln">27   </span></a><span class="s0"># acceptable version of CUDA was found.</span>
<a name="l28"><span class="ln">28   </span></a><span class="s0">#</span>
<a name="l29"><span class="ln">29   </span></a><span class="s0"># The script will prompt the user to specify ``CUDA_TOOLKIT_ROOT_DIR`` if</span>
<a name="l30"><span class="ln">30   </span></a><span class="s0"># the prefix cannot be determined by the location of nvcc in the system</span>
<a name="l31"><span class="ln">31   </span></a><span class="s0"># path and ``REQUIRED`` is specified to :command:`find_package`.  To use</span>
<a name="l32"><span class="ln">32   </span></a><span class="s0"># a different installed version of the toolkit set the environment variable</span>
<a name="l33"><span class="ln">33   </span></a><span class="s0"># ``CUDA_BIN_PATH`` before running cmake (e.g.</span>
<a name="l34"><span class="ln">34   </span></a><span class="s0"># ``CUDA_BIN_PATH=/usr/local/cuda1.0`` instead of the default</span>
<a name="l35"><span class="ln">35   </span></a><span class="s0"># ``/usr/local/cuda``) or set ``CUDA_TOOLKIT_ROOT_DIR`` after configuring.  If</span>
<a name="l36"><span class="ln">36   </span></a><span class="s0"># you change the value of ``CUDA_TOOLKIT_ROOT_DIR``, various components that</span>
<a name="l37"><span class="ln">37   </span></a><span class="s0"># depend on the path will be relocated.</span>
<a name="l38"><span class="ln">38   </span></a><span class="s0">#</span>
<a name="l39"><span class="ln">39   </span></a><span class="s0"># It might be necessary to set ``CUDA_TOOLKIT_ROOT_DIR`` manually on certain</span>
<a name="l40"><span class="ln">40   </span></a><span class="s0"># platforms, or to use a CUDA runtime not installed in the default</span>
<a name="l41"><span class="ln">41   </span></a><span class="s0"># location.  In newer versions of the toolkit the CUDA library is</span>
<a name="l42"><span class="ln">42   </span></a><span class="s0"># included with the graphics driver -- be sure that the driver version</span>
<a name="l43"><span class="ln">43   </span></a><span class="s0"># matches what is needed by the CUDA runtime version.</span>
<a name="l44"><span class="ln">44   </span></a><span class="s0">#</span>
<a name="l45"><span class="ln">45   </span></a><span class="s0"># The following variables affect the behavior of the macros in the</span>
<a name="l46"><span class="ln">46   </span></a><span class="s0"># script (in alphebetical order).  Note that any of these flags can be</span>
<a name="l47"><span class="ln">47   </span></a><span class="s0"># changed multiple times in the same directory before calling</span>
<a name="l48"><span class="ln">48   </span></a><span class="s0"># ``CUDA_ADD_EXECUTABLE``, ``CUDA_ADD_LIBRARY``, ``CUDA_COMPILE``,</span>
<a name="l49"><span class="ln">49   </span></a><span class="s0"># ``CUDA_COMPILE_PTX``, ``CUDA_COMPILE_FATBIN``, ``CUDA_COMPILE_CUBIN``</span>
<a name="l50"><span class="ln">50   </span></a><span class="s0"># or ``CUDA_WRAP_SRCS``::</span>
<a name="l51"><span class="ln">51   </span></a><span class="s0">#</span>
<a name="l52"><span class="ln">52   </span></a><span class="s0">#   CUDA_64_BIT_DEVICE_CODE (Default matches host bit size)</span>
<a name="l53"><span class="ln">53   </span></a><span class="s0">#   -- Set to ON to compile for 64 bit device code, OFF for 32 bit device code.</span>
<a name="l54"><span class="ln">54   </span></a><span class="s0">#      Note that making this different from the host code when generating object</span>
<a name="l55"><span class="ln">55   </span></a><span class="s0">#      or C files from CUDA code just won't work, because size_t gets defined by</span>
<a name="l56"><span class="ln">56   </span></a><span class="s0">#      nvcc in the generated source.  If you compile to PTX and then load the</span>
<a name="l57"><span class="ln">57   </span></a><span class="s0">#      file yourself, you can mix bit sizes between device and host.</span>
<a name="l58"><span class="ln">58   </span></a><span class="s0">#</span>
<a name="l59"><span class="ln">59   </span></a><span class="s0">#   CUDA_ATTACH_VS_BUILD_RULE_TO_CUDA_FILE (Default ON)</span>
<a name="l60"><span class="ln">60   </span></a><span class="s0">#   -- Set to ON if you want the custom build rule to be attached to the source</span>
<a name="l61"><span class="ln">61   </span></a><span class="s0">#      file in Visual Studio.  Turn OFF if you add the same cuda file to multiple</span>
<a name="l62"><span class="ln">62   </span></a><span class="s0">#      targets.</span>
<a name="l63"><span class="ln">63   </span></a><span class="s0">#</span>
<a name="l64"><span class="ln">64   </span></a><span class="s0">#      This allows the user to build the target from the CUDA file; however, bad</span>
<a name="l65"><span class="ln">65   </span></a><span class="s0">#      things can happen if the CUDA source file is added to multiple targets.</span>
<a name="l66"><span class="ln">66   </span></a><span class="s0">#      When performing parallel builds it is possible for the custom build</span>
<a name="l67"><span class="ln">67   </span></a><span class="s0">#      command to be run more than once and in parallel causing cryptic build</span>
<a name="l68"><span class="ln">68   </span></a><span class="s0">#      errors.  VS runs the rules for every source file in the target, and a</span>
<a name="l69"><span class="ln">69   </span></a><span class="s0">#      source can have only one rule no matter how many projects it is added to.</span>
<a name="l70"><span class="ln">70   </span></a><span class="s0">#      When the rule is run from multiple targets race conditions can occur on</span>
<a name="l71"><span class="ln">71   </span></a><span class="s0">#      the generated file.  Eventually everything will get built, but if the user</span>
<a name="l72"><span class="ln">72   </span></a><span class="s0">#      is unaware of this behavior, there may be confusion.  It would be nice if</span>
<a name="l73"><span class="ln">73   </span></a><span class="s0">#      this script could detect the reuse of source files across multiple targets</span>
<a name="l74"><span class="ln">74   </span></a><span class="s0">#      and turn the option off for the user, but no good solution could be found.</span>
<a name="l75"><span class="ln">75   </span></a><span class="s0">#</span>
<a name="l76"><span class="ln">76   </span></a><span class="s0">#   CUDA_BUILD_CUBIN (Default OFF)</span>
<a name="l77"><span class="ln">77   </span></a><span class="s0">#   -- Set to ON to enable and extra compilation pass with the -cubin option in</span>
<a name="l78"><span class="ln">78   </span></a><span class="s0">#      Device mode. The output is parsed and register, shared memory usage is</span>
<a name="l79"><span class="ln">79   </span></a><span class="s0">#      printed during build.</span>
<a name="l80"><span class="ln">80   </span></a><span class="s0">#</span>
<a name="l81"><span class="ln">81   </span></a><span class="s0">#   CUDA_BUILD_EMULATION (Default OFF for device mode)</span>
<a name="l82"><span class="ln">82   </span></a><span class="s0">#   -- Set to ON for Emulation mode. -D_DEVICEEMU is defined for CUDA C files</span>
<a name="l83"><span class="ln">83   </span></a><span class="s0">#      when CUDA_BUILD_EMULATION is TRUE.</span>
<a name="l84"><span class="ln">84   </span></a><span class="s0">#</span>
<a name="l85"><span class="ln">85   </span></a><span class="s0">#   CUDA_LINK_LIBRARIES_KEYWORD (Default &quot;&quot;)</span>
<a name="l86"><span class="ln">86   </span></a><span class="s0">#    -- The &lt;PRIVATE|PUBLIC|INTERFACE&gt; keyword to use for internal</span>
<a name="l87"><span class="ln">87   </span></a><span class="s0">#       target_link_libraries calls. The default is to use no keyword which</span>
<a name="l88"><span class="ln">88   </span></a><span class="s0">#       uses the old &quot;plain&quot; form of target_link_libraries. Note that is matters</span>
<a name="l89"><span class="ln">89   </span></a><span class="s0">#       because whatever is used inside the FindCUDA module must also be used</span>
<a name="l90"><span class="ln">90   </span></a><span class="s0">#       outside - the two forms of target_link_libraries cannot be mixed.</span>
<a name="l91"><span class="ln">91   </span></a><span class="s0">#</span>
<a name="l92"><span class="ln">92   </span></a><span class="s0">#   CUDA_GENERATED_OUTPUT_DIR (Default CMAKE_CURRENT_BINARY_DIR)</span>
<a name="l93"><span class="ln">93   </span></a><span class="s0">#   -- Set to the path you wish to have the generated files placed.  If it is</span>
<a name="l94"><span class="ln">94   </span></a><span class="s0">#      blank output files will be placed in CMAKE_CURRENT_BINARY_DIR.</span>
<a name="l95"><span class="ln">95   </span></a><span class="s0">#      Intermediate files will always be placed in</span>
<a name="l96"><span class="ln">96   </span></a><span class="s0">#      CMAKE_CURRENT_BINARY_DIR/CMakeFiles.</span>
<a name="l97"><span class="ln">97   </span></a><span class="s0">#</span>
<a name="l98"><span class="ln">98   </span></a><span class="s0">#   CUDA_HOST_COMPILATION_CPP (Default ON)</span>
<a name="l99"><span class="ln">99   </span></a><span class="s0">#   -- Set to OFF for C compilation of host code.</span>
<a name="l100"><span class="ln">100  </span></a><span class="s0">#</span>
<a name="l101"><span class="ln">101  </span></a><span class="s0">#   CUDA_HOST_COMPILER (Default CMAKE_C_COMPILER)</span>
<a name="l102"><span class="ln">102  </span></a><span class="s0">#   -- Set the host compiler to be used by nvcc.  Ignored if -ccbin or</span>
<a name="l103"><span class="ln">103  </span></a><span class="s0">#      --compiler-bindir is already present in the CUDA_NVCC_FLAGS or</span>
<a name="l104"><span class="ln">104  </span></a><span class="s0">#      CUDA_NVCC_FLAGS_&lt;CONFIG&gt; variables.  For Visual Studio targets,</span>
<a name="l105"><span class="ln">105  </span></a><span class="s0">#      the host compiler is constructed with one or more visual studio macros</span>
<a name="l106"><span class="ln">106  </span></a><span class="s0">#      such as $(VCInstallDir), that expands out to the path when</span>
<a name="l107"><span class="ln">107  </span></a><span class="s0">#      the command is run from within VS.</span>
<a name="l108"><span class="ln">108  </span></a><span class="s0">#      If the CUDAHOSTCXX environment variable is set it will</span>
<a name="l109"><span class="ln">109  </span></a><span class="s0">#      be used as the default.</span>
<a name="l110"><span class="ln">110  </span></a><span class="s0">#</span>
<a name="l111"><span class="ln">111  </span></a><span class="s0">#   CUDA_NVCC_FLAGS</span>
<a name="l112"><span class="ln">112  </span></a><span class="s0">#   CUDA_NVCC_FLAGS_&lt;CONFIG&gt;</span>
<a name="l113"><span class="ln">113  </span></a><span class="s0">#   -- Additional NVCC command line arguments.  NOTE: multiple arguments must be</span>
<a name="l114"><span class="ln">114  </span></a><span class="s0">#      semi-colon delimited (e.g. --compiler-options;-Wall)</span>
<a name="l115"><span class="ln">115  </span></a><span class="s0">#</span>
<a name="l116"><span class="ln">116  </span></a><span class="s0">#   CUDA_PROPAGATE_HOST_FLAGS (Default ON)</span>
<a name="l117"><span class="ln">117  </span></a><span class="s0">#   -- Set to ON to propagate CMAKE_{C,CXX}_FLAGS and their configuration</span>
<a name="l118"><span class="ln">118  </span></a><span class="s0">#      dependent counterparts (e.g. CMAKE_C_FLAGS_DEBUG) automatically to the</span>
<a name="l119"><span class="ln">119  </span></a><span class="s0">#      host compiler through nvcc's -Xcompiler flag.  This helps make the</span>
<a name="l120"><span class="ln">120  </span></a><span class="s0">#      generated host code match the rest of the system better.  Sometimes</span>
<a name="l121"><span class="ln">121  </span></a><span class="s0">#      certain flags give nvcc problems, and this will help you turn the flag</span>
<a name="l122"><span class="ln">122  </span></a><span class="s0">#      propagation off.  This does not affect the flags supplied directly to nvcc</span>
<a name="l123"><span class="ln">123  </span></a><span class="s0">#      via CUDA_NVCC_FLAGS or through the OPTION flags specified through</span>
<a name="l124"><span class="ln">124  </span></a><span class="s0">#      CUDA_ADD_LIBRARY, CUDA_ADD_EXECUTABLE, or CUDA_WRAP_SRCS.  Flags used for</span>
<a name="l125"><span class="ln">125  </span></a><span class="s0">#      shared library compilation are not affected by this flag.</span>
<a name="l126"><span class="ln">126  </span></a><span class="s0">#</span>
<a name="l127"><span class="ln">127  </span></a><span class="s0">#   CUDA_PROPAGATE_HOST_FLAGS_BLACKLIST (Default &quot;&quot;)</span>
<a name="l128"><span class="ln">128  </span></a><span class="s0">#   -- A list containing the host flags that should not be propagated when</span>
<a name="l129"><span class="ln">129  </span></a><span class="s0">#      CUDA_PROPAGATE_HOST_FLAGS is ON.</span>
<a name="l130"><span class="ln">130  </span></a><span class="s0">#</span>
<a name="l131"><span class="ln">131  </span></a><span class="s0">#   CUDA_SEPARABLE_COMPILATION (Default OFF)</span>
<a name="l132"><span class="ln">132  </span></a><span class="s0">#   -- If set this will enable separable compilation for all CUDA runtime object</span>
<a name="l133"><span class="ln">133  </span></a><span class="s0">#      files.  If used outside of CUDA_ADD_EXECUTABLE and CUDA_ADD_LIBRARY</span>
<a name="l134"><span class="ln">134  </span></a><span class="s0">#      (e.g. calling CUDA_WRAP_SRCS directly),</span>
<a name="l135"><span class="ln">135  </span></a><span class="s0">#      CUDA_COMPUTE_SEPARABLE_COMPILATION_OBJECT_FILE_NAME and</span>
<a name="l136"><span class="ln">136  </span></a><span class="s0">#      CUDA_LINK_SEPARABLE_COMPILATION_OBJECTS should be called.</span>
<a name="l137"><span class="ln">137  </span></a><span class="s0">#</span>
<a name="l138"><span class="ln">138  </span></a><span class="s0">#   CUDA_SOURCE_PROPERTY_FORMAT</span>
<a name="l139"><span class="ln">139  </span></a><span class="s0">#   -- If this source file property is set, it can override the format specified</span>
<a name="l140"><span class="ln">140  </span></a><span class="s0">#      to CUDA_WRAP_SRCS (OBJ, PTX, CUBIN, or FATBIN).  If an input source file</span>
<a name="l141"><span class="ln">141  </span></a><span class="s0">#      is not a .cu file, setting this file will cause it to be treated as a .cu</span>
<a name="l142"><span class="ln">142  </span></a><span class="s0">#      file. See documentation for set_source_files_properties on how to set</span>
<a name="l143"><span class="ln">143  </span></a><span class="s0">#      this property.</span>
<a name="l144"><span class="ln">144  </span></a><span class="s0">#</span>
<a name="l145"><span class="ln">145  </span></a><span class="s0">#   CUDA_USE_STATIC_CUDA_RUNTIME (Default ON)</span>
<a name="l146"><span class="ln">146  </span></a><span class="s0">#   -- When enabled the static version of the CUDA runtime library will be used</span>
<a name="l147"><span class="ln">147  </span></a><span class="s0">#      in CUDA_LIBRARIES.  If the version of CUDA configured doesn't support</span>
<a name="l148"><span class="ln">148  </span></a><span class="s0">#      this option, then it will be silently disabled.</span>
<a name="l149"><span class="ln">149  </span></a><span class="s0">#</span>
<a name="l150"><span class="ln">150  </span></a><span class="s0">#   CUDA_VERBOSE_BUILD (Default OFF)</span>
<a name="l151"><span class="ln">151  </span></a><span class="s0">#   -- Set to ON to see all the commands used when building the CUDA file.  When</span>
<a name="l152"><span class="ln">152  </span></a><span class="s0">#      using a Makefile generator the value defaults to VERBOSE (run make</span>
<a name="l153"><span class="ln">153  </span></a><span class="s0">#      VERBOSE=1 to see output), although setting CUDA_VERBOSE_BUILD to ON will</span>
<a name="l154"><span class="ln">154  </span></a><span class="s0">#      always print the output.</span>
<a name="l155"><span class="ln">155  </span></a><span class="s0">#</span>
<a name="l156"><span class="ln">156  </span></a><span class="s0"># The script creates the following macros (in alphebetical order)::</span>
<a name="l157"><span class="ln">157  </span></a><span class="s0">#</span>
<a name="l158"><span class="ln">158  </span></a><span class="s0">#   CUDA_ADD_CUFFT_TO_TARGET( cuda_target )</span>
<a name="l159"><span class="ln">159  </span></a><span class="s0">#   -- Adds the cufft library to the target (can be any target).  Handles whether</span>
<a name="l160"><span class="ln">160  </span></a><span class="s0">#      you are in emulation mode or not.</span>
<a name="l161"><span class="ln">161  </span></a><span class="s0">#</span>
<a name="l162"><span class="ln">162  </span></a><span class="s0">#   CUDA_ADD_CUBLAS_TO_TARGET( cuda_target )</span>
<a name="l163"><span class="ln">163  </span></a><span class="s0">#   -- Adds the cublas library to the target (can be any target).  Handles</span>
<a name="l164"><span class="ln">164  </span></a><span class="s0">#      whether you are in emulation mode or not.</span>
<a name="l165"><span class="ln">165  </span></a><span class="s0">#</span>
<a name="l166"><span class="ln">166  </span></a><span class="s0">#   CUDA_ADD_EXECUTABLE( cuda_target file0 file1 ...</span>
<a name="l167"><span class="ln">167  </span></a><span class="s0">#                        [WIN32] [MACOSX_BUNDLE] [EXCLUDE_FROM_ALL] [OPTIONS ...] )</span>
<a name="l168"><span class="ln">168  </span></a><span class="s0">#   -- Creates an executable &quot;cuda_target&quot; which is made up of the files</span>
<a name="l169"><span class="ln">169  </span></a><span class="s0">#      specified.  All of the non CUDA C files are compiled using the standard</span>
<a name="l170"><span class="ln">170  </span></a><span class="s0">#      build rules specified by CMAKE and the cuda files are compiled to object</span>
<a name="l171"><span class="ln">171  </span></a><span class="s0">#      files using nvcc and the host compiler.  In addition CUDA_INCLUDE_DIRS is</span>
<a name="l172"><span class="ln">172  </span></a><span class="s0">#      added automatically to include_directories().  Some standard CMake target</span>
<a name="l173"><span class="ln">173  </span></a><span class="s0">#      calls can be used on the target after calling this macro</span>
<a name="l174"><span class="ln">174  </span></a><span class="s0">#      (e.g. set_target_properties and target_link_libraries), but setting</span>
<a name="l175"><span class="ln">175  </span></a><span class="s0">#      properties that adjust compilation flags will not affect code compiled by</span>
<a name="l176"><span class="ln">176  </span></a><span class="s0">#      nvcc.  Such flags should be modified before calling CUDA_ADD_EXECUTABLE,</span>
<a name="l177"><span class="ln">177  </span></a><span class="s0">#      CUDA_ADD_LIBRARY or CUDA_WRAP_SRCS.</span>
<a name="l178"><span class="ln">178  </span></a><span class="s0">#</span>
<a name="l179"><span class="ln">179  </span></a><span class="s0">#   CUDA_ADD_LIBRARY( cuda_target file0 file1 ...</span>
<a name="l180"><span class="ln">180  </span></a><span class="s0">#                     [STATIC | SHARED | MODULE] [EXCLUDE_FROM_ALL] [OPTIONS ...] )</span>
<a name="l181"><span class="ln">181  </span></a><span class="s0">#   -- Same as CUDA_ADD_EXECUTABLE except that a library is created.</span>
<a name="l182"><span class="ln">182  </span></a><span class="s0">#</span>
<a name="l183"><span class="ln">183  </span></a><span class="s0">#   CUDA_BUILD_CLEAN_TARGET()</span>
<a name="l184"><span class="ln">184  </span></a><span class="s0">#   -- Creates a convenience target that deletes all the dependency files</span>
<a name="l185"><span class="ln">185  </span></a><span class="s0">#      generated.  You should make clean after running this target to ensure the</span>
<a name="l186"><span class="ln">186  </span></a><span class="s0">#      dependency files get regenerated.</span>
<a name="l187"><span class="ln">187  </span></a><span class="s0">#</span>
<a name="l188"><span class="ln">188  </span></a><span class="s0">#   CUDA_COMPILE( generated_files file0 file1 ... [STATIC | SHARED | MODULE]</span>
<a name="l189"><span class="ln">189  </span></a><span class="s0">#                 [OPTIONS ...] )</span>
<a name="l190"><span class="ln">190  </span></a><span class="s0">#   -- Returns a list of generated files from the input source files to be used</span>
<a name="l191"><span class="ln">191  </span></a><span class="s0">#      with ADD_LIBRARY or ADD_EXECUTABLE.</span>
<a name="l192"><span class="ln">192  </span></a><span class="s0">#</span>
<a name="l193"><span class="ln">193  </span></a><span class="s0">#   CUDA_COMPILE_PTX( generated_files file0 file1 ... [OPTIONS ...] )</span>
<a name="l194"><span class="ln">194  </span></a><span class="s0">#   -- Returns a list of PTX files generated from the input source files.</span>
<a name="l195"><span class="ln">195  </span></a><span class="s0">#</span>
<a name="l196"><span class="ln">196  </span></a><span class="s0">#   CUDA_COMPILE_FATBIN( generated_files file0 file1 ... [OPTIONS ...] )</span>
<a name="l197"><span class="ln">197  </span></a><span class="s0">#   -- Returns a list of FATBIN files generated from the input source files.</span>
<a name="l198"><span class="ln">198  </span></a><span class="s0">#</span>
<a name="l199"><span class="ln">199  </span></a><span class="s0">#   CUDA_COMPILE_CUBIN( generated_files file0 file1 ... [OPTIONS ...] )</span>
<a name="l200"><span class="ln">200  </span></a><span class="s0">#   -- Returns a list of CUBIN files generated from the input source files.</span>
<a name="l201"><span class="ln">201  </span></a><span class="s0">#</span>
<a name="l202"><span class="ln">202  </span></a><span class="s0">#   CUDA_COMPUTE_SEPARABLE_COMPILATION_OBJECT_FILE_NAME( output_file_var</span>
<a name="l203"><span class="ln">203  </span></a><span class="s0">#                                                        cuda_target</span>
<a name="l204"><span class="ln">204  </span></a><span class="s0">#                                                        object_files )</span>
<a name="l205"><span class="ln">205  </span></a><span class="s0">#   -- Compute the name of the intermediate link file used for separable</span>
<a name="l206"><span class="ln">206  </span></a><span class="s0">#      compilation.  This file name is typically passed into</span>
<a name="l207"><span class="ln">207  </span></a><span class="s0">#      CUDA_LINK_SEPARABLE_COMPILATION_OBJECTS.  output_file_var is produced</span>
<a name="l208"><span class="ln">208  </span></a><span class="s0">#      based on cuda_target the list of objects files that need separable</span>
<a name="l209"><span class="ln">209  </span></a><span class="s0">#      compilation as specified by object_files.  If the object_files list is</span>
<a name="l210"><span class="ln">210  </span></a><span class="s0">#      empty, then output_file_var will be empty.  This function is called</span>
<a name="l211"><span class="ln">211  </span></a><span class="s0">#      automatically for CUDA_ADD_LIBRARY and CUDA_ADD_EXECUTABLE.  Note that</span>
<a name="l212"><span class="ln">212  </span></a><span class="s0">#      this is a function and not a macro.</span>
<a name="l213"><span class="ln">213  </span></a><span class="s0">#</span>
<a name="l214"><span class="ln">214  </span></a><span class="s0">#   CUDA_INCLUDE_DIRECTORIES( path0 path1 ... )</span>
<a name="l215"><span class="ln">215  </span></a><span class="s0">#   -- Sets the directories that should be passed to nvcc</span>
<a name="l216"><span class="ln">216  </span></a><span class="s0">#      (e.g. nvcc -Ipath0 -Ipath1 ... ). These paths usually contain other .cu</span>
<a name="l217"><span class="ln">217  </span></a><span class="s0">#      files.</span>
<a name="l218"><span class="ln">218  </span></a><span class="s0">#</span>
<a name="l219"><span class="ln">219  </span></a><span class="s0">#</span>
<a name="l220"><span class="ln">220  </span></a><span class="s0">#   CUDA_LINK_SEPARABLE_COMPILATION_OBJECTS( output_file_var cuda_target</span>
<a name="l221"><span class="ln">221  </span></a><span class="s0">#                                            nvcc_flags object_files)</span>
<a name="l222"><span class="ln">222  </span></a><span class="s0">#   -- Generates the link object required by separable compilation from the given</span>
<a name="l223"><span class="ln">223  </span></a><span class="s0">#      object files.  This is called automatically for CUDA_ADD_EXECUTABLE and</span>
<a name="l224"><span class="ln">224  </span></a><span class="s0">#      CUDA_ADD_LIBRARY, but can be called manually when using CUDA_WRAP_SRCS</span>
<a name="l225"><span class="ln">225  </span></a><span class="s0">#      directly.  When called from CUDA_ADD_LIBRARY or CUDA_ADD_EXECUTABLE the</span>
<a name="l226"><span class="ln">226  </span></a><span class="s0">#      nvcc_flags passed in are the same as the flags passed in via the OPTIONS</span>
<a name="l227"><span class="ln">227  </span></a><span class="s0">#      argument.  The only nvcc flag added automatically is the bitness flag as</span>
<a name="l228"><span class="ln">228  </span></a><span class="s0">#      specified by CUDA_64_BIT_DEVICE_CODE.  Note that this is a function</span>
<a name="l229"><span class="ln">229  </span></a><span class="s0">#      instead of a macro.</span>
<a name="l230"><span class="ln">230  </span></a><span class="s0">#</span>
<a name="l231"><span class="ln">231  </span></a><span class="s0">#   CUDA_SELECT_NVCC_ARCH_FLAGS(out_variable [target_CUDA_architectures])</span>
<a name="l232"><span class="ln">232  </span></a><span class="s0">#   -- Selects GPU arch flags for nvcc based on target_CUDA_architectures</span>
<a name="l233"><span class="ln">233  </span></a><span class="s0">#      target_CUDA_architectures : Auto | Common | All | LIST(ARCH_AND_PTX ...)</span>
<a name="l234"><span class="ln">234  </span></a><span class="s0">#       - &quot;Auto&quot; detects local machine GPU compute arch at runtime.</span>
<a name="l235"><span class="ln">235  </span></a><span class="s0">#       - &quot;Common&quot; and &quot;All&quot; cover common and entire subsets of architectures</span>
<a name="l236"><span class="ln">236  </span></a><span class="s0">#      ARCH_AND_PTX : NAME | NUM.NUM | NUM.NUM(NUM.NUM) | NUM.NUM+PTX</span>
<a name="l237"><span class="ln">237  </span></a><span class="s0">#      NAME: Kepler Maxwell Kepler+Tesla Maxwell+Tegra Pascal Volta Turing</span>
<a name="l238"><span class="ln">238  </span></a><span class="s0">#      NUM: Any number. Only those pairs are currently accepted by NVCC though:</span>
<a name="l239"><span class="ln">239  </span></a><span class="s0">#            3.5 3.7 5.0 5.2 5.3 6.0 6.1 6.2 7.0 7.2 7.5</span>
<a name="l240"><span class="ln">240  </span></a><span class="s0">#      Returns LIST of flags to be added to CUDA_NVCC_FLAGS in ${out_variable}</span>
<a name="l241"><span class="ln">241  </span></a><span class="s0">#      Additionally, sets ${out_variable}_readable to the resulting numeric list</span>
<a name="l242"><span class="ln">242  </span></a><span class="s0">#      Example:</span>
<a name="l243"><span class="ln">243  </span></a><span class="s0">#       CUDA_SELECT_NVCC_ARCH_FLAGS(ARCH_FLAGS 3.0 3.5+PTX 5.2(5.0) Maxwell)</span>
<a name="l244"><span class="ln">244  </span></a><span class="s0">#        LIST(APPEND CUDA_NVCC_FLAGS ${ARCH_FLAGS})</span>
<a name="l245"><span class="ln">245  </span></a><span class="s0">#</span>
<a name="l246"><span class="ln">246  </span></a><span class="s0">#      More info on CUDA architectures: https://en.wikipedia.org/wiki/CUDA</span>
<a name="l247"><span class="ln">247  </span></a><span class="s0">#      Note that this is a function instead of a macro.</span>
<a name="l248"><span class="ln">248  </span></a><span class="s0">#</span>
<a name="l249"><span class="ln">249  </span></a><span class="s0">#   CUDA_WRAP_SRCS ( cuda_target format generated_files file0 file1 ...</span>
<a name="l250"><span class="ln">250  </span></a><span class="s0">#                    [STATIC | SHARED | MODULE] [OPTIONS ...] )</span>
<a name="l251"><span class="ln">251  </span></a><span class="s0">#   -- This is where all the magic happens.  CUDA_ADD_EXECUTABLE,</span>
<a name="l252"><span class="ln">252  </span></a><span class="s0">#      CUDA_ADD_LIBRARY, CUDA_COMPILE, and CUDA_COMPILE_PTX all call this</span>
<a name="l253"><span class="ln">253  </span></a><span class="s0">#      function under the hood.</span>
<a name="l254"><span class="ln">254  </span></a><span class="s0">#</span>
<a name="l255"><span class="ln">255  </span></a><span class="s0">#      Given the list of files (file0 file1 ... fileN) this macro generates</span>
<a name="l256"><span class="ln">256  </span></a><span class="s0">#      custom commands that generate either PTX or linkable objects (use &quot;PTX&quot; or</span>
<a name="l257"><span class="ln">257  </span></a><span class="s0">#      &quot;OBJ&quot; for the format argument to switch).  Files that don't end with .cu</span>
<a name="l258"><span class="ln">258  </span></a><span class="s0">#      or have the HEADER_FILE_ONLY property are ignored.</span>
<a name="l259"><span class="ln">259  </span></a><span class="s0">#</span>
<a name="l260"><span class="ln">260  </span></a><span class="s0">#      The arguments passed in after OPTIONS are extra command line options to</span>
<a name="l261"><span class="ln">261  </span></a><span class="s0">#      give to nvcc.  You can also specify per configuration options by</span>
<a name="l262"><span class="ln">262  </span></a><span class="s0">#      specifying the name of the configuration followed by the options.  General</span>
<a name="l263"><span class="ln">263  </span></a><span class="s0">#      options must precede configuration specific options.  Not all</span>
<a name="l264"><span class="ln">264  </span></a><span class="s0">#      configurations need to be specified, only the ones provided will be used.</span>
<a name="l265"><span class="ln">265  </span></a><span class="s0">#</span>
<a name="l266"><span class="ln">266  </span></a><span class="s0">#         OPTIONS -DFLAG=2 &quot;-DFLAG_OTHER=space in flag&quot;</span>
<a name="l267"><span class="ln">267  </span></a><span class="s0">#         DEBUG -g</span>
<a name="l268"><span class="ln">268  </span></a><span class="s0">#         RELEASE --use_fast_math</span>
<a name="l269"><span class="ln">269  </span></a><span class="s0">#         RELWITHDEBINFO --use_fast_math;-g</span>
<a name="l270"><span class="ln">270  </span></a><span class="s0">#         MINSIZEREL --use_fast_math</span>
<a name="l271"><span class="ln">271  </span></a><span class="s0">#</span>
<a name="l272"><span class="ln">272  </span></a><span class="s0">#      For certain configurations (namely VS generating object files with</span>
<a name="l273"><span class="ln">273  </span></a><span class="s0">#      CUDA_ATTACH_VS_BUILD_RULE_TO_CUDA_FILE set to ON), no generated file will</span>
<a name="l274"><span class="ln">274  </span></a><span class="s0">#      be produced for the given cuda file.  This is because when you add the</span>
<a name="l275"><span class="ln">275  </span></a><span class="s0">#      cuda file to Visual Studio it knows that this file produces an object file</span>
<a name="l276"><span class="ln">276  </span></a><span class="s0">#      and will link in the resulting object file automatically.</span>
<a name="l277"><span class="ln">277  </span></a><span class="s0">#</span>
<a name="l278"><span class="ln">278  </span></a><span class="s0">#      This script will also generate a separate cmake script that is used at</span>
<a name="l279"><span class="ln">279  </span></a><span class="s0">#      build time to invoke nvcc.  This is for several reasons.</span>
<a name="l280"><span class="ln">280  </span></a><span class="s0">#</span>
<a name="l281"><span class="ln">281  </span></a><span class="s0">#        1. nvcc can return negative numbers as return values which confuses</span>
<a name="l282"><span class="ln">282  </span></a><span class="s0">#        Visual Studio into thinking that the command succeeded.  The script now</span>
<a name="l283"><span class="ln">283  </span></a><span class="s0">#        checks the error codes and produces errors when there was a problem.</span>
<a name="l284"><span class="ln">284  </span></a><span class="s0">#</span>
<a name="l285"><span class="ln">285  </span></a><span class="s0">#        2. nvcc has been known to not delete incomplete results when it</span>
<a name="l286"><span class="ln">286  </span></a><span class="s0">#        encounters problems.  This confuses build systems into thinking the</span>
<a name="l287"><span class="ln">287  </span></a><span class="s0">#        target was generated when in fact an unusable file exists.  The script</span>
<a name="l288"><span class="ln">288  </span></a><span class="s0">#        now deletes the output files if there was an error.</span>
<a name="l289"><span class="ln">289  </span></a><span class="s0">#</span>
<a name="l290"><span class="ln">290  </span></a><span class="s0">#        3. By putting all the options that affect the build into a file and then</span>
<a name="l291"><span class="ln">291  </span></a><span class="s0">#        make the build rule dependent on the file, the output files will be</span>
<a name="l292"><span class="ln">292  </span></a><span class="s0">#        regenerated when the options change.</span>
<a name="l293"><span class="ln">293  </span></a><span class="s0">#</span>
<a name="l294"><span class="ln">294  </span></a><span class="s0">#      This script also looks at optional arguments STATIC, SHARED, or MODULE to</span>
<a name="l295"><span class="ln">295  </span></a><span class="s0">#      determine when to target the object compilation for a shared library.</span>
<a name="l296"><span class="ln">296  </span></a><span class="s0">#      BUILD_SHARED_LIBS is ignored in CUDA_WRAP_SRCS, but it is respected in</span>
<a name="l297"><span class="ln">297  </span></a><span class="s0">#      CUDA_ADD_LIBRARY.  On some systems special flags are added for building</span>
<a name="l298"><span class="ln">298  </span></a><span class="s0">#      objects intended for shared libraries.  A preprocessor macro,</span>
<a name="l299"><span class="ln">299  </span></a><span class="s0">#      &lt;target_name&gt;_EXPORTS is defined when a shared library compilation is</span>
<a name="l300"><span class="ln">300  </span></a><span class="s0">#      detected.</span>
<a name="l301"><span class="ln">301  </span></a><span class="s0">#</span>
<a name="l302"><span class="ln">302  </span></a><span class="s0">#      Flags passed into add_definitions with -D or /D are passed along to nvcc.</span>
<a name="l303"><span class="ln">303  </span></a><span class="s0">#</span>
<a name="l304"><span class="ln">304  </span></a><span class="s0">#</span>
<a name="l305"><span class="ln">305  </span></a><span class="s0">#</span>
<a name="l306"><span class="ln">306  </span></a><span class="s0"># The script defines the following variables::</span>
<a name="l307"><span class="ln">307  </span></a><span class="s0">#</span>
<a name="l308"><span class="ln">308  </span></a><span class="s0">#   CUDA_VERSION_MAJOR    -- The major version of cuda as reported by nvcc.</span>
<a name="l309"><span class="ln">309  </span></a><span class="s0">#   CUDA_VERSION_MINOR    -- The minor version.</span>
<a name="l310"><span class="ln">310  </span></a><span class="s0">#   CUDA_VERSION</span>
<a name="l311"><span class="ln">311  </span></a><span class="s0">#   CUDA_VERSION_STRING   -- CUDA_VERSION_MAJOR.CUDA_VERSION_MINOR</span>
<a name="l312"><span class="ln">312  </span></a><span class="s0">#   CUDA_HAS_FP16         -- Whether a short float (float16,fp16) is supported.</span>
<a name="l313"><span class="ln">313  </span></a><span class="s0">#</span>
<a name="l314"><span class="ln">314  </span></a><span class="s0">#   CUDA_TOOLKIT_ROOT_DIR -- Path to the CUDA Toolkit (defined if not set).</span>
<a name="l315"><span class="ln">315  </span></a><span class="s0">#   CUDA_SDK_ROOT_DIR     -- Path to the CUDA SDK.  Use this to find files in the</span>
<a name="l316"><span class="ln">316  </span></a><span class="s0">#                            SDK.  This script will not directly support finding</span>
<a name="l317"><span class="ln">317  </span></a><span class="s0">#                            specific libraries or headers, as that isn't</span>
<a name="l318"><span class="ln">318  </span></a><span class="s0">#                            supported by NVIDIA.  If you want to change</span>
<a name="l319"><span class="ln">319  </span></a><span class="s0">#                            libraries when the path changes see the</span>
<a name="l320"><span class="ln">320  </span></a><span class="s0">#                            FindCUDA.cmake script for an example of how to clear</span>
<a name="l321"><span class="ln">321  </span></a><span class="s0">#                            these variables.  There are also examples of how to</span>
<a name="l322"><span class="ln">322  </span></a><span class="s0">#                            use the CUDA_SDK_ROOT_DIR to locate headers or</span>
<a name="l323"><span class="ln">323  </span></a><span class="s0">#                            libraries, if you so choose (at your own risk).</span>
<a name="l324"><span class="ln">324  </span></a><span class="s0">#   CUDA_INCLUDE_DIRS     -- Include directory for cuda headers.  Added automatically</span>
<a name="l325"><span class="ln">325  </span></a><span class="s0">#                            for CUDA_ADD_EXECUTABLE and CUDA_ADD_LIBRARY.</span>
<a name="l326"><span class="ln">326  </span></a><span class="s0">#   CUDA_LIBRARIES        -- Cuda RT library.</span>
<a name="l327"><span class="ln">327  </span></a><span class="s0">#   CUDA_CUFFT_LIBRARIES  -- Device or emulation library for the Cuda FFT</span>
<a name="l328"><span class="ln">328  </span></a><span class="s0">#                            implementation (alternative to:</span>
<a name="l329"><span class="ln">329  </span></a><span class="s0">#                            CUDA_ADD_CUFFT_TO_TARGET macro)</span>
<a name="l330"><span class="ln">330  </span></a><span class="s0">#   CUDA_CUBLAS_LIBRARIES -- Device or emulation library for the Cuda BLAS</span>
<a name="l331"><span class="ln">331  </span></a><span class="s0">#                            implementation (alternative to:</span>
<a name="l332"><span class="ln">332  </span></a><span class="s0">#                            CUDA_ADD_CUBLAS_TO_TARGET macro).</span>
<a name="l333"><span class="ln">333  </span></a><span class="s0">#   CUDA_cudart_static_LIBRARY -- Statically linkable cuda runtime library.</span>
<a name="l334"><span class="ln">334  </span></a><span class="s0">#                                 Only available for CUDA version 5.5+</span>
<a name="l335"><span class="ln">335  </span></a><span class="s0">#   CUDA_cudadevrt_LIBRARY -- Device runtime library.</span>
<a name="l336"><span class="ln">336  </span></a><span class="s0">#                             Required for separable compilation.</span>
<a name="l337"><span class="ln">337  </span></a><span class="s0">#   CUDA_cupti_LIBRARY    -- CUDA Profiling Tools Interface library.</span>
<a name="l338"><span class="ln">338  </span></a><span class="s0">#                            Only available for CUDA version 4.0+.</span>
<a name="l339"><span class="ln">339  </span></a><span class="s0">#   CUDA_curand_LIBRARY   -- CUDA Random Number Generation library.</span>
<a name="l340"><span class="ln">340  </span></a><span class="s0">#                            Only available for CUDA version 3.2+.</span>
<a name="l341"><span class="ln">341  </span></a><span class="s0">#   CUDA_cusolver_LIBRARY -- CUDA Direct Solver library.</span>
<a name="l342"><span class="ln">342  </span></a><span class="s0">#                            Only available for CUDA version 7.0+.</span>
<a name="l343"><span class="ln">343  </span></a><span class="s0">#   CUDA_cusparse_LIBRARY -- CUDA Sparse Matrix library.</span>
<a name="l344"><span class="ln">344  </span></a><span class="s0">#                            Only available for CUDA version 3.2+.</span>
<a name="l345"><span class="ln">345  </span></a><span class="s0">#   CUDA_npp_LIBRARY      -- NVIDIA Performance Primitives lib.</span>
<a name="l346"><span class="ln">346  </span></a><span class="s0">#                            Only available for CUDA version 4.0+.</span>
<a name="l347"><span class="ln">347  </span></a><span class="s0">#   CUDA_nppc_LIBRARY     -- NVIDIA Performance Primitives lib (core).</span>
<a name="l348"><span class="ln">348  </span></a><span class="s0">#                            Only available for CUDA version 5.5+.</span>
<a name="l349"><span class="ln">349  </span></a><span class="s0">#   CUDA_nppi_LIBRARY     -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l350"><span class="ln">350  </span></a><span class="s0">#                            Only available for CUDA version 5.5 - 8.0.</span>
<a name="l351"><span class="ln">351  </span></a><span class="s0">#   CUDA_nppial_LIBRARY   -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l352"><span class="ln">352  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l353"><span class="ln">353  </span></a><span class="s0">#   CUDA_nppicc_LIBRARY   -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l354"><span class="ln">354  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l355"><span class="ln">355  </span></a><span class="s0">#   CUDA_nppicom_LIBRARY  -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l356"><span class="ln">356  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l357"><span class="ln">357  </span></a><span class="s0">#   CUDA_nppidei_LIBRARY  -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l358"><span class="ln">358  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l359"><span class="ln">359  </span></a><span class="s0">#   CUDA_nppif_LIBRARY    -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l360"><span class="ln">360  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l361"><span class="ln">361  </span></a><span class="s0">#   CUDA_nppig_LIBRARY    -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l362"><span class="ln">362  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l363"><span class="ln">363  </span></a><span class="s0">#   CUDA_nppim_LIBRARY    -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l364"><span class="ln">364  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l365"><span class="ln">365  </span></a><span class="s0">#   CUDA_nppist_LIBRARY   -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l366"><span class="ln">366  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l367"><span class="ln">367  </span></a><span class="s0">#   CUDA_nppisu_LIBRARY   -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l368"><span class="ln">368  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l369"><span class="ln">369  </span></a><span class="s0">#   CUDA_nppitc_LIBRARY   -- NVIDIA Performance Primitives lib (image processing).</span>
<a name="l370"><span class="ln">370  </span></a><span class="s0">#                            Only available for CUDA version 9.0.</span>
<a name="l371"><span class="ln">371  </span></a><span class="s0">#   CUDA_npps_LIBRARY     -- NVIDIA Performance Primitives lib (signal processing).</span>
<a name="l372"><span class="ln">372  </span></a><span class="s0">#                            Only available for CUDA version 5.5+.</span>
<a name="l373"><span class="ln">373  </span></a><span class="s0">#   CUDA_nvcuvenc_LIBRARY -- CUDA Video Encoder library.</span>
<a name="l374"><span class="ln">374  </span></a><span class="s0">#                            Only available for CUDA version 3.2+.</span>
<a name="l375"><span class="ln">375  </span></a><span class="s0">#                            Windows only.</span>
<a name="l376"><span class="ln">376  </span></a><span class="s0">#   CUDA_nvcuvid_LIBRARY  -- CUDA Video Decoder library.</span>
<a name="l377"><span class="ln">377  </span></a><span class="s0">#                            Only available for CUDA version 3.2+.</span>
<a name="l378"><span class="ln">378  </span></a><span class="s0">#                            Windows only.</span>
<a name="l379"><span class="ln">379  </span></a><span class="s0">#</span>
<a name="l380"><span class="ln">380  </span></a>
<a name="l381"><span class="ln">381  </span></a><span class="s0">#   James Bigler, NVIDIA Corp (nvidia.com - jbigler)</span>
<a name="l382"><span class="ln">382  </span></a><span class="s0">#   Abe Stephens, SCI Institute -- http://www.sci.utah.edu/~abe/FindCuda.html</span>
<a name="l383"><span class="ln">383  </span></a><span class="s0">#</span>
<a name="l384"><span class="ln">384  </span></a><span class="s0">#   Copyright (c) 2008 - 2009 NVIDIA Corporation.  All rights reserved.</span>
<a name="l385"><span class="ln">385  </span></a><span class="s0">#</span>
<a name="l386"><span class="ln">386  </span></a><span class="s0">#   Copyright (c) 2007-2009</span>
<a name="l387"><span class="ln">387  </span></a><span class="s0">#   Scientific Computing and Imaging Institute, University of Utah</span>
<a name="l388"><span class="ln">388  </span></a><span class="s0">#</span>
<a name="l389"><span class="ln">389  </span></a><span class="s0">#   This code is licensed under the MIT License.  See the FindCUDA.cmake script</span>
<a name="l390"><span class="ln">390  </span></a><span class="s0">#   for the text of the license.</span>
<a name="l391"><span class="ln">391  </span></a>
<a name="l392"><span class="ln">392  </span></a><span class="s0"># The MIT License</span>
<a name="l393"><span class="ln">393  </span></a><span class="s0">#</span>
<a name="l394"><span class="ln">394  </span></a><span class="s0"># License for the specific language governing rights and limitations under</span>
<a name="l395"><span class="ln">395  </span></a><span class="s0"># Permission is hereby granted, free of charge, to any person obtaining a</span>
<a name="l396"><span class="ln">396  </span></a><span class="s0"># copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<a name="l397"><span class="ln">397  </span></a><span class="s0"># to deal in the Software without restriction, including without limitation</span>
<a name="l398"><span class="ln">398  </span></a><span class="s0"># the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<a name="l399"><span class="ln">399  </span></a><span class="s0"># and/or sell copies of the Software, and to permit persons to whom the</span>
<a name="l400"><span class="ln">400  </span></a><span class="s0"># Software is furnished to do so, subject to the following conditions:</span>
<a name="l401"><span class="ln">401  </span></a><span class="s0">#</span>
<a name="l402"><span class="ln">402  </span></a><span class="s0"># The above copyright notice and this permission notice shall be included</span>
<a name="l403"><span class="ln">403  </span></a><span class="s0"># in all copies or substantial portions of the Software.</span>
<a name="l404"><span class="ln">404  </span></a><span class="s0">#</span>
<a name="l405"><span class="ln">405  </span></a><span class="s0"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<a name="l406"><span class="ln">406  </span></a><span class="s0"># OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<a name="l407"><span class="ln">407  </span></a><span class="s0"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</span>
<a name="l408"><span class="ln">408  </span></a><span class="s0"># THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<a name="l409"><span class="ln">409  </span></a><span class="s0"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<a name="l410"><span class="ln">410  </span></a><span class="s0"># FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<a name="l411"><span class="ln">411  </span></a><span class="s0"># DEALINGS IN THE SOFTWARE.</span>
<a name="l412"><span class="ln">412  </span></a><span class="s0">#</span>
<a name="l413"><span class="ln">413  </span></a><span class="s0">###############################################################################</span>
<a name="l414"><span class="ln">414  </span></a>
<a name="l415"><span class="ln">415  </span></a><span class="s0"># FindCUDA.cmake</span>
<a name="l416"><span class="ln">416  </span></a>
<a name="l417"><span class="ln">417  </span></a><span class="s0"># This macro helps us find the location of helper files we will need the full path to</span>
<a name="l418"><span class="ln">418  </span></a><span class="s2">macro</span><span class="s1">(CUDA_FIND_HELPER_FILE _name _extension) 
<a name="l419"><span class="ln">419  </span></a>  </span><span class="s2">set</span><span class="s1">(_full_name </span><span class="s3">&quot;${_name}.${_extension}&quot;</span><span class="s1">) 
<a name="l420"><span class="ln">420  </span></a>  </span><span class="s0"># CMAKE_CURRENT_LIST_FILE contains the full path to the file currently being</span>
<a name="l421"><span class="ln">421  </span></a>  <span class="s0"># processed.  Using this variable, we can pull out the current path, and</span>
<a name="l422"><span class="ln">422  </span></a>  <span class="s0"># provide a way to get access to the other files we need local to here.</span>
<a name="l423"><span class="ln">423  </span></a>  <span class="s2">get_filename_component</span><span class="s1">(</span><span class="s4">CMAKE_CURRENT_LIST_DIR </span><span class="s3">&quot;${CMAKE_CURRENT_LIST_FILE}&quot; </span><span class="s2">PATH</span><span class="s1">) 
<a name="l424"><span class="ln">424  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_</span><span class="s2">${_name} </span><span class="s3">&quot;${CMAKE_CURRENT_LIST_DIR}/FindCUDA/${_full_name}&quot;</span><span class="s1">) 
<a name="l425"><span class="ln">425  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s2">NOT EXISTS </span><span class="s3">&quot;${CUDA_${_name}}&quot;</span><span class="s1">) 
<a name="l426"><span class="ln">426  </span></a>    </span><span class="s2">set</span><span class="s1">(error_message </span><span class="s3">&quot;${_full_name} not found in ${CMAKE_CURRENT_LIST_DIR}/FindCUDA&quot;</span><span class="s1">) 
<a name="l427"><span class="ln">427  </span></a>    </span><span class="s2">if</span><span class="s1">(CUDA_FIND_REQUIRED) 
<a name="l428"><span class="ln">428  </span></a>      </span><span class="s2">message</span><span class="s1">(FATAL_ERROR </span><span class="s3">&quot;${error_message}&quot;</span><span class="s1">) 
<a name="l429"><span class="ln">429  </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l430"><span class="ln">430  </span></a>      </span><span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s1">CUDA_FIND_QUIETLY) 
<a name="l431"><span class="ln">431  </span></a>        </span><span class="s2">message</span><span class="s1">(STATUS </span><span class="s3">&quot;${error_message}&quot;</span><span class="s1">) 
<a name="l432"><span class="ln">432  </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l433"><span class="ln">433  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l434"><span class="ln">434  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l435"><span class="ln">435  </span></a>  </span><span class="s0"># Set this variable as internal, so the user isn't bugged with it.</span>
<a name="l436"><span class="ln">436  </span></a>  <span class="s2">set</span><span class="s1">(CUDA_</span><span class="s2">${_name} </span><span class="s1">${CUDA_</span><span class="s2">${_name}</span><span class="s1">} </span><span class="s2">CACHE INTERNAL </span><span class="s3">&quot;Location of ${_full_name}&quot; </span><span class="s1">FORCE) 
<a name="l437"><span class="ln">437  </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l438"><span class="ln">438  </span></a></span>
<a name="l439"><span class="ln">439  </span></a><span class="s0">#####################################################################</span>
<a name="l440"><span class="ln">440  </span></a><span class="s0">## CUDA_INCLUDE_NVCC_DEPENDENCIES</span>
<a name="l441"><span class="ln">441  </span></a><span class="s0">##</span>
<a name="l442"><span class="ln">442  </span></a>
<a name="l443"><span class="ln">443  </span></a><span class="s0"># So we want to try and include the dependency file if it exists.  If</span>
<a name="l444"><span class="ln">444  </span></a><span class="s0"># it doesn't exist then we need to create an empty one, so we can</span>
<a name="l445"><span class="ln">445  </span></a><span class="s0"># include it.</span>
<a name="l446"><span class="ln">446  </span></a>
<a name="l447"><span class="ln">447  </span></a><span class="s0"># If it does exist, then we need to check to see if all the files it</span>
<a name="l448"><span class="ln">448  </span></a><span class="s0"># depends on exist.  If they don't then we should clear the dependency</span>
<a name="l449"><span class="ln">449  </span></a><span class="s0"># file and regenerate it later.  This covers the case where a header</span>
<a name="l450"><span class="ln">450  </span></a><span class="s0"># file has disappeared or moved.</span>
<a name="l451"><span class="ln">451  </span></a>
<a name="l452"><span class="ln">452  </span></a><span class="s2">macro</span><span class="s1">(CUDA_INCLUDE_NVCC_DEPENDENCIES dependency_file) 
<a name="l453"><span class="ln">453  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_NVCC_DEPEND) 
<a name="l454"><span class="ln">454  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_NVCC_DEPEND_REGENERATE </span><span class="s2">FALSE</span><span class="s1">) 
<a name="l455"><span class="ln">455  </span></a></span>
<a name="l456"><span class="ln">456  </span></a>
<a name="l457"><span class="ln">457  </span></a>  <span class="s0"># Include the dependency file.  Create it first if it doesn't exist .  The</span>
<a name="l458"><span class="ln">458  </span></a>  <span class="s0"># INCLUDE puts a dependency that will force CMake to rerun and bring in the</span>
<a name="l459"><span class="ln">459  </span></a>  <span class="s0"># new info when it changes.  DO NOT REMOVE THIS (as I did and spent a few</span>
<a name="l460"><span class="ln">460  </span></a>  <span class="s0"># hours figuring out why it didn't work.</span>
<a name="l461"><span class="ln">461  </span></a>  <span class="s2">if</span><span class="s1">(</span><span class="s2">NOT EXISTS ${dependency_file}</span><span class="s1">) 
<a name="l462"><span class="ln">462  </span></a>    </span><span class="s2">file</span><span class="s1">(WRITE </span><span class="s2">${dependency_file} </span><span class="s3">&quot;#FindCUDA.cmake generated file.  Do not edit.\n&quot;</span><span class="s1">) 
<a name="l463"><span class="ln">463  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l464"><span class="ln">464  </span></a>  </span><span class="s0"># Always include this file to force CMake to run again next</span>
<a name="l465"><span class="ln">465  </span></a>  <span class="s0"># invocation and rebuild the dependencies.</span>
<a name="l466"><span class="ln">466  </span></a>  <span class="s0">#message(&quot;including dependency_file = ${dependency_file}&quot;)</span>
<a name="l467"><span class="ln">467  </span></a>  <span class="s2">include</span><span class="s1">(</span><span class="s2">${dependency_file}</span><span class="s1">) 
<a name="l468"><span class="ln">468  </span></a></span>
<a name="l469"><span class="ln">469  </span></a>  <span class="s0"># Now we need to verify the existence of all the included files</span>
<a name="l470"><span class="ln">470  </span></a>  <span class="s0"># here.  If they aren't there we need to just blank this variable and</span>
<a name="l471"><span class="ln">471  </span></a>  <span class="s0"># make the file regenerate again.</span>
<a name="l472"><span class="ln">472  </span></a><span class="s0">#   if(DEFINED CUDA_NVCC_DEPEND)</span>
<a name="l473"><span class="ln">473  </span></a><span class="s0">#     message(&quot;CUDA_NVCC_DEPEND set&quot;)</span>
<a name="l474"><span class="ln">474  </span></a><span class="s0">#   else()</span>
<a name="l475"><span class="ln">475  </span></a><span class="s0">#     message(&quot;CUDA_NVCC_DEPEND NOT set&quot;)</span>
<a name="l476"><span class="ln">476  </span></a><span class="s0">#   endif()</span>
<a name="l477"><span class="ln">477  </span></a>  <span class="s2">if</span><span class="s1">(CUDA_NVCC_DEPEND) 
<a name="l478"><span class="ln">478  </span></a>    </span><span class="s0">#message(&quot;CUDA_NVCC_DEPEND found&quot;)</span>
<a name="l479"><span class="ln">479  </span></a>    <span class="s2">foreach</span><span class="s1">(f </span><span class="s2">${CUDA_NVCC_DEPEND}</span><span class="s1">) 
<a name="l480"><span class="ln">480  </span></a>      </span><span class="s0"># message(&quot;searching for ${f}&quot;)</span>
<a name="l481"><span class="ln">481  </span></a>      <span class="s2">if</span><span class="s1">(</span><span class="s2">NOT EXISTS ${f}</span><span class="s1">) 
<a name="l482"><span class="ln">482  </span></a>        </span><span class="s0">#message(&quot;file ${f} not found&quot;)</span>
<a name="l483"><span class="ln">483  </span></a>        <span class="s2">set</span><span class="s1">(CUDA_NVCC_DEPEND_REGENERATE </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l484"><span class="ln">484  </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l485"><span class="ln">485  </span></a>    </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l486"><span class="ln">486  </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l487"><span class="ln">487  </span></a>    </span><span class="s0">#message(&quot;CUDA_NVCC_DEPEND false&quot;)</span>
<a name="l488"><span class="ln">488  </span></a>    <span class="s0"># No dependencies, so regenerate the file.</span>
<a name="l489"><span class="ln">489  </span></a>    <span class="s2">set</span><span class="s1">(CUDA_NVCC_DEPEND_REGENERATE </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l490"><span class="ln">490  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l491"><span class="ln">491  </span></a></span>
<a name="l492"><span class="ln">492  </span></a>  <span class="s0">#message(&quot;CUDA_NVCC_DEPEND_REGENERATE = ${CUDA_NVCC_DEPEND_REGENERATE}&quot;)</span>
<a name="l493"><span class="ln">493  </span></a>  <span class="s0"># No incoming dependencies, so we need to generate them.  Make the</span>
<a name="l494"><span class="ln">494  </span></a>  <span class="s0"># output depend on the dependency file itself, which should cause the</span>
<a name="l495"><span class="ln">495  </span></a>  <span class="s0"># rule to re-run.</span>
<a name="l496"><span class="ln">496  </span></a>  <span class="s2">if</span><span class="s1">(CUDA_NVCC_DEPEND_REGENERATE) 
<a name="l497"><span class="ln">497  </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_NVCC_DEPEND </span><span class="s2">${dependency_file}</span><span class="s1">) 
<a name="l498"><span class="ln">498  </span></a>    </span><span class="s0">#message(&quot;Generating an empty dependency_file: ${dependency_file}&quot;)</span>
<a name="l499"><span class="ln">499  </span></a>    <span class="s2">file</span><span class="s1">(WRITE </span><span class="s2">${dependency_file} </span><span class="s3">&quot;#FindCUDA.cmake generated file.  Do not edit.\n&quot;</span><span class="s1">) 
<a name="l500"><span class="ln">500  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l501"><span class="ln">501  </span></a></span>
<a name="l502"><span class="ln">502  </span></a><span class="s2">endmacro</span><span class="s1">() 
<a name="l503"><span class="ln">503  </span></a></span>
<a name="l504"><span class="ln">504  </span></a><span class="s0">###############################################################################</span>
<a name="l505"><span class="ln">505  </span></a><span class="s0">###############################################################################</span>
<a name="l506"><span class="ln">506  </span></a><span class="s0"># Setup variables' defaults</span>
<a name="l507"><span class="ln">507  </span></a><span class="s0">###############################################################################</span>
<a name="l508"><span class="ln">508  </span></a><span class="s0">###############################################################################</span>
<a name="l509"><span class="ln">509  </span></a>
<a name="l510"><span class="ln">510  </span></a><span class="s0"># Allow the user to specify if the device code is supposed to be 32 or 64 bit.</span>
<a name="l511"><span class="ln">511  </span></a><span class="s2">if</span><span class="s1">(</span><span class="s4">CMAKE_SIZEOF_VOID_P </span><span class="s2">EQUAL </span><span class="s1">8) 
<a name="l512"><span class="ln">512  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_64_BIT_DEVICE_CODE_DEFAULT </span><span class="s2">ON</span><span class="s1">) 
<a name="l513"><span class="ln">513  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l514"><span class="ln">514  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_64_BIT_DEVICE_CODE_DEFAULT </span><span class="s2">OFF</span><span class="s1">) 
<a name="l515"><span class="ln">515  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l516"><span class="ln">516  </span></a></span><span class="s2">option</span><span class="s1">(CUDA_64_BIT_DEVICE_CODE </span><span class="s3">&quot;Compile device code in 64 bit mode&quot; </span><span class="s2">${CUDA_64_BIT_DEVICE_CODE_DEFAULT}</span><span class="s1">) 
<a name="l517"><span class="ln">517  </span></a></span>
<a name="l518"><span class="ln">518  </span></a><span class="s0"># Attach the build rule to the source file in VS.  This option</span>
<a name="l519"><span class="ln">519  </span></a><span class="s2">option</span><span class="s1">(CUDA_ATTACH_VS_BUILD_RULE_TO_CUDA_FILE </span><span class="s3">&quot;Attach the build rule to the CUDA source file.  Enable only when the CUDA source file is added to at most one target.&quot; </span><span class="s2">ON</span><span class="s1">) 
<a name="l520"><span class="ln">520  </span></a></span>
<a name="l521"><span class="ln">521  </span></a><span class="s0"># Prints out extra information about the cuda file during compilation</span>
<a name="l522"><span class="ln">522  </span></a><span class="s2">option</span><span class="s1">(CUDA_BUILD_CUBIN </span><span class="s3">&quot;Generate and parse .cubin files in Device mode.&quot; </span><span class="s2">OFF</span><span class="s1">) 
<a name="l523"><span class="ln">523  </span></a></span>
<a name="l524"><span class="ln">524  </span></a><span class="s0"># Set whether we are using emulation or device mode.</span>
<a name="l525"><span class="ln">525  </span></a><span class="s2">option</span><span class="s1">(CUDA_BUILD_EMULATION </span><span class="s3">&quot;Build in Emulation mode&quot; </span><span class="s2">OFF</span><span class="s1">) 
<a name="l526"><span class="ln">526  </span></a></span>
<a name="l527"><span class="ln">527  </span></a><span class="s0"># Where to put the generated output.</span>
<a name="l528"><span class="ln">528  </span></a><span class="s2">set</span><span class="s1">(CUDA_GENERATED_OUTPUT_DIR </span><span class="s3">&quot;&quot; </span><span class="s2">CACHE PATH </span><span class="s3">&quot;Directory to put all the output files.  If blank it will default to the CMAKE_CURRENT_BINARY_DIR&quot;</span><span class="s1">) 
<a name="l529"><span class="ln">529  </span></a></span>
<a name="l530"><span class="ln">530  </span></a><span class="s0"># Parse HOST_COMPILATION mode.</span>
<a name="l531"><span class="ln">531  </span></a><span class="s2">option</span><span class="s1">(CUDA_HOST_COMPILATION_CPP </span><span class="s3">&quot;Generated file extension&quot; </span><span class="s2">ON</span><span class="s1">) 
<a name="l532"><span class="ln">532  </span></a></span>
<a name="l533"><span class="ln">533  </span></a><span class="s0"># Extra user settable flags</span>
<a name="l534"><span class="ln">534  </span></a><span class="s1">cmake_initialize_per_config_variable(CUDA_NVCC_FLAGS </span><span class="s3">&quot;Semi-colon delimit multiple arguments.&quot;</span><span class="s1">) 
<a name="l535"><span class="ln">535  </span></a></span>
<a name="l536"><span class="ln">536  </span></a><span class="s2">if</span><span class="s1">(</span><span class="s2">DEFINED </span><span class="s1">ENV{CUDAHOSTCXX}) 
<a name="l537"><span class="ln">537  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_HOST_COMPILER </span><span class="s3">&quot;$ENV{CUDAHOSTCXX}&quot; </span><span class="s2">CACHE </span><span class="s1">FILEPATH </span><span class="s3">&quot;Host side compiler used by NVCC&quot;</span><span class="s1">) 
<a name="l538"><span class="ln">538  </span></a></span><span class="s2">elseif</span><span class="s1">(</span><span class="s4">CMAKE_GENERATOR </span><span class="s2">MATCHES </span><span class="s3">&quot;Visual Studio&quot;</span><span class="s1">) 
<a name="l539"><span class="ln">539  </span></a>  </span><span class="s2">set</span><span class="s1">(_CUDA_MSVC_HOST_COMPILER </span><span class="s3">&quot;$(VCInstallDir)Tools/MSVC/$(VCToolsVersion)/bin/Host$(Platform)/$(PlatformTarget)&quot;</span><span class="s1">) 
<a name="l540"><span class="ln">540  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s4">MSVC_VERSION </span><span class="s2">LESS </span><span class="s1">1910) 
<a name="l541"><span class="ln">541  </span></a>   </span><span class="s2">set</span><span class="s1">(_CUDA_MSVC_HOST_COMPILER </span><span class="s3">&quot;$(VCInstallDir)bin&quot;</span><span class="s1">) 
<a name="l542"><span class="ln">542  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l543"><span class="ln">543  </span></a></span>
<a name="l544"><span class="ln">544  </span></a>  <span class="s2">set</span><span class="s1">(CUDA_HOST_COMPILER </span><span class="s3">&quot;${_CUDA_MSVC_HOST_COMPILER}&quot; </span><span class="s2">CACHE </span><span class="s1">FILEPATH </span><span class="s3">&quot;Host side compiler used by NVCC&quot;</span><span class="s1">) 
<a name="l545"><span class="ln">545  </span></a></span>
<a name="l546"><span class="ln">546  </span></a><span class="s2">else</span><span class="s1">() 
<a name="l547"><span class="ln">547  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s4">APPLE</span>
<a name="l548"><span class="ln">548  </span></a>      <span class="s2">AND </span><span class="s3">&quot;${CMAKE_C_COMPILER_ID}&quot; </span><span class="s2">MATCHES </span><span class="s3">&quot;Clang&quot;</span>
<a name="l549"><span class="ln">549  </span></a>      <span class="s2">AND </span><span class="s3">&quot;${CMAKE_C_COMPILER}&quot; </span><span class="s2">MATCHES </span><span class="s3">&quot;/cc$&quot;</span><span class="s1">) 
<a name="l550"><span class="ln">550  </span></a>    </span><span class="s0"># Using cc which is symlink to clang may let NVCC think it is GCC and issue</span>
<a name="l551"><span class="ln">551  </span></a>    <span class="s0"># unhandled -dumpspecs option to clang. Also in case neither</span>
<a name="l552"><span class="ln">552  </span></a>    <span class="s0"># CMAKE_C_COMPILER is defined (project does not use C language) nor</span>
<a name="l553"><span class="ln">553  </span></a>    <span class="s0"># CUDA_HOST_COMPILER is specified manually we should skip -ccbin and let</span>
<a name="l554"><span class="ln">554  </span></a>    <span class="s0"># nvcc use its own default C compiler.</span>
<a name="l555"><span class="ln">555  </span></a>    <span class="s0"># Only care about this on APPLE with clang to avoid</span>
<a name="l556"><span class="ln">556  </span></a>    <span class="s0"># following symlinks to things like ccache</span>
<a name="l557"><span class="ln">557  </span></a>    <span class="s2">if</span><span class="s1">(</span><span class="s2">DEFINED </span><span class="s1">CMAKE_C_COMPILER </span><span class="s2">AND NOT DEFINED </span><span class="s1">CUDA_HOST_COMPILER) 
<a name="l558"><span class="ln">558  </span></a>      </span><span class="s2">get_filename_component</span><span class="s1">(c_compiler_realpath </span><span class="s3">&quot;${CMAKE_C_COMPILER}&quot; </span><span class="s1">REALPATH) 
<a name="l559"><span class="ln">559  </span></a>      </span><span class="s0"># if the real path does not end up being clang then</span>
<a name="l560"><span class="ln">560  </span></a>      <span class="s0"># go back to using CMAKE_C_COMPILER</span>
<a name="l561"><span class="ln">561  </span></a>      <span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s3">&quot;${c_compiler_realpath}&quot; </span><span class="s2">MATCHES </span><span class="s3">&quot;/clang$&quot;</span><span class="s1">) 
<a name="l562"><span class="ln">562  </span></a>        </span><span class="s2">set</span><span class="s1">(c_compiler_realpath </span><span class="s3">&quot;${CMAKE_C_COMPILER}&quot;</span><span class="s1">) 
<a name="l563"><span class="ln">563  </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l564"><span class="ln">564  </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l565"><span class="ln">565  </span></a>      </span><span class="s2">set</span><span class="s1">(c_compiler_realpath </span><span class="s3">&quot;&quot;</span><span class="s1">) 
<a name="l566"><span class="ln">566  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l567"><span class="ln">567  </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_HOST_COMPILER </span><span class="s3">&quot;${c_compiler_realpath}&quot; </span><span class="s2">CACHE </span><span class="s1">FILEPATH </span><span class="s3">&quot;Host side compiler used by NVCC&quot;</span><span class="s1">) 
<a name="l568"><span class="ln">568  </span></a>  </span><span class="s2">elseif</span><span class="s1">(</span><span class="s4">MSVC </span><span class="s2">AND </span><span class="s3">&quot;${CMAKE_C_COMPILER}&quot; </span><span class="s2">MATCHES </span><span class="s3">&quot;clcache|sccache&quot;</span><span class="s1">) 
<a name="l569"><span class="ln">569  </span></a>    </span><span class="s0"># NVCC does not think it will work if it is passed clcache.exe or sccache.exe</span>
<a name="l570"><span class="ln">570  </span></a>    <span class="s0"># as the host compiler, which means that builds with CC=cl.exe won't work.</span>
<a name="l571"><span class="ln">571  </span></a>    <span class="s0"># Best to just feed it whatever the actual cl.exe is as the host compiler.</span>
<a name="l572"><span class="ln">572  </span></a>    <span class="s2">set</span><span class="s1">(CUDA_HOST_COMPILER </span><span class="s3">&quot;cl.exe&quot; </span><span class="s2">CACHE </span><span class="s1">FILEPATH </span><span class="s3">&quot;Host side compiler used by NVCC&quot;</span><span class="s1">) 
<a name="l573"><span class="ln">573  </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l574"><span class="ln">574  </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_HOST_COMPILER </span><span class="s3">&quot;${CMAKE_C_COMPILER}&quot;</span>
<a name="l575"><span class="ln">575  </span></a>      <span class="s2">CACHE </span><span class="s1">FILEPATH </span><span class="s3">&quot;Host side compiler used by NVCC&quot;</span><span class="s1">) 
<a name="l576"><span class="ln">576  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l577"><span class="ln">577  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l578"><span class="ln">578  </span></a></span>
<a name="l579"><span class="ln">579  </span></a><span class="s0"># Propagate the host flags to the host compiler via -Xcompiler</span>
<a name="l580"><span class="ln">580  </span></a><span class="s2">option</span><span class="s1">(CUDA_PROPAGATE_HOST_FLAGS </span><span class="s3">&quot;Propagate C/CXX_FLAGS and friends to the host compiler via -Xcompile&quot; </span><span class="s2">ON</span><span class="s1">) 
<a name="l581"><span class="ln">581  </span></a></span>
<a name="l582"><span class="ln">582  </span></a><span class="s0"># Blacklisted flags to prevent propagation</span>
<a name="l583"><span class="ln">583  </span></a><span class="s2">set</span><span class="s1">(CUDA_PROPAGATE_HOST_FLAGS_BLACKLIST  </span><span class="s3">&quot;&quot; </span><span class="s2">CACHE STRING </span><span class="s3">&quot;Blacklisted flags to prevent propagation&quot;</span><span class="s1">) 
<a name="l584"><span class="ln">584  </span></a></span>
<a name="l585"><span class="ln">585  </span></a><span class="s0"># Enable CUDA_SEPARABLE_COMPILATION</span>
<a name="l586"><span class="ln">586  </span></a><span class="s2">option</span><span class="s1">(CUDA_SEPARABLE_COMPILATION </span><span class="s3">&quot;Compile CUDA objects with separable compilation enabled.  Requires CUDA 5.0+&quot; </span><span class="s2">OFF</span><span class="s1">) 
<a name="l587"><span class="ln">587  </span></a></span>
<a name="l588"><span class="ln">588  </span></a><span class="s0"># Specifies whether the commands used when compiling the .cu file will be printed out.</span>
<a name="l589"><span class="ln">589  </span></a><span class="s2">option</span><span class="s1">(CUDA_VERBOSE_BUILD </span><span class="s3">&quot;Print out the commands run while compiling the CUDA source file.  With the Makefile generator this defaults to VERBOSE variable specified on the command line, but can be forced on with this option.&quot; </span><span class="s2">OFF</span><span class="s1">) 
<a name="l590"><span class="ln">590  </span></a></span>
<a name="l591"><span class="ln">591  </span></a><span class="s2">mark_as_advanced</span><span class="s1">( 
<a name="l592"><span class="ln">592  </span></a>  CUDA_64_BIT_DEVICE_CODE 
<a name="l593"><span class="ln">593  </span></a>  CUDA_ATTACH_VS_BUILD_RULE_TO_CUDA_FILE 
<a name="l594"><span class="ln">594  </span></a>  CUDA_GENERATED_OUTPUT_DIR 
<a name="l595"><span class="ln">595  </span></a>  CUDA_HOST_COMPILATION_CPP 
<a name="l596"><span class="ln">596  </span></a>  CUDA_NVCC_FLAGS 
<a name="l597"><span class="ln">597  </span></a>  CUDA_PROPAGATE_HOST_FLAGS 
<a name="l598"><span class="ln">598  </span></a>  CUDA_PROPAGATE_HOST_FLAGS_BLACKLIST 
<a name="l599"><span class="ln">599  </span></a>  CUDA_BUILD_CUBIN 
<a name="l600"><span class="ln">600  </span></a>  CUDA_BUILD_EMULATION 
<a name="l601"><span class="ln">601  </span></a>  CUDA_VERBOSE_BUILD 
<a name="l602"><span class="ln">602  </span></a>  CUDA_SEPARABLE_COMPILATION 
<a name="l603"><span class="ln">603  </span></a>  ) 
<a name="l604"><span class="ln">604  </span></a></span>
<a name="l605"><span class="ln">605  </span></a><span class="s0"># Single config generators like Makefiles or Ninja don't usually have</span>
<a name="l606"><span class="ln">606  </span></a><span class="s0"># CMAKE_CONFIGURATION_TYPES defined (but note that it can be defined if set by</span>
<a name="l607"><span class="ln">607  </span></a><span class="s0"># projects or developers). Even CMAKE_BUILD_TYPE might not be defined for</span>
<a name="l608"><span class="ln">608  </span></a><span class="s0"># single config generators (and should not be defined for multi-config</span>
<a name="l609"><span class="ln">609  </span></a><span class="s0"># generators). To ensure we get a complete superset of all possible</span>
<a name="l610"><span class="ln">610  </span></a><span class="s0"># configurations, we combine CMAKE_CONFIGURATION_TYPES, CMAKE_BUILD_TYPE and</span>
<a name="l611"><span class="ln">611  </span></a><span class="s0"># all of the standard configurations, then weed out duplicates with</span>
<a name="l612"><span class="ln">612  </span></a><span class="s0"># list(REMOVE_DUPLICATES). Looping over the unique set then ensures we have</span>
<a name="l613"><span class="ln">613  </span></a><span class="s0"># each configuration-specific set of nvcc flags defined and marked as advanced.</span>
<a name="l614"><span class="ln">614  </span></a><span class="s2">set</span><span class="s1">(CUDA_configuration_types </span><span class="s2">${CMAKE_CONFIGURATION_TYPES} ${CMAKE_BUILD_TYPE} </span><span class="s1">Debug MinSizeRel Release RelWithDebInfo) 
<a name="l615"><span class="ln">615  </span></a></span><span class="s2">list</span><span class="s1">(REMOVE_DUPLICATES CUDA_configuration_types) 
<a name="l616"><span class="ln">616  </span></a></span>
<a name="l617"><span class="ln">617  </span></a><span class="s0">###############################################################################</span>
<a name="l618"><span class="ln">618  </span></a><span class="s0">###############################################################################</span>
<a name="l619"><span class="ln">619  </span></a><span class="s0"># Locate CUDA, Set Build Type, etc.</span>
<a name="l620"><span class="ln">620  </span></a><span class="s0">###############################################################################</span>
<a name="l621"><span class="ln">621  </span></a><span class="s0">###############################################################################</span>
<a name="l622"><span class="ln">622  </span></a>
<a name="l623"><span class="ln">623  </span></a><span class="s2">macro</span><span class="s1">(cuda_unset_include_and_libraries) 
<a name="l624"><span class="ln">624  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_TOOLKIT_INCLUDE </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l625"><span class="ln">625  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_CUDART_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l626"><span class="ln">626  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_CUDA_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l627"><span class="ln">627  </span></a>  </span><span class="s0"># Make sure you run this before you unset CUDA_VERSION.</span>
<a name="l628"><span class="ln">628  </span></a>  <span class="s2">unset</span><span class="s1">(CUDA_cudart_static_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l629"><span class="ln">629  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cudadevrt_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l630"><span class="ln">630  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cublas_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l631"><span class="ln">631  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cublas_device_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l632"><span class="ln">632  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cublasemu_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l633"><span class="ln">633  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cublasLt_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l634"><span class="ln">634  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cufft_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l635"><span class="ln">635  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cufftemu_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l636"><span class="ln">636  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cupti_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l637"><span class="ln">637  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_curand_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l638"><span class="ln">638  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cusolver_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l639"><span class="ln">639  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_cusparse_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l640"><span class="ln">640  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_npp_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l641"><span class="ln">641  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_nppc_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l642"><span class="ln">642  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_nppi_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l643"><span class="ln">643  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_npps_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l644"><span class="ln">644  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_nvcuvenc_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l645"><span class="ln">645  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_nvcuvid_LIBRARY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l646"><span class="ln">646  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_GPU_DETECT_OUTPUT </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l647"><span class="ln">647  </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l648"><span class="ln">648  </span></a></span>
<a name="l649"><span class="ln">649  </span></a><span class="s0"># Check to see if the CUDA_TOOLKIT_ROOT_DIR and CUDA_SDK_ROOT_DIR have changed,</span>
<a name="l650"><span class="ln">650  </span></a><span class="s0"># if they have then clear the cache variables, so that will be detected again.</span>
<a name="l651"><span class="ln">651  </span></a><span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR_INTERNAL}&quot;</span><span class="s1">) 
<a name="l652"><span class="ln">652  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_TOOLKIT_TARGET_DIR </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l653"><span class="ln">653  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_NVCC_EXECUTABLE </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l654"><span class="ln">654  </span></a>  cuda_unset_include_and_libraries() 
<a name="l655"><span class="ln">655  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_VERSION </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l656"><span class="ln">656  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l657"><span class="ln">657  </span></a></span>
<a name="l658"><span class="ln">658  </span></a><span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s3">&quot;${CUDA_TOOLKIT_TARGET_DIR}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;${CUDA_TOOLKIT_TARGET_DIR_INTERNAL}&quot;</span><span class="s1">) 
<a name="l659"><span class="ln">659  </span></a>  cuda_unset_include_and_libraries() 
<a name="l660"><span class="ln">660  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l661"><span class="ln">661  </span></a></span>
<a name="l662"><span class="ln">662  </span></a><span class="s0">#</span>
<a name="l663"><span class="ln">663  </span></a><span class="s0">#  End of unset()</span>
<a name="l664"><span class="ln">664  </span></a><span class="s0">#</span>
<a name="l665"><span class="ln">665  </span></a>
<a name="l666"><span class="ln">666  </span></a><span class="s0">#</span>
<a name="l667"><span class="ln">667  </span></a><span class="s0">#  Start looking for things</span>
<a name="l668"><span class="ln">668  </span></a><span class="s0">#</span>
<a name="l669"><span class="ln">669  </span></a>
<a name="l670"><span class="ln">670  </span></a><span class="s0"># Search for the cuda distribution.</span>
<a name="l671"><span class="ln">671  </span></a><span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s1">CUDA_TOOLKIT_ROOT_DIR </span><span class="s2">AND NOT </span><span class="s4">CMAKE_CROSSCOMPILING</span><span class="s1">) 
<a name="l672"><span class="ln">672  </span></a>  </span><span class="s0"># Search in the CUDA_BIN_PATH first.</span>
<a name="l673"><span class="ln">673  </span></a>  <span class="s2">find_program</span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR_NVCC 
<a name="l674"><span class="ln">674  </span></a>    </span><span class="s2">NAMES </span><span class="s1">nvcc nvcc.exe 
<a name="l675"><span class="ln">675  </span></a>    </span><span class="s2">PATHS</span>
<a name="l676"><span class="ln">676  </span></a>      <span class="s1">ENV CUDA_TOOLKIT_ROOT 
<a name="l677"><span class="ln">677  </span></a>      ENV CUDA_PATH 
<a name="l678"><span class="ln">678  </span></a>      ENV CUDA_BIN_PATH 
<a name="l679"><span class="ln">679  </span></a>    PATH_SUFFIXES bin bin64 
<a name="l680"><span class="ln">680  </span></a>    </span><span class="s2">DOC </span><span class="s3">&quot;Toolkit location.&quot;</span>
<a name="l681"><span class="ln">681  </span></a>    <span class="s1">NO_DEFAULT_PATH 
<a name="l682"><span class="ln">682  </span></a>    ) 
<a name="l683"><span class="ln">683  </span></a></span>
<a name="l684"><span class="ln">684  </span></a>  <span class="s0"># Now search default paths</span>
<a name="l685"><span class="ln">685  </span></a>  <span class="s2">find_program</span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR_NVCC 
<a name="l686"><span class="ln">686  </span></a>    </span><span class="s2">NAMES </span><span class="s1">nvcc nvcc.exe 
<a name="l687"><span class="ln">687  </span></a>    </span><span class="s2">PATHS </span><span class="s1">/opt/cuda/bin 
<a name="l688"><span class="ln">688  </span></a>    PATH_SUFFIXES cuda/bin 
<a name="l689"><span class="ln">689  </span></a>    </span><span class="s2">DOC </span><span class="s3">&quot;Toolkit location.&quot;</span>
<a name="l690"><span class="ln">690  </span></a>    <span class="s1">) 
<a name="l691"><span class="ln">691  </span></a></span>
<a name="l692"><span class="ln">692  </span></a>  <span class="s2">if </span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR_NVCC) 
<a name="l693"><span class="ln">693  </span></a>    </span><span class="s2">get_filename_component</span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR_NVCC_PAR </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR_NVCC}&quot; </span><span class="s1">DIRECTORY) 
<a name="l694"><span class="ln">694  </span></a>    </span><span class="s2">get_filename_component</span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR_NVCC_PAR}&quot; </span><span class="s1">DIRECTORY </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l695"><span class="ln">695  </span></a>    </span><span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;[/\\\\]?bin[64]*[/\\\\]?$&quot; &quot;&quot; </span><span class="s1">CUDA_TOOLKIT_ROOT_DIR </span><span class="s2">${CUDA_TOOLKIT_ROOT_DIR}</span><span class="s1">) 
<a name="l696"><span class="ln">696  </span></a>    </span><span class="s0"># We need to force this back into the cache.</span>
<a name="l697"><span class="ln">697  </span></a>    <span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR </span><span class="s2">${CUDA_TOOLKIT_ROOT_DIR} CACHE PATH </span><span class="s3">&quot;Toolkit location.&quot; </span><span class="s1">FORCE) 
<a name="l698"><span class="ln">698  </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_TARGET_DIR </span><span class="s2">${CUDA_TOOLKIT_ROOT_DIR}</span><span class="s1">) 
<a name="l699"><span class="ln">699  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l700"><span class="ln">700  </span></a>  </span><span class="s2">unset</span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR_NVCC </span><span class="s2">CACHE</span><span class="s1">) 
<a name="l701"><span class="ln">701  </span></a></span>
<a name="l702"><span class="ln">702  </span></a>  <span class="s2">if </span><span class="s1">(</span><span class="s2">NOT EXISTS ${CUDA_TOOLKIT_ROOT_DIR}</span><span class="s1">) 
<a name="l703"><span class="ln">703  </span></a>    </span><span class="s2">if</span><span class="s1">(CUDA_FIND_REQUIRED) 
<a name="l704"><span class="ln">704  </span></a>      </span><span class="s2">message</span><span class="s1">(FATAL_ERROR </span><span class="s3">&quot;Specify CUDA_TOOLKIT_ROOT_DIR&quot;</span><span class="s1">) 
<a name="l705"><span class="ln">705  </span></a>    </span><span class="s2">elseif</span><span class="s1">(</span><span class="s2">NOT </span><span class="s1">CUDA_FIND_QUIETLY) 
<a name="l706"><span class="ln">706  </span></a>      </span><span class="s2">message</span><span class="s1">(</span><span class="s3">&quot;CUDA_TOOLKIT_ROOT_DIR not found or specified&quot;</span><span class="s1">) 
<a name="l707"><span class="ln">707  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l708"><span class="ln">708  </span></a>  </span><span class="s2">endif </span><span class="s1">() 
<a name="l709"><span class="ln">709  </span></a></span><span class="s2">endif </span><span class="s1">() 
<a name="l710"><span class="ln">710  </span></a></span>
<a name="l711"><span class="ln">711  </span></a><span class="s2">if</span><span class="s1">(</span><span class="s4">CMAKE_CROSSCOMPILING</span><span class="s1">) 
<a name="l712"><span class="ln">712  </span></a>  </span><span class="s2">SET </span><span class="s1">(CUDA_TOOLKIT_ROOT </span><span class="s2">$ENV{CUDA_TOOLKIT_ROOT}</span><span class="s1">) 
<a name="l713"><span class="ln">713  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s4">CMAKE_SYSTEM_PROCESSOR </span><span class="s2">STREQUAL </span><span class="s3">&quot;armv7-a&quot;</span><span class="s1">) 
<a name="l714"><span class="ln">714  </span></a>    </span><span class="s0"># Support for NVPACK</span>
<a name="l715"><span class="ln">715  </span></a>    <span class="s2">set </span><span class="s1">(CUDA_TOOLKIT_TARGET_NAMES </span><span class="s3">&quot;armv7-linux-androideabi&quot;</span><span class="s1">) 
<a name="l716"><span class="ln">716  </span></a>  </span><span class="s2">elseif</span><span class="s1">(</span><span class="s4">CMAKE_SYSTEM_PROCESSOR </span><span class="s2">MATCHES </span><span class="s3">&quot;arm&quot;</span><span class="s1">) 
<a name="l717"><span class="ln">717  </span></a>    </span><span class="s0"># Support for arm cross compilation</span>
<a name="l718"><span class="ln">718  </span></a>    <span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_TARGET_NAMES </span><span class="s3">&quot;armv7-linux-gnueabihf&quot;</span><span class="s1">) 
<a name="l719"><span class="ln">719  </span></a>  </span><span class="s2">elseif</span><span class="s1">(</span><span class="s4">CMAKE_SYSTEM_PROCESSOR </span><span class="s2">MATCHES </span><span class="s3">&quot;aarch64&quot;</span><span class="s1">) 
<a name="l720"><span class="ln">720  </span></a>    </span><span class="s0"># Support for aarch64 cross compilation</span>
<a name="l721"><span class="ln">721  </span></a>    <span class="s2">if </span><span class="s1">(ANDROID_ARCH_NAME </span><span class="s2">STREQUAL </span><span class="s3">&quot;arm64&quot;</span><span class="s1">) 
<a name="l722"><span class="ln">722  </span></a>      </span><span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_TARGET_NAMES </span><span class="s3">&quot;aarch64-linux-androideabi&quot;</span><span class="s1">) 
<a name="l723"><span class="ln">723  </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l724"><span class="ln">724  </span></a>      </span><span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_TARGET_NAMES </span><span class="s3">&quot;aarch64-linux&quot; &quot;sbsa-linux&quot;</span><span class="s1">) 
<a name="l725"><span class="ln">725  </span></a>    </span><span class="s2">endif </span><span class="s1">(ANDROID_ARCH_NAME </span><span class="s2">STREQUAL </span><span class="s3">&quot;arm64&quot;</span><span class="s1">) 
<a name="l726"><span class="ln">726  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l727"><span class="ln">727  </span></a></span>
<a name="l728"><span class="ln">728  </span></a>  <span class="s2">foreach</span><span class="s1">(CUDA_TOOLKIT_TARGET_NAME IN LISTS CUDA_TOOLKIT_TARGET_NAMES) 
<a name="l729"><span class="ln">729  </span></a>    </span><span class="s2">if </span><span class="s1">(</span><span class="s2">EXISTS </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT}/targets/${CUDA_TOOLKIT_TARGET_NAME}&quot;</span><span class="s1">) 
<a name="l730"><span class="ln">730  </span></a>      </span><span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_TARGET_DIR </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT}/targets/${CUDA_TOOLKIT_TARGET_NAME}&quot; </span><span class="s2">CACHE PATH </span><span class="s3">&quot;CUDA Toolkit target location.&quot;</span><span class="s1">) 
<a name="l731"><span class="ln">731  </span></a>      </span><span class="s2">SET </span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR </span><span class="s2">${CUDA_TOOLKIT_ROOT} CACHE PATH </span><span class="s3">&quot;Toolkit location.&quot; </span><span class="s1">FORCE) 
<a name="l732"><span class="ln">732  </span></a>      </span><span class="s2">mark_as_advanced</span><span class="s1">(CUDA_TOOLKIT_TARGET_DIR) 
<a name="l733"><span class="ln">733  </span></a>      </span><span class="s2">break</span><span class="s1">() 
<a name="l734"><span class="ln">734  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l735"><span class="ln">735  </span></a>  </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l736"><span class="ln">736  </span></a></span>
<a name="l737"><span class="ln">737  </span></a>  <span class="s0"># add known CUDA targetr root path to the set of directories we search for programs, libraries and headers</span>
<a name="l738"><span class="ln">738  </span></a>  <span class="s2">set</span><span class="s1">( CMAKE_FIND_ROOT_PATH </span><span class="s3">&quot;${CUDA_TOOLKIT_TARGET_DIR};${CMAKE_FIND_ROOT_PATH}&quot;</span><span class="s1">) 
<a name="l739"><span class="ln">739  </span></a>  </span><span class="s2">macro</span><span class="s1">( cuda_find_host_program ) 
<a name="l740"><span class="ln">740  </span></a>    </span><span class="s2">if </span><span class="s1">(</span><span class="s2">COMMAND </span><span class="s1">find_host_program) 
<a name="l741"><span class="ln">741  </span></a>      find_host_program( </span><span class="s2">${ARGN} </span><span class="s1">) 
<a name="l742"><span class="ln">742  </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l743"><span class="ln">743  </span></a>      </span><span class="s2">find_program</span><span class="s1">( </span><span class="s2">${ARGN} </span><span class="s1">) 
<a name="l744"><span class="ln">744  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l745"><span class="ln">745  </span></a>  </span><span class="s2">endmacro</span><span class="s1">() 
<a name="l746"><span class="ln">746  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l747"><span class="ln">747  </span></a>  </span><span class="s0"># for non-cross-compile, find_host_program == find_program and CUDA_TOOLKIT_TARGET_DIR == CUDA_TOOLKIT_ROOT_DIR</span>
<a name="l748"><span class="ln">748  </span></a>  <span class="s2">macro</span><span class="s1">( cuda_find_host_program ) 
<a name="l749"><span class="ln">749  </span></a>    </span><span class="s2">find_program</span><span class="s1">( </span><span class="s2">${ARGN} </span><span class="s1">) 
<a name="l750"><span class="ln">750  </span></a>  </span><span class="s2">endmacro</span><span class="s1">() 
<a name="l751"><span class="ln">751  </span></a>  </span><span class="s2">SET </span><span class="s1">(CUDA_TOOLKIT_TARGET_DIR </span><span class="s2">${CUDA_TOOLKIT_ROOT_DIR}</span><span class="s1">) 
<a name="l752"><span class="ln">752  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l753"><span class="ln">753  </span></a></span>
<a name="l754"><span class="ln">754  </span></a>
<a name="l755"><span class="ln">755  </span></a><span class="s0"># CUDA_NVCC_EXECUTABLE</span>
<a name="l756"><span class="ln">756  </span></a><span class="s2">if</span><span class="s1">(</span><span class="s2">DEFINED </span><span class="s1">ENV{CUDA_NVCC_EXECUTABLE}) 
<a name="l757"><span class="ln">757  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_NVCC_EXECUTABLE </span><span class="s3">&quot;$ENV{CUDA_NVCC_EXECUTABLE}&quot; </span><span class="s2">CACHE </span><span class="s1">FILEPATH </span><span class="s3">&quot;The CUDA compiler&quot;</span><span class="s1">) 
<a name="l758"><span class="ln">758  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l759"><span class="ln">759  </span></a>  cuda_find_host_program(CUDA_NVCC_EXECUTABLE 
<a name="l760"><span class="ln">760  </span></a>    </span><span class="s2">NAMES </span><span class="s1">nvcc 
<a name="l761"><span class="ln">761  </span></a>    </span><span class="s2">PATHS </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR}&quot;</span>
<a name="l762"><span class="ln">762  </span></a>    <span class="s1">ENV CUDA_PATH 
<a name="l763"><span class="ln">763  </span></a>    ENV CUDA_BIN_PATH 
<a name="l764"><span class="ln">764  </span></a>    PATH_SUFFIXES bin bin64 
<a name="l765"><span class="ln">765  </span></a>    NO_DEFAULT_PATH 
<a name="l766"><span class="ln">766  </span></a>    ) 
<a name="l767"><span class="ln">767  </span></a>  </span><span class="s0"># Search default search paths, after we search our own set of paths.</span>
<a name="l768"><span class="ln">768  </span></a>  <span class="s1">cuda_find_host_program(CUDA_NVCC_EXECUTABLE nvcc) 
<a name="l769"><span class="ln">769  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l770"><span class="ln">770  </span></a></span>
<a name="l771"><span class="ln">771  </span></a><span class="s2">if</span><span class="s1">(CUDA_NVCC_EXECUTABLE </span><span class="s2">AND NOT </span><span class="s1">CUDA_VERSION) 
<a name="l772"><span class="ln">772  </span></a>  </span><span class="s0"># Compute the version.</span>
<a name="l773"><span class="ln">773  </span></a>  <span class="s2">execute_process</span><span class="s1">(</span><span class="s2">COMMAND ${CUDA_NVCC_EXECUTABLE} </span><span class="s3">&quot;--version&quot;</span>
<a name="l774"><span class="ln">774  </span></a>    <span class="s1">OUTPUT_VARIABLE NVCC_OUT 
<a name="l775"><span class="ln">775  </span></a>    RESULT_VARIABLE NVCC_RC) 
<a name="l776"><span class="ln">776  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s1">(</span><span class="s2">${NVCC_RC} EQUAL </span><span class="s1">0)) 
<a name="l777"><span class="ln">777  </span></a>    </span><span class="s2">message</span><span class="s1">(WARNING </span><span class="s3">&quot;Failed to execute '${CUDA_NVCC_EXECUTABLE} --version'&quot;</span><span class="s1">) 
<a name="l778"><span class="ln">778  </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_FOUND </span><span class="s2">FALSE</span><span class="s1">) 
<a name="l779"><span class="ln">779  </span></a>    </span><span class="s2">return</span><span class="s1">() 
<a name="l780"><span class="ln">780  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l781"><span class="ln">781  </span></a>  </span><span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;.*release ([0-9]+)\\.([0-9]+).*&quot; &quot;\\1&quot; </span><span class="s1">CUDA_VERSION_MAJOR </span><span class="s2">${NVCC_OUT}</span><span class="s1">) 
<a name="l782"><span class="ln">782  </span></a>  </span><span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;.*release ([0-9]+)\\.([0-9]+).*&quot; &quot;\\2&quot; </span><span class="s1">CUDA_VERSION_MINOR </span><span class="s2">${NVCC_OUT}</span><span class="s1">) 
<a name="l783"><span class="ln">783  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_VERSION </span><span class="s3">&quot;${CUDA_VERSION_MAJOR}.${CUDA_VERSION_MINOR}&quot; </span><span class="s2">CACHE STRING </span><span class="s3">&quot;Version of CUDA as computed from nvcc.&quot;</span><span class="s1">) 
<a name="l784"><span class="ln">784  </span></a>  </span><span class="s2">mark_as_advanced</span><span class="s1">(CUDA_VERSION) 
<a name="l785"><span class="ln">785  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l786"><span class="ln">786  </span></a>  </span><span class="s0"># Need to set these based off of the cached value</span>
<a name="l787"><span class="ln">787  </span></a>  <span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;([0-9]+)\\.([0-9]+).*&quot; &quot;\\1&quot; </span><span class="s1">CUDA_VERSION_MAJOR </span><span class="s3">&quot;${CUDA_VERSION}&quot;</span><span class="s1">) 
<a name="l788"><span class="ln">788  </span></a>  </span><span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;([0-9]+)\\.([0-9]+).*&quot; &quot;\\2&quot; </span><span class="s1">CUDA_VERSION_MINOR </span><span class="s3">&quot;${CUDA_VERSION}&quot;</span><span class="s1">) 
<a name="l789"><span class="ln">789  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l790"><span class="ln">790  </span></a></span>
<a name="l791"><span class="ln">791  </span></a><span class="s0"># Always set this convenience variable</span>
<a name="l792"><span class="ln">792  </span></a><span class="s2">set</span><span class="s1">(CUDA_VERSION_STRING </span><span class="s3">&quot;${CUDA_VERSION}&quot;</span><span class="s1">) 
<a name="l793"><span class="ln">793  </span></a></span>
<a name="l794"><span class="ln">794  </span></a><span class="s0"># CUDA_TOOLKIT_INCLUDE</span>
<a name="l795"><span class="ln">795  </span></a><span class="s2">find_path</span><span class="s1">(CUDA_TOOLKIT_INCLUDE 
<a name="l796"><span class="ln">796  </span></a>  device_functions.h </span><span class="s0"># Header included in toolkit</span>
<a name="l797"><span class="ln">797  </span></a>  <span class="s2">PATHS ${CUDA_TOOLKIT_TARGET_DIR}</span>
<a name="l798"><span class="ln">798  </span></a>  <span class="s1">ENV CUDA_PATH 
<a name="l799"><span class="ln">799  </span></a>  ENV CUDA_INC_PATH 
<a name="l800"><span class="ln">800  </span></a>  PATH_SUFFIXES include 
<a name="l801"><span class="ln">801  </span></a>  NO_DEFAULT_PATH 
<a name="l802"><span class="ln">802  </span></a>  ) 
<a name="l803"><span class="ln">803  </span></a></span><span class="s0"># Search default search paths, after we search our own set of paths.</span>
<a name="l804"><span class="ln">804  </span></a><span class="s2">find_path</span><span class="s1">(CUDA_TOOLKIT_INCLUDE device_functions.h) 
<a name="l805"><span class="ln">805  </span></a></span><span class="s2">mark_as_advanced</span><span class="s1">(CUDA_TOOLKIT_INCLUDE) 
<a name="l806"><span class="ln">806  </span></a></span>
<a name="l807"><span class="ln">807  </span></a><span class="s2">set</span><span class="s1">(CUDA_HAS_FP16 </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l808"><span class="ln">808  </span></a></span>
<a name="l809"><span class="ln">809  </span></a><span class="s0"># Set the user list of include dir to nothing to initialize it.</span>
<a name="l810"><span class="ln">810  </span></a><span class="s2">set </span><span class="s1">(CUDA_NVCC_INCLUDE_DIRS_USER </span><span class="s3">&quot;&quot;</span><span class="s1">) 
<a name="l811"><span class="ln">811  </span></a></span><span class="s2">set </span><span class="s1">(CUDA_INCLUDE_DIRS </span><span class="s2">${CUDA_TOOLKIT_INCLUDE}</span><span class="s1">) 
<a name="l812"><span class="ln">812  </span></a></span>
<a name="l813"><span class="ln">813  </span></a><span class="s2">macro</span><span class="s1">(cuda_find_library_local_first_with_path_ext _var _names _doc _path_ext ) 
<a name="l814"><span class="ln">814  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s4">CMAKE_SIZEOF_VOID_P </span><span class="s2">EQUAL </span><span class="s1">8) 
<a name="l815"><span class="ln">815  </span></a>    </span><span class="s0"># CUDA 3.2+ on Windows moved the library directories, so we need the new</span>
<a name="l816"><span class="ln">816  </span></a>    <span class="s0"># and old paths.</span>
<a name="l817"><span class="ln">817  </span></a>    <span class="s2">set</span><span class="s1">(_cuda_64bit_lib_dir </span><span class="s3">&quot;${_path_ext}lib/x64&quot; &quot;${_path_ext}lib64&quot; &quot;${_path_ext}libx64&quot; </span><span class="s1">) 
<a name="l818"><span class="ln">818  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l819"><span class="ln">819  </span></a>  </span><span class="s0"># CUDA 3.2+ on Windows moved the library directories, so we need to new</span>
<a name="l820"><span class="ln">820  </span></a>  <span class="s0"># (lib/Win32) and the old path (lib).</span>
<a name="l821"><span class="ln">821  </span></a>  <span class="s2">find_library</span><span class="s1">(</span><span class="s2">${_var}</span>
<a name="l822"><span class="ln">822  </span></a>    <span class="s2">NAMES ${_names}</span>
<a name="l823"><span class="ln">823  </span></a>    <span class="s2">PATHS </span><span class="s3">&quot;${CUDA_TOOLKIT_TARGET_DIR}&quot;</span>
<a name="l824"><span class="ln">824  </span></a>    <span class="s1">ENV CUDA_PATH 
<a name="l825"><span class="ln">825  </span></a>    ENV CUDA_LIB_PATH 
<a name="l826"><span class="ln">826  </span></a>    PATH_SUFFIXES </span><span class="s2">${_cuda_64bit_lib_dir} </span><span class="s3">&quot;${_path_ext}lib/Win32&quot; &quot;${_path_ext}lib&quot; &quot;${_path_ext}libWin32&quot;</span>
<a name="l827"><span class="ln">827  </span></a>    <span class="s2">DOC ${_doc}</span>
<a name="l828"><span class="ln">828  </span></a>    <span class="s1">NO_DEFAULT_PATH 
<a name="l829"><span class="ln">829  </span></a>    ) 
<a name="l830"><span class="ln">830  </span></a>  </span><span class="s2">if </span><span class="s1">(</span><span class="s2">NOT </span><span class="s4">CMAKE_CROSSCOMPILING</span><span class="s1">) 
<a name="l831"><span class="ln">831  </span></a>    </span><span class="s0"># Search default search paths, after we search our own set of paths.</span>
<a name="l832"><span class="ln">832  </span></a>    <span class="s2">find_library</span><span class="s1">(</span><span class="s2">${_var}</span>
<a name="l833"><span class="ln">833  </span></a>      <span class="s2">NAMES ${_names}</span>
<a name="l834"><span class="ln">834  </span></a>      <span class="s2">PATHS </span><span class="s3">&quot;/usr/lib/nvidia-current&quot;</span>
<a name="l835"><span class="ln">835  </span></a>      <span class="s2">DOC ${_doc}</span>
<a name="l836"><span class="ln">836  </span></a>      <span class="s1">) 
<a name="l837"><span class="ln">837  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l838"><span class="ln">838  </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l839"><span class="ln">839  </span></a></span>
<a name="l840"><span class="ln">840  </span></a><span class="s2">macro</span><span class="s1">(cuda_find_library_local_first _var _names _doc) 
<a name="l841"><span class="ln">841  </span></a>  cuda_find_library_local_first_with_path_ext( </span><span class="s3">&quot;${_var}&quot; &quot;${_names}&quot; &quot;${_doc}&quot; &quot;&quot; </span><span class="s1">) 
<a name="l842"><span class="ln">842  </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l843"><span class="ln">843  </span></a></span>
<a name="l844"><span class="ln">844  </span></a><span class="s2">macro</span><span class="s1">(find_library_local_first _var _names _doc ) 
<a name="l845"><span class="ln">845  </span></a>  cuda_find_library_local_first( </span><span class="s3">&quot;${_var}&quot; &quot;${_names}&quot; &quot;${_doc}&quot; &quot;&quot; </span><span class="s1">) 
<a name="l846"><span class="ln">846  </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l847"><span class="ln">847  </span></a></span>
<a name="l848"><span class="ln">848  </span></a>
<a name="l849"><span class="ln">849  </span></a><span class="s0"># CUDA_LIBRARIES</span>
<a name="l850"><span class="ln">850  </span></a><span class="s1">cuda_find_library_local_first(CUDA_CUDART_LIBRARY cudart </span><span class="s3">&quot;\&quot;cudart\&quot; library&quot;</span><span class="s1">) 
<a name="l851"><span class="ln">851  </span></a></span>
<a name="l852"><span class="ln">852  </span></a><span class="s1">cuda_find_library_local_first(CUDA_cudart_static_LIBRARY cudart_static </span><span class="s3">&quot;static CUDA runtime library&quot;</span><span class="s1">) 
<a name="l853"><span class="ln">853  </span></a></span><span class="s2">mark_as_advanced</span><span class="s1">(CUDA_cudart_static_LIBRARY) 
<a name="l854"><span class="ln">854  </span></a></span>
<a name="l855"><span class="ln">855  </span></a>
<a name="l856"><span class="ln">856  </span></a><span class="s2">if</span><span class="s1">(CUDA_cudart_static_LIBRARY) 
<a name="l857"><span class="ln">857  </span></a>  </span><span class="s0"># If static cudart available, use it by default, but provide a user-visible option to disable it.</span>
<a name="l858"><span class="ln">858  </span></a>  <span class="s2">option</span><span class="s1">(CUDA_USE_STATIC_CUDA_RUNTIME </span><span class="s3">&quot;Use the static version of the CUDA runtime library if available&quot; </span><span class="s2">ON</span><span class="s1">) 
<a name="l859"><span class="ln">859  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l860"><span class="ln">860  </span></a>  </span><span class="s0"># If not available, silently disable the option.</span>
<a name="l861"><span class="ln">861  </span></a>  <span class="s2">set</span><span class="s1">(CUDA_USE_STATIC_CUDA_RUNTIME </span><span class="s2">OFF CACHE INTERNAL </span><span class="s3">&quot;&quot;</span><span class="s1">) 
<a name="l862"><span class="ln">862  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l863"><span class="ln">863  </span></a></span>
<a name="l864"><span class="ln">864  </span></a><span class="s2">if</span><span class="s1">(CUDA_USE_STATIC_CUDA_RUNTIME) 
<a name="l865"><span class="ln">865  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_CUDART_LIBRARY_VAR CUDA_cudart_static_LIBRARY) 
<a name="l866"><span class="ln">866  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l867"><span class="ln">867  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_CUDART_LIBRARY_VAR CUDA_CUDART_LIBRARY) 
<a name="l868"><span class="ln">868  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l869"><span class="ln">869  </span></a></span>
<a name="l870"><span class="ln">870  </span></a><span class="s1">cuda_find_library_local_first(CUDA_cudadevrt_LIBRARY cudadevrt </span><span class="s3">&quot;\&quot;cudadevrt\&quot; library&quot;</span><span class="s1">) 
<a name="l871"><span class="ln">871  </span></a></span><span class="s2">mark_as_advanced</span><span class="s1">(CUDA_cudadevrt_LIBRARY) 
<a name="l872"><span class="ln">872  </span></a></span>
<a name="l873"><span class="ln">873  </span></a><span class="s2">if</span><span class="s1">(CUDA_USE_STATIC_CUDA_RUNTIME) 
<a name="l874"><span class="ln">874  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s4">UNIX</span><span class="s1">) 
<a name="l875"><span class="ln">875  </span></a>    </span><span class="s0"># Check for the dependent libraries.  Here we look for pthreads.</span>
<a name="l876"><span class="ln">876  </span></a>    <span class="s2">if </span><span class="s1">(</span><span class="s2">DEFINED </span><span class="s1">CMAKE_THREAD_PREFER_PTHREAD) 
<a name="l877"><span class="ln">877  </span></a>      </span><span class="s2">set</span><span class="s1">(_cuda_cmake_thread_prefer_pthread </span><span class="s2">${CMAKE_THREAD_PREFER_PTHREAD}</span><span class="s1">) 
<a name="l878"><span class="ln">878  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l879"><span class="ln">879  </span></a>    </span><span class="s2">set</span><span class="s1">(CMAKE_THREAD_PREFER_PTHREAD 1) 
<a name="l880"><span class="ln">880  </span></a></span>
<a name="l881"><span class="ln">881  </span></a>    <span class="s0"># Many of the FindXYZ CMake comes with makes use of try_compile with int main(){return 0;}</span>
<a name="l882"><span class="ln">882  </span></a>    <span class="s0"># as the source file.  Unfortunately this causes a warning with -Wstrict-prototypes and</span>
<a name="l883"><span class="ln">883  </span></a>    <span class="s0"># -Werror causes the try_compile to fail.  We will just temporarily disable other flags</span>
<a name="l884"><span class="ln">884  </span></a>    <span class="s0"># when doing the find_package command here.</span>
<a name="l885"><span class="ln">885  </span></a>    <span class="s2">set</span><span class="s1">(_cuda_cmake_c_flags </span><span class="s2">${CMAKE_C_FLAGS}</span><span class="s1">) 
<a name="l886"><span class="ln">886  </span></a>    </span><span class="s2">set</span><span class="s1">(CMAKE_C_FLAGS </span><span class="s3">&quot;-fPIC&quot;</span><span class="s1">) 
<a name="l887"><span class="ln">887  </span></a>    </span><span class="s2">find_package</span><span class="s1">(Threads REQUIRED) 
<a name="l888"><span class="ln">888  </span></a>    </span><span class="s2">set</span><span class="s1">(CMAKE_C_FLAGS </span><span class="s2">${_cuda_cmake_c_flags}</span><span class="s1">) 
<a name="l889"><span class="ln">889  </span></a></span>
<a name="l890"><span class="ln">890  </span></a>    <span class="s2">if </span><span class="s1">(</span><span class="s2">DEFINED </span><span class="s1">_cuda_cmake_thread_prefer_pthread) 
<a name="l891"><span class="ln">891  </span></a>      </span><span class="s2">set</span><span class="s1">(CMAKE_THREAD_PREFER_PTHREAD </span><span class="s2">${_cuda_cmake_thread_prefer_pthread}</span><span class="s1">) 
<a name="l892"><span class="ln">892  </span></a>      </span><span class="s2">unset</span><span class="s1">(_cuda_cmake_thread_prefer_pthread) 
<a name="l893"><span class="ln">893  </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l894"><span class="ln">894  </span></a>      </span><span class="s2">unset</span><span class="s1">(CMAKE_THREAD_PREFER_PTHREAD) 
<a name="l895"><span class="ln">895  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l896"><span class="ln">896  </span></a></span>
<a name="l897"><span class="ln">897  </span></a>    <span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s4">APPLE</span><span class="s1">) 
<a name="l898"><span class="ln">898  </span></a>      </span><span class="s0">#On Linux, you must link against librt when using the static cuda runtime.</span>
<a name="l899"><span class="ln">899  </span></a>      <span class="s2">find_library</span><span class="s1">(CUDA_rt_LIBRARY rt) 
<a name="l900"><span class="ln">900  </span></a>      </span><span class="s2">if </span><span class="s1">(</span><span class="s2">NOT </span><span class="s1">CUDA_rt_LIBRARY) 
<a name="l901"><span class="ln">901  </span></a>        </span><span class="s2">message</span><span class="s1">(WARNING </span><span class="s3">&quot;Expecting to find librt for libcudart_static, but didn't find it.&quot;</span><span class="s1">) 
<a name="l902"><span class="ln">902  </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l903"><span class="ln">903  </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l904"><span class="ln">904  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l905"><span class="ln">905  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l906"><span class="ln">906  </span></a></span>
<a name="l907"><span class="ln">907  </span></a><span class="s1">cuda_find_library_local_first_with_path_ext(CUDA_cupti_LIBRARY cupti </span><span class="s3">&quot;\&quot;cupti\&quot; library&quot; &quot;extras/CUPTI/&quot;</span><span class="s1">) 
<a name="l908"><span class="ln">908  </span></a></span><span class="s2">mark_as_advanced</span><span class="s1">(CUDA_cupti_LIBRARY) 
<a name="l909"><span class="ln">909  </span></a></span>
<a name="l910"><span class="ln">910  </span></a><span class="s0"># Set the CUDA_LIBRARIES variable.  This is the set of stuff to link against if you are</span>
<a name="l911"><span class="ln">911  </span></a><span class="s0"># using the CUDA runtime.  For the dynamic version of the runtime, most of the</span>
<a name="l912"><span class="ln">912  </span></a><span class="s0"># dependencies are brought in, but for the static version there are additional libraries</span>
<a name="l913"><span class="ln">913  </span></a><span class="s0"># and linker commands needed.</span>
<a name="l914"><span class="ln">914  </span></a><span class="s0"># Initialize to empty</span>
<a name="l915"><span class="ln">915  </span></a><span class="s2">set</span><span class="s1">(CUDA_LIBRARIES) 
<a name="l916"><span class="ln">916  </span></a></span>
<a name="l917"><span class="ln">917  </span></a><span class="s0"># If we are using emulation mode and we found the cudartemu library then use</span>
<a name="l918"><span class="ln">918  </span></a><span class="s0"># that one instead of cudart.</span>
<a name="l919"><span class="ln">919  </span></a><span class="s2">if</span><span class="s1">(CUDA_BUILD_EMULATION </span><span class="s2">AND </span><span class="s1">CUDA_CUDARTEMU_LIBRARY) 
<a name="l920"><span class="ln">920  </span></a>  </span><span class="s2">list</span><span class="s1">(APPEND CUDA_LIBRARIES </span><span class="s2">${CUDA_CUDARTEMU_LIBRARY}</span><span class="s1">) 
<a name="l921"><span class="ln">921  </span></a></span><span class="s2">elseif</span><span class="s1">(CUDA_USE_STATIC_CUDA_RUNTIME </span><span class="s2">AND </span><span class="s1">CUDA_cudart_static_LIBRARY) 
<a name="l922"><span class="ln">922  </span></a>  </span><span class="s2">list</span><span class="s1">(APPEND CUDA_LIBRARIES </span><span class="s2">${CUDA_cudart_static_LIBRARY} ${CMAKE_THREAD_LIBS_INIT} ${CMAKE_DL_LIBS}</span><span class="s1">) 
<a name="l923"><span class="ln">923  </span></a>  </span><span class="s2">if </span><span class="s1">(CUDA_rt_LIBRARY) 
<a name="l924"><span class="ln">924  </span></a>    </span><span class="s2">list</span><span class="s1">(APPEND CUDA_LIBRARIES </span><span class="s2">${CUDA_rt_LIBRARY}</span><span class="s1">) 
<a name="l925"><span class="ln">925  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l926"><span class="ln">926  </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s4">APPLE</span><span class="s1">) 
<a name="l927"><span class="ln">927  </span></a>    </span><span class="s0"># We need to add the default path to the driver (libcuda.dylib) as an rpath, so that</span>
<a name="l928"><span class="ln">928  </span></a>    <span class="s0"># the static cuda runtime can find it at runtime.</span>
<a name="l929"><span class="ln">929  </span></a>    <span class="s2">list</span><span class="s1">(APPEND CUDA_LIBRARIES -Wl,-rpath,/usr/local/cuda/lib) 
<a name="l930"><span class="ln">930  </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l931"><span class="ln">931  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l932"><span class="ln">932  </span></a>  </span><span class="s2">list</span><span class="s1">(APPEND CUDA_LIBRARIES </span><span class="s2">${CUDA_CUDART_LIBRARY}</span><span class="s1">) 
<a name="l933"><span class="ln">933  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l934"><span class="ln">934  </span></a></span>
<a name="l935"><span class="ln">935  </span></a><span class="s0"># 1.1 toolkit on linux doesn't appear to have a separate library on</span>
<a name="l936"><span class="ln">936  </span></a><span class="s0"># some platforms.</span>
<a name="l937"><span class="ln">937  </span></a><span class="s1">cuda_find_library_local_first(CUDA_CUDA_LIBRARY cuda </span><span class="s3">&quot;\&quot;cuda\&quot; library (older versions only).&quot;</span><span class="s1">) 
<a name="l938"><span class="ln">938  </span></a></span>
<a name="l939"><span class="ln">939  </span></a><span class="s2">mark_as_advanced</span><span class="s1">( 
<a name="l940"><span class="ln">940  </span></a>  CUDA_CUDA_LIBRARY 
<a name="l941"><span class="ln">941  </span></a>  CUDA_CUDART_LIBRARY 
<a name="l942"><span class="ln">942  </span></a>  ) 
<a name="l943"><span class="ln">943  </span></a></span>
<a name="l944"><span class="ln">944  </span></a><span class="s0">#######################</span>
<a name="l945"><span class="ln">945  </span></a><span class="s0"># Look for some of the toolkit helper libraries</span>
<a name="l946"><span class="ln">946  </span></a><span class="s2">macro</span><span class="s1">(FIND_CUDA_HELPER_LIBS _name) 
<a name="l947"><span class="ln">947  </span></a>  cuda_find_library_local_first(CUDA_</span><span class="s2">${_name}</span><span class="s1">_LIBRARY </span><span class="s2">${_name} </span><span class="s3">&quot;\&quot;${_name}\&quot; library&quot;</span><span class="s1">) 
<a name="l948"><span class="ln">948  </span></a>  </span><span class="s2">mark_as_advanced</span><span class="s1">(CUDA_</span><span class="s2">${_name}</span><span class="s1">_LIBRARY) 
<a name="l949"><span class="ln">949  </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l950"><span class="ln">950  </span></a></span>
<a name="l951"><span class="ln">951  </span></a><span class="s2">if</span><span class="s1">(CUDA_BUILD_EMULATION) 
<a name="l952"><span class="ln">952  </span></a>  </span><span class="s2">message</span><span class="s1">(FATAL_ERROR </span><span class="s3">&quot;CUDA_BUILD_EMULATION is not supported in version 3.1 and onwards.  You must disable it to proceed.  You have version ${CUDA_VERSION}.&quot;</span><span class="s1">) 
<a name="l953"><span class="ln">953  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l954"><span class="ln">954  </span></a></span>
<a name="l955"><span class="ln">955  </span></a><span class="s1">find_cuda_helper_libs(cufft) 
<a name="l956"><span class="ln">956  </span></a>find_cuda_helper_libs(cublas) 
<a name="l957"><span class="ln">957  </span></a>find_cuda_helper_libs(cublasLt) 
<a name="l958"><span class="ln">958  </span></a></span><span class="s0"># cusparse showed up in version 3.2</span>
<a name="l959"><span class="ln">959  </span></a><span class="s1">find_cuda_helper_libs(cusparse) 
<a name="l960"><span class="ln">960  </span></a>find_cuda_helper_libs(curand) 
<a name="l961"><span class="ln">961  </span></a></span><span class="s2">if </span><span class="s1">(</span><span class="s4">WIN32</span><span class="s1">) 
<a name="l962"><span class="ln">962  </span></a>  find_cuda_helper_libs(nvcuvenc) 
<a name="l963"><span class="ln">963  </span></a>  find_cuda_helper_libs(nvcuvid) 
<a name="l964"><span class="ln">964  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l965"><span class="ln">965  </span></a></span>
<a name="l966"><span class="ln">966  </span></a><span class="s0"># In CUDA 9.0 NPP was nppi was removed</span>
<a name="l967"><span class="ln">967  </span></a><span class="s1">find_cuda_helper_libs(nppc) 
<a name="l968"><span class="ln">968  </span></a>find_cuda_helper_libs(nppial) 
<a name="l969"><span class="ln">969  </span></a>find_cuda_helper_libs(nppicc) 
<a name="l970"><span class="ln">970  </span></a>find_cuda_helper_libs(nppicom) 
<a name="l971"><span class="ln">971  </span></a>find_cuda_helper_libs(nppidei) 
<a name="l972"><span class="ln">972  </span></a>find_cuda_helper_libs(nppif) 
<a name="l973"><span class="ln">973  </span></a>find_cuda_helper_libs(nppig) 
<a name="l974"><span class="ln">974  </span></a>find_cuda_helper_libs(nppim) 
<a name="l975"><span class="ln">975  </span></a>find_cuda_helper_libs(nppist) 
<a name="l976"><span class="ln">976  </span></a>find_cuda_helper_libs(nppisu) 
<a name="l977"><span class="ln">977  </span></a>find_cuda_helper_libs(nppitc) 
<a name="l978"><span class="ln">978  </span></a>find_cuda_helper_libs(npps) 
<a name="l979"><span class="ln">979  </span></a></span><span class="s2">set</span><span class="s1">(CUDA_npp_LIBRARY </span><span class="s3">&quot;${CUDA_nppc_LIBRARY};${CUDA_nppial_LIBRARY};${CUDA_nppicc_LIBRARY};${CUDA_nppicom_LIBRARY};${CUDA_nppidei_LIBRARY};${CUDA_nppif_LIBRARY};${CUDA_nppig_LIBRARY};${CUDA_nppim_LIBRARY};${CUDA_nppist_LIBRARY};${CUDA_nppisu_LIBRARY};${CUDA_nppitc_LIBRARY};${CUDA_npps_LIBRARY}&quot;</span><span class="s1">) 
<a name="l980"><span class="ln">980  </span></a></span><span class="s0"># cusolver showed up in version 7.0</span>
<a name="l981"><span class="ln">981  </span></a><span class="s1">find_cuda_helper_libs(cusolver) 
<a name="l982"><span class="ln">982  </span></a></span>
<a name="l983"><span class="ln">983  </span></a><span class="s2">if </span><span class="s1">(CUDA_BUILD_EMULATION) 
<a name="l984"><span class="ln">984  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_CUFFT_LIBRARIES </span><span class="s2">${CUDA_cufftemu_LIBRARY}</span><span class="s1">) 
<a name="l985"><span class="ln">985  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_CUBLAS_LIBRARIES </span><span class="s2">${CUDA_cublasemu_LIBRARY}</span><span class="s1">) 
<a name="l986"><span class="ln">986  </span></a></span><span class="s2">else</span><span class="s1">() 
<a name="l987"><span class="ln">987  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_CUFFT_LIBRARIES </span><span class="s2">${CUDA_cufft_LIBRARY}</span><span class="s1">) 
<a name="l988"><span class="ln">988  </span></a>  </span><span class="s2">set</span><span class="s1">(CUDA_CUBLAS_LIBRARIES </span><span class="s2">${CUDA_cublas_LIBRARY} ${CUDA_cublas_device_LIBRARY} ${CUDA_cublasLt_LIBRARY}</span><span class="s1">) 
<a name="l989"><span class="ln">989  </span></a></span><span class="s2">endif</span><span class="s1">() 
<a name="l990"><span class="ln">990  </span></a></span>
<a name="l991"><span class="ln">991  </span></a><span class="s0">########################</span>
<a name="l992"><span class="ln">992  </span></a><span class="s0"># Look for the SDK stuff.  As of CUDA 3.0 NVSDKCUDA_ROOT has been replaced with</span>
<a name="l993"><span class="ln">993  </span></a><span class="s0"># NVSDKCOMPUTE_ROOT with the old CUDA C contents moved into the C subdirectory</span>
<a name="l994"><span class="ln">994  </span></a><span class="s2">find_path</span><span class="s1">(CUDA_SDK_ROOT_DIR common/inc/cutil.h 
<a name="l995"><span class="ln">995  </span></a> HINTS 
<a name="l996"><span class="ln">996  </span></a>  </span><span class="s3">&quot;$ENV{NVSDKCOMPUTE_ROOT}/C&quot;</span>
<a name="l997"><span class="ln">997  </span></a>  <span class="s1">ENV NVSDKCUDA_ROOT 
<a name="l998"><span class="ln">998  </span></a>  </span><span class="s3">&quot;[HKEY_LOCAL_MACHINE\\SOFTWARE\\NVIDIA Corporation\\Installed Products\\NVIDIA SDK 10\\Compute;InstallDir]&quot;</span>
<a name="l999"><span class="ln">999  </span></a> <span class="s2">PATHS</span>
<a name="l1000"><span class="ln">1000 </span></a>  <span class="s3">&quot;/Developer/GPU\ Computing/C&quot;</span>
<a name="l1001"><span class="ln">1001 </span></a>  <span class="s1">) 
<a name="l1002"><span class="ln">1002 </span></a></span>
<a name="l1003"><span class="ln">1003 </span></a><span class="s0"># Keep the CUDA_SDK_ROOT_DIR first in order to be able to override the</span>
<a name="l1004"><span class="ln">1004 </span></a><span class="s0"># environment variables.</span>
<a name="l1005"><span class="ln">1005 </span></a><span class="s2">set</span><span class="s1">(CUDA_SDK_SEARCH_PATH 
<a name="l1006"><span class="ln">1006 </span></a>  </span><span class="s3">&quot;${CUDA_SDK_ROOT_DIR}&quot;</span>
<a name="l1007"><span class="ln">1007 </span></a>  <span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR}/local/NVSDK0.2&quot;</span>
<a name="l1008"><span class="ln">1008 </span></a>  <span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR}/NVSDK0.2&quot;</span>
<a name="l1009"><span class="ln">1009 </span></a>  <span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR}/NV_CUDA_SDK&quot;</span>
<a name="l1010"><span class="ln">1010 </span></a>  <span class="s3">&quot;$ENV{HOME}/NVIDIA_CUDA_SDK&quot;</span>
<a name="l1011"><span class="ln">1011 </span></a>  <span class="s3">&quot;$ENV{HOME}/NVIDIA_CUDA_SDK_MACOSX&quot;</span>
<a name="l1012"><span class="ln">1012 </span></a>  <span class="s3">&quot;/Developer/CUDA&quot;</span>
<a name="l1013"><span class="ln">1013 </span></a>  <span class="s1">) 
<a name="l1014"><span class="ln">1014 </span></a></span>
<a name="l1015"><span class="ln">1015 </span></a><span class="s0"># Example of how to find an include file from the CUDA_SDK_ROOT_DIR</span>
<a name="l1016"><span class="ln">1016 </span></a>
<a name="l1017"><span class="ln">1017 </span></a><span class="s0"># find_path(CUDA_CUT_INCLUDE_DIR</span>
<a name="l1018"><span class="ln">1018 </span></a><span class="s0">#   cutil.h</span>
<a name="l1019"><span class="ln">1019 </span></a><span class="s0">#   PATHS ${CUDA_SDK_SEARCH_PATH}</span>
<a name="l1020"><span class="ln">1020 </span></a><span class="s0">#   PATH_SUFFIXES &quot;common/inc&quot;</span>
<a name="l1021"><span class="ln">1021 </span></a><span class="s0">#   DOC &quot;Location of cutil.h&quot;</span>
<a name="l1022"><span class="ln">1022 </span></a><span class="s0">#   NO_DEFAULT_PATH</span>
<a name="l1023"><span class="ln">1023 </span></a><span class="s0">#   )</span>
<a name="l1024"><span class="ln">1024 </span></a><span class="s0"># # Now search system paths</span>
<a name="l1025"><span class="ln">1025 </span></a><span class="s0"># find_path(CUDA_CUT_INCLUDE_DIR cutil.h DOC &quot;Location of cutil.h&quot;)</span>
<a name="l1026"><span class="ln">1026 </span></a>
<a name="l1027"><span class="ln">1027 </span></a><span class="s0"># mark_as_advanced(CUDA_CUT_INCLUDE_DIR)</span>
<a name="l1028"><span class="ln">1028 </span></a>
<a name="l1029"><span class="ln">1029 </span></a>
<a name="l1030"><span class="ln">1030 </span></a><span class="s0"># Example of how to find a library in the CUDA_SDK_ROOT_DIR</span>
<a name="l1031"><span class="ln">1031 </span></a>
<a name="l1032"><span class="ln">1032 </span></a><span class="s0"># # cutil library is called cutil64 for 64 bit builds on windows.  We don't want</span>
<a name="l1033"><span class="ln">1033 </span></a><span class="s0"># # to get these confused, so we are setting the name based on the word size of</span>
<a name="l1034"><span class="ln">1034 </span></a><span class="s0"># # the build.</span>
<a name="l1035"><span class="ln">1035 </span></a>
<a name="l1036"><span class="ln">1036 </span></a><span class="s0"># if(CMAKE_SIZEOF_VOID_P EQUAL 8)</span>
<a name="l1037"><span class="ln">1037 </span></a><span class="s0">#   set(cuda_cutil_name cutil64)</span>
<a name="l1038"><span class="ln">1038 </span></a><span class="s0"># else()</span>
<a name="l1039"><span class="ln">1039 </span></a><span class="s0">#   set(cuda_cutil_name cutil32)</span>
<a name="l1040"><span class="ln">1040 </span></a><span class="s0"># endif()</span>
<a name="l1041"><span class="ln">1041 </span></a>
<a name="l1042"><span class="ln">1042 </span></a><span class="s0"># find_library(CUDA_CUT_LIBRARY</span>
<a name="l1043"><span class="ln">1043 </span></a><span class="s0">#   NAMES cutil ${cuda_cutil_name}</span>
<a name="l1044"><span class="ln">1044 </span></a><span class="s0">#   PATHS ${CUDA_SDK_SEARCH_PATH}</span>
<a name="l1045"><span class="ln">1045 </span></a><span class="s0">#   # The new version of the sdk shows up in common/lib, but the old one is in lib</span>
<a name="l1046"><span class="ln">1046 </span></a><span class="s0">#   PATH_SUFFIXES &quot;common/lib&quot; &quot;lib&quot;</span>
<a name="l1047"><span class="ln">1047 </span></a><span class="s0">#   DOC &quot;Location of cutil library&quot;</span>
<a name="l1048"><span class="ln">1048 </span></a><span class="s0">#   NO_DEFAULT_PATH</span>
<a name="l1049"><span class="ln">1049 </span></a><span class="s0">#   )</span>
<a name="l1050"><span class="ln">1050 </span></a><span class="s0"># # Now search system paths</span>
<a name="l1051"><span class="ln">1051 </span></a><span class="s0"># find_library(CUDA_CUT_LIBRARY NAMES cutil ${cuda_cutil_name} DOC &quot;Location of cutil library&quot;)</span>
<a name="l1052"><span class="ln">1052 </span></a><span class="s0"># mark_as_advanced(CUDA_CUT_LIBRARY)</span>
<a name="l1053"><span class="ln">1053 </span></a><span class="s0"># set(CUDA_CUT_LIBRARIES ${CUDA_CUT_LIBRARY})</span>
<a name="l1054"><span class="ln">1054 </span></a>
<a name="l1055"><span class="ln">1055 </span></a>
<a name="l1056"><span class="ln">1056 </span></a>
<a name="l1057"><span class="ln">1057 </span></a><span class="s0">#############################</span>
<a name="l1058"><span class="ln">1058 </span></a><span class="s0"># Check for required components</span>
<a name="l1059"><span class="ln">1059 </span></a><span class="s2">set</span><span class="s1">(CUDA_FOUND </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l1060"><span class="ln">1060 </span></a></span>
<a name="l1061"><span class="ln">1061 </span></a><span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_ROOT_DIR_INTERNAL </span><span class="s3">&quot;${CUDA_TOOLKIT_ROOT_DIR}&quot; </span><span class="s2">CACHE INTERNAL</span>
<a name="l1062"><span class="ln">1062 </span></a>  <span class="s3">&quot;This is the value of the last time CUDA_TOOLKIT_ROOT_DIR was set successfully.&quot; </span><span class="s1">FORCE) 
<a name="l1063"><span class="ln">1063 </span></a></span><span class="s2">set</span><span class="s1">(CUDA_TOOLKIT_TARGET_DIR_INTERNAL </span><span class="s3">&quot;${CUDA_TOOLKIT_TARGET_DIR}&quot; </span><span class="s2">CACHE INTERNAL</span>
<a name="l1064"><span class="ln">1064 </span></a>  <span class="s3">&quot;This is the value of the last time CUDA_TOOLKIT_TARGET_DIR was set successfully.&quot; </span><span class="s1">FORCE) 
<a name="l1065"><span class="ln">1065 </span></a></span><span class="s2">set</span><span class="s1">(CUDA_SDK_ROOT_DIR_INTERNAL </span><span class="s3">&quot;${CUDA_SDK_ROOT_DIR}&quot; </span><span class="s2">CACHE INTERNAL</span>
<a name="l1066"><span class="ln">1066 </span></a>  <span class="s3">&quot;This is the value of the last time CUDA_SDK_ROOT_DIR was set successfully.&quot; </span><span class="s1">FORCE) 
<a name="l1067"><span class="ln">1067 </span></a></span>
<a name="l1068"><span class="ln">1068 </span></a><span class="s2">include</span><span class="s1">(</span><span class="s2">${CMAKE_CURRENT_LIST_DIR}</span><span class="s1">/FindPackageHandleStandardArgs.cmake) 
<a name="l1069"><span class="ln">1069 </span></a></span>
<a name="l1070"><span class="ln">1070 </span></a><span class="s1">find_package_handle_standard_args(CUDA 
<a name="l1071"><span class="ln">1071 </span></a>  REQUIRED_VARS 
<a name="l1072"><span class="ln">1072 </span></a>    CUDA_TOOLKIT_ROOT_DIR 
<a name="l1073"><span class="ln">1073 </span></a>    CUDA_NVCC_EXECUTABLE 
<a name="l1074"><span class="ln">1074 </span></a>    CUDA_INCLUDE_DIRS 
<a name="l1075"><span class="ln">1075 </span></a>    </span><span class="s2">${CUDA_CUDART_LIBRARY_VAR}</span>
<a name="l1076"><span class="ln">1076 </span></a>  <span class="s1">VERSION_VAR 
<a name="l1077"><span class="ln">1077 </span></a>    CUDA_VERSION 
<a name="l1078"><span class="ln">1078 </span></a>  ) 
<a name="l1079"><span class="ln">1079 </span></a></span>
<a name="l1080"><span class="ln">1080 </span></a>
<a name="l1081"><span class="ln">1081 </span></a>
<a name="l1082"><span class="ln">1082 </span></a><span class="s0">###############################################################################</span>
<a name="l1083"><span class="ln">1083 </span></a><span class="s0">###############################################################################</span>
<a name="l1084"><span class="ln">1084 </span></a><span class="s0"># Macros</span>
<a name="l1085"><span class="ln">1085 </span></a><span class="s0">###############################################################################</span>
<a name="l1086"><span class="ln">1086 </span></a><span class="s0">###############################################################################</span>
<a name="l1087"><span class="ln">1087 </span></a>
<a name="l1088"><span class="ln">1088 </span></a><span class="s0">###############################################################################</span>
<a name="l1089"><span class="ln">1089 </span></a><span class="s0"># Add include directories to pass to the nvcc command.</span>
<a name="l1090"><span class="ln">1090 </span></a><span class="s2">macro</span><span class="s1">(CUDA_INCLUDE_DIRECTORIES) 
<a name="l1091"><span class="ln">1091 </span></a>  </span><span class="s2">foreach</span><span class="s1">(dir </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1092"><span class="ln">1092 </span></a>    </span><span class="s2">list</span><span class="s1">(APPEND CUDA_NVCC_INCLUDE_DIRS_USER </span><span class="s2">${dir}</span><span class="s1">) 
<a name="l1093"><span class="ln">1093 </span></a>  </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1094"><span class="ln">1094 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1095"><span class="ln">1095 </span></a></span>
<a name="l1096"><span class="ln">1096 </span></a>
<a name="l1097"><span class="ln">1097 </span></a><span class="s0">##############################################################################</span>
<a name="l1098"><span class="ln">1098 </span></a><span class="s1">cuda_find_helper_file(parse_cubin cmake) 
<a name="l1099"><span class="ln">1099 </span></a>cuda_find_helper_file(make2cmake cmake) 
<a name="l1100"><span class="ln">1100 </span></a>cuda_find_helper_file(run_nvcc cmake) 
<a name="l1101"><span class="ln">1101 </span></a></span><span class="s2">include</span><span class="s1">(</span><span class="s3">&quot;${CMAKE_CURRENT_LIST_DIR}/FindCUDA/select_compute_arch.cmake&quot;</span><span class="s1">) 
<a name="l1102"><span class="ln">1102 </span></a></span>
<a name="l1103"><span class="ln">1103 </span></a><span class="s0">##############################################################################</span>
<a name="l1104"><span class="ln">1104 </span></a><span class="s0"># Separate the OPTIONS out from the sources</span>
<a name="l1105"><span class="ln">1105 </span></a><span class="s0">#</span>
<a name="l1106"><span class="ln">1106 </span></a><span class="s2">macro</span><span class="s1">(CUDA_GET_SOURCES_AND_OPTIONS _sources _cmake_options _options) 
<a name="l1107"><span class="ln">1107 </span></a>  </span><span class="s2">set</span><span class="s1">( </span><span class="s2">${_sources} </span><span class="s1">) 
<a name="l1108"><span class="ln">1108 </span></a>  </span><span class="s2">set</span><span class="s1">( </span><span class="s2">${_cmake_options} </span><span class="s1">) 
<a name="l1109"><span class="ln">1109 </span></a>  </span><span class="s2">set</span><span class="s1">( </span><span class="s2">${_options} </span><span class="s1">) 
<a name="l1110"><span class="ln">1110 </span></a>  </span><span class="s2">set</span><span class="s1">( _found_options </span><span class="s2">FALSE </span><span class="s1">) 
<a name="l1111"><span class="ln">1111 </span></a>  </span><span class="s2">foreach</span><span class="s1">(arg </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1112"><span class="ln">1112 </span></a>    </span><span class="s2">if</span><span class="s1">(</span><span class="s3">&quot;x${arg}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;xOPTIONS&quot;</span><span class="s1">) 
<a name="l1113"><span class="ln">1113 </span></a>      </span><span class="s2">set</span><span class="s1">( _found_options </span><span class="s2">TRUE </span><span class="s1">) 
<a name="l1114"><span class="ln">1114 </span></a>    </span><span class="s2">elseif</span><span class="s1">( 
<a name="l1115"><span class="ln">1115 </span></a>        </span><span class="s3">&quot;x${arg}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;xWIN32&quot; </span><span class="s2">OR</span>
<a name="l1116"><span class="ln">1116 </span></a>        <span class="s3">&quot;x${arg}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;xMACOSX_BUNDLE&quot; </span><span class="s2">OR</span>
<a name="l1117"><span class="ln">1117 </span></a>        <span class="s3">&quot;x${arg}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;xEXCLUDE_FROM_ALL&quot; </span><span class="s2">OR</span>
<a name="l1118"><span class="ln">1118 </span></a>        <span class="s3">&quot;x${arg}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;xSTATIC&quot; </span><span class="s2">OR</span>
<a name="l1119"><span class="ln">1119 </span></a>        <span class="s3">&quot;x${arg}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;xSHARED&quot; </span><span class="s2">OR</span>
<a name="l1120"><span class="ln">1120 </span></a>        <span class="s3">&quot;x${arg}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;xMODULE&quot;</span>
<a name="l1121"><span class="ln">1121 </span></a>        <span class="s1">) 
<a name="l1122"><span class="ln">1122 </span></a>      </span><span class="s2">list</span><span class="s1">(APPEND </span><span class="s2">${_cmake_options} ${arg}</span><span class="s1">) 
<a name="l1123"><span class="ln">1123 </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l1124"><span class="ln">1124 </span></a>      </span><span class="s2">if </span><span class="s1">( _found_options ) 
<a name="l1125"><span class="ln">1125 </span></a>        </span><span class="s2">list</span><span class="s1">(APPEND </span><span class="s2">${_options} ${arg}</span><span class="s1">) 
<a name="l1126"><span class="ln">1126 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1127"><span class="ln">1127 </span></a>        </span><span class="s0"># Assume this is a file</span>
<a name="l1128"><span class="ln">1128 </span></a>        <span class="s2">list</span><span class="s1">(APPEND </span><span class="s2">${_sources} ${arg}</span><span class="s1">) 
<a name="l1129"><span class="ln">1129 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1130"><span class="ln">1130 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1131"><span class="ln">1131 </span></a>  </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1132"><span class="ln">1132 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1133"><span class="ln">1133 </span></a></span>
<a name="l1134"><span class="ln">1134 </span></a><span class="s0">##############################################################################</span>
<a name="l1135"><span class="ln">1135 </span></a><span class="s0"># Parse the OPTIONS from ARGN and set the variables prefixed by _option_prefix</span>
<a name="l1136"><span class="ln">1136 </span></a><span class="s0">#</span>
<a name="l1137"><span class="ln">1137 </span></a><span class="s2">macro</span><span class="s1">(CUDA_PARSE_NVCC_OPTIONS _option_prefix) 
<a name="l1138"><span class="ln">1138 </span></a>  </span><span class="s2">set</span><span class="s1">( _found_config ) 
<a name="l1139"><span class="ln">1139 </span></a>  </span><span class="s2">foreach</span><span class="s1">(arg </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1140"><span class="ln">1140 </span></a>    </span><span class="s0"># Determine if we are dealing with a perconfiguration flag</span>
<a name="l1141"><span class="ln">1141 </span></a>    <span class="s2">foreach</span><span class="s1">(config </span><span class="s2">${CUDA_configuration_types}</span><span class="s1">) 
<a name="l1142"><span class="ln">1142 </span></a>      </span><span class="s2">string</span><span class="s1">(TOUPPER </span><span class="s2">${config} </span><span class="s1">config_upper) 
<a name="l1143"><span class="ln">1143 </span></a>      </span><span class="s2">if </span><span class="s1">(arg </span><span class="s2">STREQUAL </span><span class="s3">&quot;${config_upper}&quot;</span><span class="s1">) 
<a name="l1144"><span class="ln">1144 </span></a>        </span><span class="s2">set</span><span class="s1">( _found_config _</span><span class="s2">${arg}</span><span class="s1">) 
<a name="l1145"><span class="ln">1145 </span></a>        </span><span class="s0"># Set arg to nothing to keep it from being processed further</span>
<a name="l1146"><span class="ln">1146 </span></a>        <span class="s2">set</span><span class="s1">( arg ) 
<a name="l1147"><span class="ln">1147 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1148"><span class="ln">1148 </span></a>    </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1149"><span class="ln">1149 </span></a></span>
<a name="l1150"><span class="ln">1150 </span></a>    <span class="s2">if </span><span class="s1">( arg ) 
<a name="l1151"><span class="ln">1151 </span></a>      </span><span class="s2">list</span><span class="s1">(APPEND </span><span class="s2">${_option_prefix}${_found_config} </span><span class="s3">&quot;${arg}&quot;</span><span class="s1">) 
<a name="l1152"><span class="ln">1152 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1153"><span class="ln">1153 </span></a>  </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1154"><span class="ln">1154 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1155"><span class="ln">1155 </span></a></span>
<a name="l1156"><span class="ln">1156 </span></a><span class="s0">##############################################################################</span>
<a name="l1157"><span class="ln">1157 </span></a><span class="s0"># Helper to add the include directory for CUDA only once</span>
<a name="l1158"><span class="ln">1158 </span></a><span class="s2">function</span><span class="s1">(CUDA_ADD_CUDA_INCLUDE_ONCE) 
<a name="l1159"><span class="ln">1159 </span></a>  </span><span class="s2">get_directory_property</span><span class="s1">(_include_directories </span><span class="s5">INCLUDE_DIRECTORIES</span><span class="s1">) 
<a name="l1160"><span class="ln">1160 </span></a>  </span><span class="s2">set</span><span class="s1">(_add </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l1161"><span class="ln">1161 </span></a>  </span><span class="s2">if</span><span class="s1">(_include_directories) 
<a name="l1162"><span class="ln">1162 </span></a>    </span><span class="s2">foreach</span><span class="s1">(dir </span><span class="s2">${_include_directories}</span><span class="s1">) 
<a name="l1163"><span class="ln">1163 </span></a>      </span><span class="s2">if</span><span class="s1">(</span><span class="s3">&quot;${dir}&quot; </span><span class="s2">STREQUAL </span><span class="s3">&quot;${CUDA_INCLUDE_DIRS}&quot;</span><span class="s1">) 
<a name="l1164"><span class="ln">1164 </span></a>        </span><span class="s2">set</span><span class="s1">(_add </span><span class="s2">FALSE</span><span class="s1">) 
<a name="l1165"><span class="ln">1165 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1166"><span class="ln">1166 </span></a>    </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1167"><span class="ln">1167 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1168"><span class="ln">1168 </span></a>  </span><span class="s2">if</span><span class="s1">(_add) 
<a name="l1169"><span class="ln">1169 </span></a>    </span><span class="s2">include_directories</span><span class="s1">(</span><span class="s2">${CUDA_INCLUDE_DIRS}</span><span class="s1">) 
<a name="l1170"><span class="ln">1170 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1171"><span class="ln">1171 </span></a></span><span class="s2">endfunction</span><span class="s1">() 
<a name="l1172"><span class="ln">1172 </span></a></span>
<a name="l1173"><span class="ln">1173 </span></a><span class="s2">function</span><span class="s1">(CUDA_BUILD_SHARED_LIBRARY shared_flag) 
<a name="l1174"><span class="ln">1174 </span></a>  </span><span class="s2">set</span><span class="s1">(cmake_args </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1175"><span class="ln">1175 </span></a>  </span><span class="s0"># If SHARED, MODULE, or STATIC aren't already in the list of arguments, then</span>
<a name="l1176"><span class="ln">1176 </span></a>  <span class="s0"># add SHARED or STATIC based on the value of BUILD_SHARED_LIBS.</span>
<a name="l1177"><span class="ln">1177 </span></a>  <span class="s2">list</span><span class="s1">(FIND cmake_args SHARED _cuda_found_SHARED) 
<a name="l1178"><span class="ln">1178 </span></a>  </span><span class="s2">list</span><span class="s1">(FIND cmake_args MODULE _cuda_found_MODULE) 
<a name="l1179"><span class="ln">1179 </span></a>  </span><span class="s2">list</span><span class="s1">(FIND cmake_args STATIC _cuda_found_STATIC) 
<a name="l1180"><span class="ln">1180 </span></a>  </span><span class="s2">if</span><span class="s1">( _cuda_found_SHARED </span><span class="s2">GREATER </span><span class="s1">-1 </span><span class="s2">OR</span>
<a name="l1181"><span class="ln">1181 </span></a>      <span class="s1">_cuda_found_MODULE </span><span class="s2">GREATER </span><span class="s1">-1 </span><span class="s2">OR</span>
<a name="l1182"><span class="ln">1182 </span></a>      <span class="s1">_cuda_found_STATIC </span><span class="s2">GREATER </span><span class="s1">-1) 
<a name="l1183"><span class="ln">1183 </span></a>    </span><span class="s2">set</span><span class="s1">(_cuda_build_shared_libs) 
<a name="l1184"><span class="ln">1184 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1185"><span class="ln">1185 </span></a>    </span><span class="s2">if </span><span class="s1">(</span><span class="s4">BUILD_SHARED_LIBS</span><span class="s1">) 
<a name="l1186"><span class="ln">1186 </span></a>      </span><span class="s2">set</span><span class="s1">(_cuda_build_shared_libs SHARED) 
<a name="l1187"><span class="ln">1187 </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l1188"><span class="ln">1188 </span></a>      </span><span class="s2">set</span><span class="s1">(_cuda_build_shared_libs STATIC) 
<a name="l1189"><span class="ln">1189 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1190"><span class="ln">1190 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1191"><span class="ln">1191 </span></a>  </span><span class="s2">set</span><span class="s1">(</span><span class="s2">${shared_flag} ${_cuda_build_shared_libs} </span><span class="s1">PARENT_SCOPE) 
<a name="l1192"><span class="ln">1192 </span></a></span><span class="s2">endfunction</span><span class="s1">() 
<a name="l1193"><span class="ln">1193 </span></a></span>
<a name="l1194"><span class="ln">1194 </span></a><span class="s0">##############################################################################</span>
<a name="l1195"><span class="ln">1195 </span></a><span class="s0"># Helper to avoid clashes of files with the same basename but different paths.</span>
<a name="l1196"><span class="ln">1196 </span></a><span class="s0"># This doesn't attempt to do exactly what CMake internals do, which is to only</span>
<a name="l1197"><span class="ln">1197 </span></a><span class="s0"># add this path when there is a conflict, since by the time a second collision</span>
<a name="l1198"><span class="ln">1198 </span></a><span class="s0"># in names is detected it's already too late to fix the first one.  For</span>
<a name="l1199"><span class="ln">1199 </span></a><span class="s0"># consistency sake the relative path will be added to all files.</span>
<a name="l1200"><span class="ln">1200 </span></a><span class="s2">function</span><span class="s1">(CUDA_COMPUTE_BUILD_PATH </span><span class="s2">path </span><span class="s1">build_path) 
<a name="l1201"><span class="ln">1201 </span></a>  </span><span class="s0">#message(&quot;CUDA_COMPUTE_BUILD_PATH([${path}] ${build_path})&quot;)</span>
<a name="l1202"><span class="ln">1202 </span></a>  <span class="s0"># Only deal with CMake style paths from here on out</span>
<a name="l1203"><span class="ln">1203 </span></a>  <span class="s2">file</span><span class="s1">(TO_CMAKE_PATH </span><span class="s3">&quot;${path}&quot; </span><span class="s1">bpath) 
<a name="l1204"><span class="ln">1204 </span></a>  </span><span class="s2">if </span><span class="s1">(</span><span class="s2">IS_ABSOLUTE </span><span class="s3">&quot;${bpath}&quot;</span><span class="s1">) 
<a name="l1205"><span class="ln">1205 </span></a>    </span><span class="s0"># Absolute paths are generally unnecessary, especially if something like</span>
<a name="l1206"><span class="ln">1206 </span></a>    <span class="s0"># file(GLOB_RECURSE) is used to pick up the files.</span>
<a name="l1207"><span class="ln">1207 </span></a>
<a name="l1208"><span class="ln">1208 </span></a>    <span class="s2">string</span><span class="s1">(FIND </span><span class="s3">&quot;${bpath}&quot; &quot;${CMAKE_CURRENT_BINARY_DIR}&quot; </span><span class="s1">_binary_dir_pos) 
<a name="l1209"><span class="ln">1209 </span></a>    </span><span class="s2">if </span><span class="s1">(_binary_dir_pos </span><span class="s2">EQUAL </span><span class="s1">0) 
<a name="l1210"><span class="ln">1210 </span></a>      </span><span class="s2">file</span><span class="s1">(RELATIVE_PATH bpath </span><span class="s3">&quot;${CMAKE_CURRENT_BINARY_DIR}&quot; &quot;${bpath}&quot;</span><span class="s1">) 
<a name="l1211"><span class="ln">1211 </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l1212"><span class="ln">1212 </span></a>      </span><span class="s2">file</span><span class="s1">(RELATIVE_PATH bpath </span><span class="s3">&quot;${CMAKE_CURRENT_SOURCE_DIR}&quot; &quot;${bpath}&quot;</span><span class="s1">) 
<a name="l1213"><span class="ln">1213 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1214"><span class="ln">1214 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1215"><span class="ln">1215 </span></a></span>
<a name="l1216"><span class="ln">1216 </span></a>  <span class="s0"># This recipe is from cmLocalGenerator::CreateSafeUniqueObjectFileName in the</span>
<a name="l1217"><span class="ln">1217 </span></a>  <span class="s0"># CMake source.</span>
<a name="l1218"><span class="ln">1218 </span></a>
<a name="l1219"><span class="ln">1219 </span></a>  <span class="s0"># Remove leading /</span>
<a name="l1220"><span class="ln">1220 </span></a>  <span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;^[/]+&quot; &quot;&quot; </span><span class="s1">bpath </span><span class="s3">&quot;${bpath}&quot;</span><span class="s1">) 
<a name="l1221"><span class="ln">1221 </span></a>  </span><span class="s0"># Avoid absolute paths by removing ':'</span>
<a name="l1222"><span class="ln">1222 </span></a>  <span class="s2">string</span><span class="s1">(REPLACE </span><span class="s3">&quot;:&quot; &quot;_&quot; </span><span class="s1">bpath </span><span class="s3">&quot;${bpath}&quot;</span><span class="s1">) 
<a name="l1223"><span class="ln">1223 </span></a>  </span><span class="s0"># Avoid relative paths that go up the tree</span>
<a name="l1224"><span class="ln">1224 </span></a>  <span class="s2">string</span><span class="s1">(REPLACE </span><span class="s3">&quot;../&quot; &quot;__/&quot; </span><span class="s1">bpath </span><span class="s3">&quot;${bpath}&quot;</span><span class="s1">) 
<a name="l1225"><span class="ln">1225 </span></a>  </span><span class="s0"># Avoid spaces</span>
<a name="l1226"><span class="ln">1226 </span></a>  <span class="s2">string</span><span class="s1">(REPLACE </span><span class="s3">&quot; &quot; &quot;_&quot; </span><span class="s1">bpath </span><span class="s3">&quot;${bpath}&quot;</span><span class="s1">) 
<a name="l1227"><span class="ln">1227 </span></a></span>
<a name="l1228"><span class="ln">1228 </span></a>  <span class="s0"># Strip off the filename.  I wait until here to do it, since removing the</span>
<a name="l1229"><span class="ln">1229 </span></a>  <span class="s0"># basename can make a path that looked like path/../basename turn into</span>
<a name="l1230"><span class="ln">1230 </span></a>  <span class="s0"># path/.. (notice the trailing slash).</span>
<a name="l1231"><span class="ln">1231 </span></a>  <span class="s2">get_filename_component</span><span class="s1">(bpath </span><span class="s3">&quot;${bpath}&quot; </span><span class="s2">PATH</span><span class="s1">) 
<a name="l1232"><span class="ln">1232 </span></a></span>
<a name="l1233"><span class="ln">1233 </span></a>  <span class="s2">set</span><span class="s1">(</span><span class="s2">${build_path} </span><span class="s3">&quot;${bpath}&quot; </span><span class="s1">PARENT_SCOPE) 
<a name="l1234"><span class="ln">1234 </span></a>  </span><span class="s0">#message(&quot;${build_path} = ${bpath}&quot;)</span>
<a name="l1235"><span class="ln">1235 </span></a><span class="s2">endfunction</span><span class="s1">() 
<a name="l1236"><span class="ln">1236 </span></a></span>
<a name="l1237"><span class="ln">1237 </span></a><span class="s0">##############################################################################</span>
<a name="l1238"><span class="ln">1238 </span></a><span class="s0"># This helper macro populates the following variables and setups up custom</span>
<a name="l1239"><span class="ln">1239 </span></a><span class="s0"># commands and targets to invoke the nvcc compiler to generate C or PTX source</span>
<a name="l1240"><span class="ln">1240 </span></a><span class="s0"># dependent upon the format parameter.  The compiler is invoked once with -M</span>
<a name="l1241"><span class="ln">1241 </span></a><span class="s0"># to generate a dependency file and a second time with -cuda or -ptx to generate</span>
<a name="l1242"><span class="ln">1242 </span></a><span class="s0"># a .cpp or .ptx file.</span>
<a name="l1243"><span class="ln">1243 </span></a><span class="s0"># INPUT:</span>
<a name="l1244"><span class="ln">1244 </span></a><span class="s0">#   cuda_target         - Target name</span>
<a name="l1245"><span class="ln">1245 </span></a><span class="s0">#   format              - PTX, CUBIN, FATBIN or OBJ</span>
<a name="l1246"><span class="ln">1246 </span></a><span class="s0">#   FILE1 .. FILEN      - The remaining arguments are the sources to be wrapped.</span>
<a name="l1247"><span class="ln">1247 </span></a><span class="s0">#   OPTIONS             - Extra options to NVCC</span>
<a name="l1248"><span class="ln">1248 </span></a><span class="s0"># OUTPUT:</span>
<a name="l1249"><span class="ln">1249 </span></a><span class="s0">#   generated_files     - List of generated files</span>
<a name="l1250"><span class="ln">1250 </span></a><span class="s0">##############################################################################</span>
<a name="l1251"><span class="ln">1251 </span></a><span class="s0">##############################################################################</span>
<a name="l1252"><span class="ln">1252 </span></a>
<a name="l1253"><span class="ln">1253 </span></a><span class="s2">macro</span><span class="s1">(CUDA_WRAP_SRCS cuda_target format generated_files) 
<a name="l1254"><span class="ln">1254 </span></a></span>
<a name="l1255"><span class="ln">1255 </span></a>  <span class="s0"># Put optional arguments in list.</span>
<a name="l1256"><span class="ln">1256 </span></a>  <span class="s2">set</span><span class="s1">(_argn_list </span><span class="s3">&quot;${ARGN}&quot;</span><span class="s1">) 
<a name="l1257"><span class="ln">1257 </span></a>  </span><span class="s0"># If one of the given optional arguments is &quot;PHONY&quot;, make a note of it, then</span>
<a name="l1258"><span class="ln">1258 </span></a>  <span class="s0"># remove it from the list.</span>
<a name="l1259"><span class="ln">1259 </span></a>  <span class="s2">list</span><span class="s1">(FIND _argn_list </span><span class="s3">&quot;PHONY&quot; </span><span class="s1">_phony_idx) 
<a name="l1260"><span class="ln">1260 </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s3">&quot;${_phony_idx}&quot; </span><span class="s2">GREATER </span><span class="s3">&quot;-1&quot;</span><span class="s1">) 
<a name="l1261"><span class="ln">1261 </span></a>    </span><span class="s2">set</span><span class="s1">(_target_is_phony </span><span class="s2">true</span><span class="s1">) 
<a name="l1262"><span class="ln">1262 </span></a>    </span><span class="s2">list</span><span class="s1">(REMOVE_AT _argn_list </span><span class="s2">${_phony_idx}</span><span class="s1">) 
<a name="l1263"><span class="ln">1263 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1264"><span class="ln">1264 </span></a>    </span><span class="s2">set</span><span class="s1">(_target_is_phony </span><span class="s2">false</span><span class="s1">) 
<a name="l1265"><span class="ln">1265 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1266"><span class="ln">1266 </span></a></span>
<a name="l1267"><span class="ln">1267 </span></a>  <span class="s0"># If CMake doesn't support separable compilation, complain</span>
<a name="l1268"><span class="ln">1268 </span></a>  <span class="s2">if</span><span class="s1">(CUDA_SEPARABLE_COMPILATION </span><span class="s2">AND </span><span class="s4">CMAKE_VERSION </span><span class="s2">VERSION_LESS </span><span class="s3">&quot;2.8.10.1&quot;</span><span class="s1">) 
<a name="l1269"><span class="ln">1269 </span></a>    </span><span class="s2">message</span><span class="s1">(SEND_ERROR </span><span class="s3">&quot;CUDA_SEPARABLE_COMPILATION isn't supported for CMake versions less than 2.8.10.1&quot;</span><span class="s1">) 
<a name="l1270"><span class="ln">1270 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1271"><span class="ln">1271 </span></a></span>
<a name="l1272"><span class="ln">1272 </span></a>  <span class="s0"># Set up all the command line flags here, so that they can be overridden on a per target basis.</span>
<a name="l1273"><span class="ln">1273 </span></a>
<a name="l1274"><span class="ln">1274 </span></a>  <span class="s2">set</span><span class="s1">(nvcc_flags </span><span class="s3">&quot;&quot;</span><span class="s1">) 
<a name="l1275"><span class="ln">1275 </span></a></span>
<a name="l1276"><span class="ln">1276 </span></a>  <span class="s0"># Emulation if the card isn't present.</span>
<a name="l1277"><span class="ln">1277 </span></a>  <span class="s2">if </span><span class="s1">(CUDA_BUILD_EMULATION) 
<a name="l1278"><span class="ln">1278 </span></a>    </span><span class="s0"># Emulation.</span>
<a name="l1279"><span class="ln">1279 </span></a>    <span class="s2">set</span><span class="s1">(nvcc_flags </span><span class="s2">${nvcc_flags} </span><span class="s1">--device-emulation -D_DEVICEEMU -g) 
<a name="l1280"><span class="ln">1280 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1281"><span class="ln">1281 </span></a>    </span><span class="s0"># Device mode.  No flags necessary.</span>
<a name="l1282"><span class="ln">1282 </span></a>  <span class="s2">endif</span><span class="s1">() 
<a name="l1283"><span class="ln">1283 </span></a></span>
<a name="l1284"><span class="ln">1284 </span></a>  <span class="s2">if</span><span class="s1">(CUDA_HOST_COMPILATION_CPP) 
<a name="l1285"><span class="ln">1285 </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_C_OR_CXX CXX) 
<a name="l1286"><span class="ln">1286 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1287"><span class="ln">1287 </span></a>    </span><span class="s2">message</span><span class="s1">(WARNING </span><span class="s3">&quot;--host-compilation flag is deprecated in CUDA version &gt;= 3.0.  Removing --host-compilation C flag&quot; </span><span class="s1">) 
<a name="l1288"><span class="ln">1288 </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_C_OR_CXX C) 
<a name="l1289"><span class="ln">1289 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1290"><span class="ln">1290 </span></a></span>
<a name="l1291"><span class="ln">1291 </span></a>  <span class="s2">set</span><span class="s1">(generated_extension ${CMAKE_</span><span class="s2">${CUDA_C_OR_CXX}</span><span class="s1">_OUTPUT_EXTENSION}) 
<a name="l1292"><span class="ln">1292 </span></a></span>
<a name="l1293"><span class="ln">1293 </span></a>  <span class="s2">if</span><span class="s1">(CUDA_64_BIT_DEVICE_CODE) 
<a name="l1294"><span class="ln">1294 </span></a>    </span><span class="s2">set</span><span class="s1">(nvcc_flags </span><span class="s2">${nvcc_flags} </span><span class="s1">-m64) 
<a name="l1295"><span class="ln">1295 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1296"><span class="ln">1296 </span></a>    </span><span class="s2">set</span><span class="s1">(nvcc_flags </span><span class="s2">${nvcc_flags} </span><span class="s1">-m32) 
<a name="l1297"><span class="ln">1297 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1298"><span class="ln">1298 </span></a></span>
<a name="l1299"><span class="ln">1299 </span></a>  <span class="s2">if</span><span class="s1">(CUDA_TARGET_CPU_ARCH) 
<a name="l1300"><span class="ln">1300 </span></a>    </span><span class="s2">set</span><span class="s1">(nvcc_flags </span><span class="s2">${nvcc_flags} </span><span class="s3">&quot;--target-cpu-architecture=${CUDA_TARGET_CPU_ARCH}&quot;</span><span class="s1">) 
<a name="l1301"><span class="ln">1301 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1302"><span class="ln">1302 </span></a></span>
<a name="l1303"><span class="ln">1303 </span></a>  <span class="s0"># This needs to be passed in at this stage, because VS needs to fill out the</span>
<a name="l1304"><span class="ln">1304 </span></a>  <span class="s0"># various macros from within VS.  Note that CCBIN is only used if</span>
<a name="l1305"><span class="ln">1305 </span></a>  <span class="s0"># -ccbin or --compiler-bindir isn't used and CUDA_HOST_COMPILER matches</span>
<a name="l1306"><span class="ln">1306 </span></a>  <span class="s0"># _CUDA_MSVC_HOST_COMPILER</span>
<a name="l1307"><span class="ln">1307 </span></a>  <span class="s2">if</span><span class="s1">(</span><span class="s4">CMAKE_GENERATOR </span><span class="s2">MATCHES </span><span class="s3">&quot;Visual Studio&quot;</span><span class="s1">) 
<a name="l1308"><span class="ln">1308 </span></a>    </span><span class="s2">set</span><span class="s1">(ccbin_flags -D </span><span class="s3">&quot;\&quot;CCBIN:PATH=${_CUDA_MSVC_HOST_COMPILER}\&quot;&quot; </span><span class="s1">) 
<a name="l1309"><span class="ln">1309 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1310"><span class="ln">1310 </span></a>    </span><span class="s2">set</span><span class="s1">(ccbin_flags) 
<a name="l1311"><span class="ln">1311 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1312"><span class="ln">1312 </span></a></span>
<a name="l1313"><span class="ln">1313 </span></a>  <span class="s0"># Figure out which configure we will use and pass that in as an argument to</span>
<a name="l1314"><span class="ln">1314 </span></a>  <span class="s0"># the script.  We need to defer the decision until compilation time, because</span>
<a name="l1315"><span class="ln">1315 </span></a>  <span class="s0"># for VS projects we won't know if we are making a debug or release build</span>
<a name="l1316"><span class="ln">1316 </span></a>  <span class="s0"># until build time.</span>
<a name="l1317"><span class="ln">1317 </span></a>  <span class="s2">if</span><span class="s1">(</span><span class="s4">CMAKE_GENERATOR </span><span class="s2">MATCHES </span><span class="s3">&quot;Visual Studio&quot;</span><span class="s1">) 
<a name="l1318"><span class="ln">1318 </span></a>    </span><span class="s2">set</span><span class="s1">( CUDA_build_configuration </span><span class="s3">&quot;$(ConfigurationName)&quot; </span><span class="s1">) 
<a name="l1319"><span class="ln">1319 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1320"><span class="ln">1320 </span></a>    </span><span class="s2">set</span><span class="s1">( CUDA_build_configuration </span><span class="s3">&quot;${CMAKE_BUILD_TYPE}&quot;</span><span class="s1">) 
<a name="l1321"><span class="ln">1321 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1322"><span class="ln">1322 </span></a></span>
<a name="l1323"><span class="ln">1323 </span></a>  <span class="s0"># Initialize our list of includes with the user ones followed by the CUDA system ones.</span>
<a name="l1324"><span class="ln">1324 </span></a>  <span class="s2">set</span><span class="s1">(CUDA_NVCC_INCLUDE_DIRS </span><span class="s2">${CUDA_NVCC_INCLUDE_DIRS_USER} </span><span class="s3">&quot;${CUDA_INCLUDE_DIRS}&quot;</span><span class="s1">) 
<a name="l1325"><span class="ln">1325 </span></a>  </span><span class="s2">if</span><span class="s1">(_target_is_phony) 
<a name="l1326"><span class="ln">1326 </span></a>    </span><span class="s0"># If the passed in target name isn't a real target (i.e., this is from a call to one of the</span>
<a name="l1327"><span class="ln">1327 </span></a>    <span class="s0"># cuda_compile_* functions), need to query directory properties to get include directories</span>
<a name="l1328"><span class="ln">1328 </span></a>    <span class="s0"># and compile definitions.</span>
<a name="l1329"><span class="ln">1329 </span></a>    <span class="s2">get_directory_property</span><span class="s1">(_dir_include_dirs </span><span class="s5">INCLUDE_DIRECTORIES</span><span class="s1">) 
<a name="l1330"><span class="ln">1330 </span></a>    </span><span class="s2">get_directory_property</span><span class="s1">(_dir_compile_defs </span><span class="s5">COMPILE_DEFINITIONS</span><span class="s1">) 
<a name="l1331"><span class="ln">1331 </span></a></span>
<a name="l1332"><span class="ln">1332 </span></a>    <span class="s2">list</span><span class="s1">(APPEND CUDA_NVCC_INCLUDE_DIRS </span><span class="s3">&quot;${_dir_include_dirs}&quot;</span><span class="s1">) 
<a name="l1333"><span class="ln">1333 </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_NVCC_COMPILE_DEFINITIONS </span><span class="s3">&quot;${_dir_compile_defs}&quot;</span><span class="s1">) 
<a name="l1334"><span class="ln">1334 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1335"><span class="ln">1335 </span></a>    </span><span class="s0"># Append the include directories for this target via generator expression, which is</span>
<a name="l1336"><span class="ln">1336 </span></a>    <span class="s0"># expanded by the FILE(GENERATE) call below.  This generator expression captures all</span>
<a name="l1337"><span class="ln">1337 </span></a>    <span class="s0"># include dirs set by the user, whether via directory properties or target properties</span>
<a name="l1338"><span class="ln">1338 </span></a>    <span class="s2">list</span><span class="s1">(APPEND CUDA_NVCC_INCLUDE_DIRS </span><span class="s3">&quot;$&lt;TARGET_PROPERTY:${cuda_target},INCLUDE_DIRECTORIES&gt;&quot;</span><span class="s1">) 
<a name="l1339"><span class="ln">1339 </span></a></span>
<a name="l1340"><span class="ln">1340 </span></a>    <span class="s0"># Do the same thing with compile definitions</span>
<a name="l1341"><span class="ln">1341 </span></a>    <span class="s2">set</span><span class="s1">(CUDA_NVCC_COMPILE_DEFINITIONS </span><span class="s3">&quot;$&lt;TARGET_PROPERTY:${cuda_target},COMPILE_DEFINITIONS&gt;&quot;</span><span class="s1">) 
<a name="l1342"><span class="ln">1342 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1343"><span class="ln">1343 </span></a></span>
<a name="l1344"><span class="ln">1344 </span></a>
<a name="l1345"><span class="ln">1345 </span></a>  <span class="s0"># Reset these variables</span>
<a name="l1346"><span class="ln">1346 </span></a>  <span class="s2">set</span><span class="s1">(CUDA_WRAP_OPTION_NVCC_FLAGS) 
<a name="l1347"><span class="ln">1347 </span></a>  </span><span class="s2">foreach</span><span class="s1">(config </span><span class="s2">${CUDA_configuration_types}</span><span class="s1">) 
<a name="l1348"><span class="ln">1348 </span></a>    </span><span class="s2">string</span><span class="s1">(TOUPPER </span><span class="s2">${config} </span><span class="s1">config_upper) 
<a name="l1349"><span class="ln">1349 </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_WRAP_OPTION_NVCC_FLAGS_</span><span class="s2">${config_upper}</span><span class="s1">) 
<a name="l1350"><span class="ln">1350 </span></a>  </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1351"><span class="ln">1351 </span></a></span>
<a name="l1352"><span class="ln">1352 </span></a>  <span class="s1">CUDA_GET_SOURCES_AND_OPTIONS(_cuda_wrap_sources _cuda_wrap_cmake_options _cuda_wrap_options </span><span class="s2">${_argn_list}</span><span class="s1">) 
<a name="l1353"><span class="ln">1353 </span></a>  CUDA_PARSE_NVCC_OPTIONS(CUDA_WRAP_OPTION_NVCC_FLAGS </span><span class="s2">${_cuda_wrap_options}</span><span class="s1">) 
<a name="l1354"><span class="ln">1354 </span></a></span>
<a name="l1355"><span class="ln">1355 </span></a>  <span class="s0"># Figure out if we are building a shared library.  BUILD_SHARED_LIBS is</span>
<a name="l1356"><span class="ln">1356 </span></a>  <span class="s0"># respected in CUDA_ADD_LIBRARY.</span>
<a name="l1357"><span class="ln">1357 </span></a>  <span class="s2">set</span><span class="s1">(_cuda_build_shared_libs </span><span class="s2">FALSE</span><span class="s1">) 
<a name="l1358"><span class="ln">1358 </span></a>  </span><span class="s0"># SHARED, MODULE</span>
<a name="l1359"><span class="ln">1359 </span></a>  <span class="s2">list</span><span class="s1">(FIND _cuda_wrap_cmake_options SHARED _cuda_found_SHARED) 
<a name="l1360"><span class="ln">1360 </span></a>  </span><span class="s2">list</span><span class="s1">(FIND _cuda_wrap_cmake_options MODULE _cuda_found_MODULE) 
<a name="l1361"><span class="ln">1361 </span></a>  </span><span class="s2">if</span><span class="s1">(_cuda_found_SHARED </span><span class="s2">GREATER </span><span class="s1">-1 </span><span class="s2">OR </span><span class="s1">_cuda_found_MODULE </span><span class="s2">GREATER </span><span class="s1">-1) 
<a name="l1362"><span class="ln">1362 </span></a>    </span><span class="s2">set</span><span class="s1">(_cuda_build_shared_libs </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l1363"><span class="ln">1363 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1364"><span class="ln">1364 </span></a>  </span><span class="s0"># STATIC</span>
<a name="l1365"><span class="ln">1365 </span></a>  <span class="s2">list</span><span class="s1">(FIND _cuda_wrap_cmake_options STATIC _cuda_found_STATIC) 
<a name="l1366"><span class="ln">1366 </span></a>  </span><span class="s2">if</span><span class="s1">(_cuda_found_STATIC </span><span class="s2">GREATER </span><span class="s1">-1) 
<a name="l1367"><span class="ln">1367 </span></a>    </span><span class="s2">set</span><span class="s1">(_cuda_build_shared_libs </span><span class="s2">FALSE</span><span class="s1">) 
<a name="l1368"><span class="ln">1368 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1369"><span class="ln">1369 </span></a></span>
<a name="l1370"><span class="ln">1370 </span></a>  <span class="s0"># CUDA_HOST_FLAGS</span>
<a name="l1371"><span class="ln">1371 </span></a>  <span class="s2">if</span><span class="s1">(_cuda_build_shared_libs) 
<a name="l1372"><span class="ln">1372 </span></a>    </span><span class="s0"># If we are setting up code for a shared library, then we need to add extra flags for</span>
<a name="l1373"><span class="ln">1373 </span></a>    <span class="s0"># compiling objects for shared libraries.</span>
<a name="l1374"><span class="ln">1374 </span></a>    <span class="s2">set</span><span class="s1">(CUDA_HOST_SHARED_FLAGS ${CMAKE_SHARED_LIBRARY_</span><span class="s2">${CUDA_C_OR_CXX}</span><span class="s1">_FLAGS}) 
<a name="l1375"><span class="ln">1375 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1376"><span class="ln">1376 </span></a>    </span><span class="s2">set</span><span class="s1">(CUDA_HOST_SHARED_FLAGS) 
<a name="l1377"><span class="ln">1377 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1378"><span class="ln">1378 </span></a></span>
<a name="l1379"><span class="ln">1379 </span></a>  <span class="s2">macro</span><span class="s1">(_filter_blocklisted_host_flags CUDA_FLAGS) 
<a name="l1380"><span class="ln">1380 </span></a>    </span><span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;[ \t]+&quot; &quot;;&quot; </span><span class="s2">${CUDA_FLAGS} </span><span class="s3">&quot;${${CUDA_FLAGS}}&quot;</span><span class="s1">) 
<a name="l1381"><span class="ln">1381 </span></a>    </span><span class="s2">foreach</span><span class="s1">(_blacklisted </span><span class="s2">${CUDA_PROPAGATE_HOST_FLAGS_BLACKLIST}</span><span class="s1">) 
<a name="l1382"><span class="ln">1382 </span></a>      </span><span class="s2">list</span><span class="s1">(REMOVE_ITEM </span><span class="s2">${CUDA_FLAGS} </span><span class="s3">&quot;${_blacklisted}&quot;</span><span class="s1">) 
<a name="l1383"><span class="ln">1383 </span></a>    </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1384"><span class="ln">1384 </span></a>    </span><span class="s2">string</span><span class="s1">(REPLACE </span><span class="s3">&quot;;&quot; &quot; &quot; </span><span class="s2">${CUDA_FLAGS} </span><span class="s3">&quot;${${CUDA_FLAGS}}&quot;</span><span class="s1">) 
<a name="l1385"><span class="ln">1385 </span></a>  </span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1386"><span class="ln">1386 </span></a></span>
<a name="l1387"><span class="ln">1387 </span></a>  <span class="s0"># Only add the CMAKE_{C,CXX}_FLAGS if we are propagating host flags.  We</span>
<a name="l1388"><span class="ln">1388 </span></a>  <span class="s0"># always need to set the SHARED_FLAGS, though.</span>
<a name="l1389"><span class="ln">1389 </span></a>  <span class="s2">if</span><span class="s1">(CUDA_PROPAGATE_HOST_FLAGS) 
<a name="l1390"><span class="ln">1390 </span></a>    </span><span class="s2">set</span><span class="s1">(_cuda_C_FLAGS </span><span class="s3">&quot;${CMAKE_${CUDA_C_OR_CXX}_FLAGS}&quot;</span><span class="s1">) 
<a name="l1391"><span class="ln">1391 </span></a>    _filter_blocklisted_host_flags(_cuda_C_FLAGS) 
<a name="l1392"><span class="ln">1392 </span></a>    </span><span class="s2">set</span><span class="s1">(_cuda_host_flags </span><span class="s3">&quot;set(CMAKE_HOST_FLAGS ${_cuda_C_FLAGS} ${CUDA_HOST_SHARED_FLAGS})&quot;</span><span class="s1">) 
<a name="l1393"><span class="ln">1393 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1394"><span class="ln">1394 </span></a>    </span><span class="s2">set</span><span class="s1">(_cuda_host_flags </span><span class="s3">&quot;set(CMAKE_HOST_FLAGS ${CUDA_HOST_SHARED_FLAGS})&quot;</span><span class="s1">) 
<a name="l1395"><span class="ln">1395 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1396"><span class="ln">1396 </span></a></span>
<a name="l1397"><span class="ln">1397 </span></a>  <span class="s2">set</span><span class="s1">(_cuda_nvcc_flags_config </span><span class="s3">&quot;# Build specific configuration flags&quot;</span><span class="s1">) 
<a name="l1398"><span class="ln">1398 </span></a>  </span><span class="s0"># Loop over all the configuration types to generate appropriate flags for run_nvcc.cmake</span>
<a name="l1399"><span class="ln">1399 </span></a>  <span class="s2">foreach</span><span class="s1">(config </span><span class="s2">${CUDA_configuration_types}</span><span class="s1">) 
<a name="l1400"><span class="ln">1400 </span></a>    </span><span class="s2">string</span><span class="s1">(TOUPPER </span><span class="s2">${config} </span><span class="s1">config_upper) 
<a name="l1401"><span class="ln">1401 </span></a>    </span><span class="s0"># CMAKE_FLAGS are strings and not lists.  By not putting quotes around CMAKE_FLAGS</span>
<a name="l1402"><span class="ln">1402 </span></a>    <span class="s0"># we convert the strings to lists (like we want).</span>
<a name="l1403"><span class="ln">1403 </span></a>
<a name="l1404"><span class="ln">1404 </span></a>    <span class="s2">if</span><span class="s1">(CUDA_PROPAGATE_HOST_FLAGS) 
<a name="l1405"><span class="ln">1405 </span></a>      </span><span class="s0"># nvcc chokes on -g3 in versions previous to 3.0, so replace it with -g</span>
<a name="l1406"><span class="ln">1406 </span></a>      <span class="s2">set</span><span class="s1">(_cuda_fix_g3 </span><span class="s2">FALSE</span><span class="s1">) 
<a name="l1407"><span class="ln">1407 </span></a></span>
<a name="l1408"><span class="ln">1408 </span></a>      <span class="s2">set</span><span class="s1">(_cuda_C_FLAGS </span><span class="s3">&quot;${CMAKE_${CUDA_C_OR_CXX}_FLAGS_${config_upper}}&quot;</span><span class="s1">) 
<a name="l1409"><span class="ln">1409 </span></a>      _filter_blocklisted_host_flags(_cuda_C_FLAGS) 
<a name="l1410"><span class="ln">1410 </span></a>      </span><span class="s2">if</span><span class="s1">(_cuda_fix_g3) 
<a name="l1411"><span class="ln">1411 </span></a>        </span><span class="s2">string</span><span class="s1">(REPLACE </span><span class="s3">&quot;-g3&quot; &quot;-g&quot; </span><span class="s1">_cuda_C_FLAGS </span><span class="s3">&quot;${_cuda_C_FLAGS}&quot;</span><span class="s1">) 
<a name="l1412"><span class="ln">1412 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1413"><span class="ln">1413 </span></a></span>
<a name="l1414"><span class="ln">1414 </span></a>      <span class="s2">string</span><span class="s1">(APPEND _cuda_host_flags </span><span class="s3">&quot;\nset(CMAKE_HOST_FLAGS_${config_upper} ${_cuda_C_FLAGS})&quot;</span><span class="s1">) 
<a name="l1415"><span class="ln">1415 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1416"><span class="ln">1416 </span></a></span>
<a name="l1417"><span class="ln">1417 </span></a>    <span class="s0"># Note that if we ever want CUDA_NVCC_FLAGS_&lt;CONFIG&gt; to be string (instead of a list</span>
<a name="l1418"><span class="ln">1418 </span></a>    <span class="s0"># like it is currently), we can remove the quotes around the</span>
<a name="l1419"><span class="ln">1419 </span></a>    <span class="s0"># ${CUDA_NVCC_FLAGS_${config_upper}} variable like the CMAKE_HOST_FLAGS_&lt;CONFIG&gt; variable.</span>
<a name="l1420"><span class="ln">1420 </span></a>    <span class="s2">string</span><span class="s1">(APPEND _cuda_nvcc_flags_config </span><span class="s3">&quot;\nset(CUDA_NVCC_FLAGS_${config_upper} ${CUDA_NVCC_FLAGS_${config_upper}} ;; ${CUDA_WRAP_OPTION_NVCC_FLAGS_${config_upper}})&quot;</span><span class="s1">) 
<a name="l1421"><span class="ln">1421 </span></a>  </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1422"><span class="ln">1422 </span></a></span>
<a name="l1423"><span class="ln">1423 </span></a>  <span class="s0"># Process the C++14 flag.  If the host sets the flag, we need to add it to nvcc and</span>
<a name="l1424"><span class="ln">1424 </span></a>  <span class="s0"># remove it from the host. This is because -Xcompile -std=c++ will choke nvcc (it uses</span>
<a name="l1425"><span class="ln">1425 </span></a>  <span class="s0"># the C preprocessor).  In order to get this to work correctly, we need to use nvcc's</span>
<a name="l1426"><span class="ln">1426 </span></a>  <span class="s0"># specific c++14 flag.</span>
<a name="l1427"><span class="ln">1427 </span></a>  <span class="s2">if</span><span class="s1">( </span><span class="s3">&quot;${_cuda_host_flags}&quot; </span><span class="s2">MATCHES </span><span class="s3">&quot;-std=c\\+\\+11&quot;</span><span class="s1">) 
<a name="l1428"><span class="ln">1428 </span></a>    </span><span class="s0"># Add the c++14 flag to nvcc if it isn't already present.  Note that we only look at</span>
<a name="l1429"><span class="ln">1429 </span></a>    <span class="s0"># the main flag instead of the configuration specific flags.</span>
<a name="l1430"><span class="ln">1430 </span></a>    <span class="s2">if</span><span class="s1">( </span><span class="s2">NOT </span><span class="s3">&quot;${CUDA_NVCC_FLAGS}&quot; </span><span class="s2">MATCHES </span><span class="s3">&quot;-std=c\\+\\+14&quot; </span><span class="s1">) 
<a name="l1431"><span class="ln">1431 </span></a>      </span><span class="s2">list</span><span class="s1">(APPEND nvcc_flags --std c++14) 
<a name="l1432"><span class="ln">1432 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1433"><span class="ln">1433 </span></a>    </span><span class="s2">string</span><span class="s1">(REGEX REPLACE </span><span class="s3">&quot;[-]+std=c\\+\\+14&quot; &quot;&quot; </span><span class="s1">_cuda_host_flags </span><span class="s3">&quot;${_cuda_host_flags}&quot;</span><span class="s1">) 
<a name="l1434"><span class="ln">1434 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1435"><span class="ln">1435 </span></a></span>
<a name="l1436"><span class="ln">1436 </span></a>  <span class="s2">if</span><span class="s1">(_cuda_build_shared_libs) 
<a name="l1437"><span class="ln">1437 </span></a>    </span><span class="s2">list</span><span class="s1">(APPEND nvcc_flags </span><span class="s3">&quot;-D${cuda_target}_EXPORTS&quot;</span><span class="s1">) 
<a name="l1438"><span class="ln">1438 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1439"><span class="ln">1439 </span></a></span>
<a name="l1440"><span class="ln">1440 </span></a>  <span class="s0"># Reset the output variable</span>
<a name="l1441"><span class="ln">1441 </span></a>  <span class="s2">set</span><span class="s1">(_cuda_wrap_generated_files </span><span class="s3">&quot;&quot;</span><span class="s1">) 
<a name="l1442"><span class="ln">1442 </span></a></span>
<a name="l1443"><span class="ln">1443 </span></a>  <span class="s0"># Iterate over the macro arguments and create custom</span>
<a name="l1444"><span class="ln">1444 </span></a>  <span class="s0"># commands for all the .cu files.</span>
<a name="l1445"><span class="ln">1445 </span></a>  <span class="s2">foreach</span><span class="s1">(file </span><span class="s2">${_argn_list}</span><span class="s1">) 
<a name="l1446"><span class="ln">1446 </span></a>    </span><span class="s0"># Ignore any file marked as a HEADER_FILE_ONLY</span>
<a name="l1447"><span class="ln">1447 </span></a>    <span class="s2">get_source_file_property</span><span class="s1">(_is_header </span><span class="s2">${file} </span><span class="s5">HEADER_FILE_ONLY</span><span class="s1">) 
<a name="l1448"><span class="ln">1448 </span></a>    </span><span class="s0"># Allow per source file overrides of the format.  Also allows compiling non-.cu files.</span>
<a name="l1449"><span class="ln">1449 </span></a>    <span class="s2">get_source_file_property</span><span class="s1">(_cuda_source_format </span><span class="s2">${file} </span><span class="s1">CUDA_SOURCE_PROPERTY_FORMAT) 
<a name="l1450"><span class="ln">1450 </span></a>    </span><span class="s2">if</span><span class="s1">((</span><span class="s2">${file} MATCHES </span><span class="s3">&quot;\\.cu$&quot; </span><span class="s2">OR </span><span class="s1">_cuda_source_format) </span><span class="s2">AND NOT </span><span class="s1">_is_header) 
<a name="l1451"><span class="ln">1451 </span></a></span>
<a name="l1452"><span class="ln">1452 </span></a>      <span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s1">_cuda_source_format) 
<a name="l1453"><span class="ln">1453 </span></a>        </span><span class="s2">set</span><span class="s1">(_cuda_source_format </span><span class="s2">${format}</span><span class="s1">) 
<a name="l1454"><span class="ln">1454 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1455"><span class="ln">1455 </span></a>      </span><span class="s0"># If file isn't a .cu file, we need to tell nvcc to treat it as such.</span>
<a name="l1456"><span class="ln">1456 </span></a>      <span class="s2">if</span><span class="s1">(</span><span class="s2">NOT </span><span class="s1">file </span><span class="s2">MATCHES </span><span class="s3">&quot;\\.cu$&quot;</span><span class="s1">) 
<a name="l1457"><span class="ln">1457 </span></a>        </span><span class="s2">set</span><span class="s1">(cuda_language_flag -x=cu) 
<a name="l1458"><span class="ln">1458 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1459"><span class="ln">1459 </span></a>        </span><span class="s2">set</span><span class="s1">(cuda_language_flag) 
<a name="l1460"><span class="ln">1460 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1461"><span class="ln">1461 </span></a></span>
<a name="l1462"><span class="ln">1462 </span></a>      <span class="s2">if</span><span class="s1">( </span><span class="s2">${_cuda_source_format} MATCHES </span><span class="s3">&quot;OBJ&quot;</span><span class="s1">) 
<a name="l1463"><span class="ln">1463 </span></a>        </span><span class="s2">set</span><span class="s1">( cuda_compile_to_external_module </span><span class="s2">OFF </span><span class="s1">) 
<a name="l1464"><span class="ln">1464 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1465"><span class="ln">1465 </span></a>        </span><span class="s2">set</span><span class="s1">( cuda_compile_to_external_module </span><span class="s2">ON </span><span class="s1">) 
<a name="l1466"><span class="ln">1466 </span></a>        </span><span class="s2">if</span><span class="s1">( </span><span class="s2">${_cuda_source_format} MATCHES </span><span class="s3">&quot;PTX&quot; </span><span class="s1">) 
<a name="l1467"><span class="ln">1467 </span></a>          </span><span class="s2">set</span><span class="s1">( cuda_compile_to_external_module_type </span><span class="s3">&quot;ptx&quot; </span><span class="s1">) 
<a name="l1468"><span class="ln">1468 </span></a>        </span><span class="s2">elseif</span><span class="s1">( </span><span class="s2">${_cuda_source_format} MATCHES </span><span class="s3">&quot;CUBIN&quot;</span><span class="s1">) 
<a name="l1469"><span class="ln">1469 </span></a>          </span><span class="s2">set</span><span class="s1">( cuda_compile_to_external_module_type </span><span class="s3">&quot;cubin&quot; </span><span class="s1">) 
<a name="l1470"><span class="ln">1470 </span></a>        </span><span class="s2">elseif</span><span class="s1">( </span><span class="s2">${_cuda_source_format} MATCHES </span><span class="s3">&quot;FATBIN&quot;</span><span class="s1">) 
<a name="l1471"><span class="ln">1471 </span></a>          </span><span class="s2">set</span><span class="s1">( cuda_compile_to_external_module_type </span><span class="s3">&quot;fatbin&quot; </span><span class="s1">) 
<a name="l1472"><span class="ln">1472 </span></a>        </span><span class="s2">else</span><span class="s1">() 
<a name="l1473"><span class="ln">1473 </span></a>          </span><span class="s2">message</span><span class="s1">( FATAL_ERROR </span><span class="s3">&quot;Invalid format flag passed to CUDA_WRAP_SRCS or set with CUDA_SOURCE_PROPERTY_FORMAT file property for file '${file}': '${_cuda_source_format}'.  Use OBJ, PTX, CUBIN or FATBIN.&quot;</span><span class="s1">) 
<a name="l1474"><span class="ln">1474 </span></a>        </span><span class="s2">endif</span><span class="s1">() 
<a name="l1475"><span class="ln">1475 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1476"><span class="ln">1476 </span></a></span>
<a name="l1477"><span class="ln">1477 </span></a>      <span class="s2">if</span><span class="s1">(cuda_compile_to_external_module) 
<a name="l1478"><span class="ln">1478 </span></a>        </span><span class="s0"># Don't use any of the host compilation flags for PTX targets.</span>
<a name="l1479"><span class="ln">1479 </span></a>        <span class="s2">set</span><span class="s1">(CUDA_HOST_FLAGS) 
<a name="l1480"><span class="ln">1480 </span></a>        </span><span class="s2">set</span><span class="s1">(CUDA_NVCC_FLAGS_CONFIG) 
<a name="l1481"><span class="ln">1481 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1482"><span class="ln">1482 </span></a>        </span><span class="s2">set</span><span class="s1">(CUDA_HOST_FLAGS </span><span class="s2">${_cuda_host_flags}</span><span class="s1">) 
<a name="l1483"><span class="ln">1483 </span></a>        </span><span class="s2">set</span><span class="s1">(CUDA_NVCC_FLAGS_CONFIG </span><span class="s2">${_cuda_nvcc_flags_config}</span><span class="s1">) 
<a name="l1484"><span class="ln">1484 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1485"><span class="ln">1485 </span></a></span>
<a name="l1486"><span class="ln">1486 </span></a>      <span class="s0"># Determine output directory</span>
<a name="l1487"><span class="ln">1487 </span></a>      <span class="s1">cuda_compute_build_path(</span><span class="s3">&quot;${file}&quot; </span><span class="s1">cuda_build_path) 
<a name="l1488"><span class="ln">1488 </span></a>      </span><span class="s2">set</span><span class="s1">(cuda_compile_intermediate_directory </span><span class="s3">&quot;${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/${cuda_target}.dir/${cuda_build_path}&quot;</span><span class="s1">) 
<a name="l1489"><span class="ln">1489 </span></a>      </span><span class="s2">if</span><span class="s1">(CUDA_GENERATED_OUTPUT_DIR) 
<a name="l1490"><span class="ln">1490 </span></a>        </span><span class="s2">set</span><span class="s1">(cuda_compile_output_dir </span><span class="s3">&quot;${CUDA_GENERATED_OUTPUT_DIR}&quot;</span><span class="s1">) 
<a name="l1491"><span class="ln">1491 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1492"><span class="ln">1492 </span></a>        </span><span class="s2">if </span><span class="s1">( cuda_compile_to_external_module ) 
<a name="l1493"><span class="ln">1493 </span></a>          </span><span class="s2">set</span><span class="s1">(cuda_compile_output_dir </span><span class="s3">&quot;${CMAKE_CURRENT_BINARY_DIR}&quot;</span><span class="s1">) 
<a name="l1494"><span class="ln">1494 </span></a>        </span><span class="s2">else</span><span class="s1">() 
<a name="l1495"><span class="ln">1495 </span></a>          </span><span class="s2">set</span><span class="s1">(cuda_compile_output_dir </span><span class="s3">&quot;${cuda_compile_intermediate_directory}&quot;</span><span class="s1">) 
<a name="l1496"><span class="ln">1496 </span></a>        </span><span class="s2">endif</span><span class="s1">() 
<a name="l1497"><span class="ln">1497 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1498"><span class="ln">1498 </span></a></span>
<a name="l1499"><span class="ln">1499 </span></a>      <span class="s0"># Add a custom target to generate a c or ptx file. ######################</span>
<a name="l1500"><span class="ln">1500 </span></a>
<a name="l1501"><span class="ln">1501 </span></a>      <span class="s2">get_filename_component</span><span class="s1">( basename </span><span class="s2">${file} NAME </span><span class="s1">) 
<a name="l1502"><span class="ln">1502 </span></a>      </span><span class="s2">if</span><span class="s1">( cuda_compile_to_external_module ) 
<a name="l1503"><span class="ln">1503 </span></a>        </span><span class="s2">set</span><span class="s1">(generated_file_path </span><span class="s3">&quot;${cuda_compile_output_dir}&quot;</span><span class="s1">) 
<a name="l1504"><span class="ln">1504 </span></a>        </span><span class="s2">set</span><span class="s1">(generated_file_basename </span><span class="s3">&quot;${cuda_target}_generated_${basename}.${cuda_compile_to_external_module_type}&quot;</span><span class="s1">) 
<a name="l1505"><span class="ln">1505 </span></a>        </span><span class="s2">set</span><span class="s1">(format_flag </span><span class="s3">&quot;-${cuda_compile_to_external_module_type}&quot;</span><span class="s1">) 
<a name="l1506"><span class="ln">1506 </span></a>        </span><span class="s2">file</span><span class="s1">(MAKE_DIRECTORY </span><span class="s3">&quot;${cuda_compile_output_dir}&quot;</span><span class="s1">) 
<a name="l1507"><span class="ln">1507 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1508"><span class="ln">1508 </span></a>        </span><span class="s2">set</span><span class="s1">(generated_file_path </span><span class="s3">&quot;${cuda_compile_output_dir}/${CMAKE_CFG_INTDIR}&quot;</span><span class="s1">) 
<a name="l1509"><span class="ln">1509 </span></a>        </span><span class="s2">set</span><span class="s1">(generated_file_basename </span><span class="s3">&quot;${cuda_target}_generated_${basename}${generated_extension}&quot;</span><span class="s1">) 
<a name="l1510"><span class="ln">1510 </span></a>        </span><span class="s2">if</span><span class="s1">(CUDA_SEPARABLE_COMPILATION) 
<a name="l1511"><span class="ln">1511 </span></a>          </span><span class="s2">set</span><span class="s1">(format_flag </span><span class="s3">&quot;-dc&quot;</span><span class="s1">) 
<a name="l1512"><span class="ln">1512 </span></a>        </span><span class="s2">else</span><span class="s1">() 
<a name="l1513"><span class="ln">1513 </span></a>          </span><span class="s2">set</span><span class="s1">(format_flag </span><span class="s3">&quot;-c&quot;</span><span class="s1">) 
<a name="l1514"><span class="ln">1514 </span></a>        </span><span class="s2">endif</span><span class="s1">() 
<a name="l1515"><span class="ln">1515 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1516"><span class="ln">1516 </span></a></span>
<a name="l1517"><span class="ln">1517 </span></a>      <span class="s0"># Set all of our file names.  Make sure that whatever filenames that have</span>
<a name="l1518"><span class="ln">1518 </span></a>      <span class="s0"># generated_file_path in them get passed in through as a command line</span>
<a name="l1519"><span class="ln">1519 </span></a>      <span class="s0"># argument, so that the ${CMAKE_CFG_INTDIR} gets expanded at run time</span>
<a name="l1520"><span class="ln">1520 </span></a>      <span class="s0"># instead of configure time.</span>
<a name="l1521"><span class="ln">1521 </span></a>      <span class="s2">set</span><span class="s1">(generated_file </span><span class="s3">&quot;${generated_file_path}/${generated_file_basename}&quot;</span><span class="s1">) 
<a name="l1522"><span class="ln">1522 </span></a>      </span><span class="s2">set</span><span class="s1">(cmake_dependency_file </span><span class="s3">&quot;${cuda_compile_intermediate_directory}/${generated_file_basename}.depend&quot;</span><span class="s1">) 
<a name="l1523"><span class="ln">1523 </span></a>      </span><span class="s2">set</span><span class="s1">(NVCC_generated_dependency_file </span><span class="s3">&quot;${cuda_compile_intermediate_directory}/${generated_file_basename}.NVCC-depend&quot;</span><span class="s1">) 
<a name="l1524"><span class="ln">1524 </span></a>      </span><span class="s2">set</span><span class="s1">(generated_cubin_file </span><span class="s3">&quot;${generated_file_path}/${generated_file_basename}.cubin.txt&quot;</span><span class="s1">) 
<a name="l1525"><span class="ln">1525 </span></a>      </span><span class="s2">set</span><span class="s1">(custom_target_script_pregen </span><span class="s3">&quot;${cuda_compile_intermediate_directory}/${generated_file_basename}.cmake.pre-gen&quot;</span><span class="s1">) 
<a name="l1526"><span class="ln">1526 </span></a>      </span><span class="s2">set</span><span class="s1">(custom_target_script </span><span class="s3">&quot;${cuda_compile_intermediate_directory}/${generated_file_basename}$&lt;$&lt;BOOL:$&lt;CONFIG&gt;&gt;:.$&lt;CONFIG&gt;&gt;.cmake&quot;</span><span class="s1">) 
<a name="l1527"><span class="ln">1527 </span></a></span>
<a name="l1528"><span class="ln">1528 </span></a>      <span class="s0"># Setup properties for obj files:</span>
<a name="l1529"><span class="ln">1529 </span></a>      <span class="s2">if</span><span class="s1">( </span><span class="s2">NOT </span><span class="s1">cuda_compile_to_external_module ) 
<a name="l1530"><span class="ln">1530 </span></a>        </span><span class="s2">set_source_files_properties</span><span class="s1">(</span><span class="s3">&quot;${generated_file}&quot;</span>
<a name="l1531"><span class="ln">1531 </span></a>          <span class="s1">PROPERTIES 
<a name="l1532"><span class="ln">1532 </span></a>          </span><span class="s5">EXTERNAL_OBJECT </span><span class="s2">true </span><span class="s0"># This is an object file not to be compiled, but only be linked.</span>
<a name="l1533"><span class="ln">1533 </span></a>          <span class="s1">) 
<a name="l1534"><span class="ln">1534 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1535"><span class="ln">1535 </span></a></span>
<a name="l1536"><span class="ln">1536 </span></a>      <span class="s0"># Don't add CMAKE_CURRENT_SOURCE_DIR if the path is already an absolute path.</span>
<a name="l1537"><span class="ln">1537 </span></a>      <span class="s2">get_filename_component</span><span class="s1">(file_path </span><span class="s3">&quot;${file}&quot; </span><span class="s2">PATH</span><span class="s1">) 
<a name="l1538"><span class="ln">1538 </span></a>      </span><span class="s2">if</span><span class="s1">(</span><span class="s2">IS_ABSOLUTE </span><span class="s3">&quot;${file_path}&quot;</span><span class="s1">) 
<a name="l1539"><span class="ln">1539 </span></a>        </span><span class="s2">set</span><span class="s1">(source_file </span><span class="s3">&quot;${file}&quot;</span><span class="s1">) 
<a name="l1540"><span class="ln">1540 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1541"><span class="ln">1541 </span></a>        </span><span class="s2">set</span><span class="s1">(source_file </span><span class="s3">&quot;${CMAKE_CURRENT_SOURCE_DIR}/${file}&quot;</span><span class="s1">) 
<a name="l1542"><span class="ln">1542 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1543"><span class="ln">1543 </span></a></span>
<a name="l1544"><span class="ln">1544 </span></a>      <span class="s2">if</span><span class="s1">( </span><span class="s2">NOT </span><span class="s1">cuda_compile_to_external_module </span><span class="s2">AND </span><span class="s1">CUDA_SEPARABLE_COMPILATION) 
<a name="l1545"><span class="ln">1545 </span></a>        </span><span class="s2">list</span><span class="s1">(APPEND </span><span class="s2">${cuda_target}</span><span class="s1">_SEPARABLE_COMPILATION_OBJECTS </span><span class="s3">&quot;${generated_file}&quot;</span><span class="s1">) 
<a name="l1546"><span class="ln">1546 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1547"><span class="ln">1547 </span></a></span>
<a name="l1548"><span class="ln">1548 </span></a>      <span class="s0"># Bring in the dependencies.  Creates a variable CUDA_NVCC_DEPEND #######</span>
<a name="l1549"><span class="ln">1549 </span></a>      <span class="s1">cuda_include_nvcc_dependencies(</span><span class="s2">${cmake_dependency_file}</span><span class="s1">) 
<a name="l1550"><span class="ln">1550 </span></a></span>
<a name="l1551"><span class="ln">1551 </span></a>      <span class="s0"># Convenience string for output #########################################</span>
<a name="l1552"><span class="ln">1552 </span></a>      <span class="s2">if</span><span class="s1">(CUDA_BUILD_EMULATION) 
<a name="l1553"><span class="ln">1553 </span></a>        </span><span class="s2">set</span><span class="s1">(cuda_build_type </span><span class="s3">&quot;Emulation&quot;</span><span class="s1">) 
<a name="l1554"><span class="ln">1554 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1555"><span class="ln">1555 </span></a>        </span><span class="s2">set</span><span class="s1">(cuda_build_type </span><span class="s3">&quot;Device&quot;</span><span class="s1">) 
<a name="l1556"><span class="ln">1556 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1557"><span class="ln">1557 </span></a></span>
<a name="l1558"><span class="ln">1558 </span></a>      <span class="s0"># Build the NVCC made dependency file ###################################</span>
<a name="l1559"><span class="ln">1559 </span></a>      <span class="s2">set</span><span class="s1">(build_cubin </span><span class="s2">OFF</span><span class="s1">) 
<a name="l1560"><span class="ln">1560 </span></a>      </span><span class="s2">if </span><span class="s1">( </span><span class="s2">NOT </span><span class="s1">CUDA_BUILD_EMULATION </span><span class="s2">AND </span><span class="s1">CUDA_BUILD_CUBIN ) 
<a name="l1561"><span class="ln">1561 </span></a>         </span><span class="s2">if </span><span class="s1">( </span><span class="s2">NOT </span><span class="s1">cuda_compile_to_external_module ) 
<a name="l1562"><span class="ln">1562 </span></a>           </span><span class="s2">set </span><span class="s1">( build_cubin </span><span class="s2">ON </span><span class="s1">) 
<a name="l1563"><span class="ln">1563 </span></a>         </span><span class="s2">endif</span><span class="s1">() 
<a name="l1564"><span class="ln">1564 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1565"><span class="ln">1565 </span></a></span>
<a name="l1566"><span class="ln">1566 </span></a>      <span class="s0"># Configure the build script</span>
<a name="l1567"><span class="ln">1567 </span></a>      <span class="s2">configure_file</span><span class="s1">(</span><span class="s3">&quot;${CUDA_run_nvcc}&quot; &quot;${custom_target_script_pregen}&quot; </span><span class="s1">@ONLY) 
<a name="l1568"><span class="ln">1568 </span></a>      </span><span class="s2">file</span><span class="s1">(GENERATE 
<a name="l1569"><span class="ln">1569 </span></a>        OUTPUT </span><span class="s3">&quot;${custom_target_script}&quot;</span>
<a name="l1570"><span class="ln">1570 </span></a>        <span class="s1">INPUT </span><span class="s3">&quot;${custom_target_script_pregen}&quot;</span>
<a name="l1571"><span class="ln">1571 </span></a>        <span class="s1">) 
<a name="l1572"><span class="ln">1572 </span></a></span>
<a name="l1573"><span class="ln">1573 </span></a>      <span class="s0"># So if a user specifies the same cuda file as input more than once, you</span>
<a name="l1574"><span class="ln">1574 </span></a>      <span class="s0"># can have bad things happen with dependencies.  Here we check an option</span>
<a name="l1575"><span class="ln">1575 </span></a>      <span class="s0"># to see if this is the behavior they want.</span>
<a name="l1576"><span class="ln">1576 </span></a>      <span class="s2">if</span><span class="s1">(CUDA_ATTACH_VS_BUILD_RULE_TO_CUDA_FILE) 
<a name="l1577"><span class="ln">1577 </span></a>        </span><span class="s2">set</span><span class="s1">(main_dep MAIN_DEPENDENCY </span><span class="s2">${source_file}</span><span class="s1">) 
<a name="l1578"><span class="ln">1578 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1579"><span class="ln">1579 </span></a>        </span><span class="s2">set</span><span class="s1">(main_dep </span><span class="s5">DEPENDS </span><span class="s2">${source_file}</span><span class="s1">) 
<a name="l1580"><span class="ln">1580 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1581"><span class="ln">1581 </span></a></span>
<a name="l1582"><span class="ln">1582 </span></a>      <span class="s2">if</span><span class="s1">(CUDA_VERBOSE_BUILD) 
<a name="l1583"><span class="ln">1583 </span></a>        </span><span class="s2">set</span><span class="s1">(verbose_output </span><span class="s2">ON</span><span class="s1">) 
<a name="l1584"><span class="ln">1584 </span></a>      </span><span class="s2">elseif</span><span class="s1">(</span><span class="s4">CMAKE_GENERATOR </span><span class="s2">MATCHES </span><span class="s3">&quot;Makefiles&quot;</span><span class="s1">) 
<a name="l1585"><span class="ln">1585 </span></a>        </span><span class="s2">set</span><span class="s1">(verbose_output </span><span class="s3">&quot;$(VERBOSE)&quot;</span><span class="s1">) 
<a name="l1586"><span class="ln">1586 </span></a>      </span><span class="s0"># This condition lets us also turn on verbose output when someone</span>
<a name="l1587"><span class="ln">1587 </span></a>      <span class="s0"># specifies CMAKE_VERBOSE_MAKEFILE, even if the generator isn't</span>
<a name="l1588"><span class="ln">1588 </span></a>      <span class="s0"># the Makefiles generator (this is important for us, Ninja users.)</span>
<a name="l1589"><span class="ln">1589 </span></a>      <span class="s2">elseif</span><span class="s1">(</span><span class="s4">CMAKE_VERBOSE_MAKEFILE</span><span class="s1">) 
<a name="l1590"><span class="ln">1590 </span></a>        </span><span class="s2">set</span><span class="s1">(verbose_output </span><span class="s2">ON</span><span class="s1">) 
<a name="l1591"><span class="ln">1591 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1592"><span class="ln">1592 </span></a>        </span><span class="s2">set</span><span class="s1">(verbose_output </span><span class="s2">OFF</span><span class="s1">) 
<a name="l1593"><span class="ln">1593 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1594"><span class="ln">1594 </span></a></span>
<a name="l1595"><span class="ln">1595 </span></a>      <span class="s0"># Create up the comment string</span>
<a name="l1596"><span class="ln">1596 </span></a>      <span class="s2">file</span><span class="s1">(RELATIVE_PATH generated_file_relative_path </span><span class="s3">&quot;${CMAKE_BINARY_DIR}&quot; &quot;${generated_file}&quot;</span><span class="s1">) 
<a name="l1597"><span class="ln">1597 </span></a>      </span><span class="s2">if</span><span class="s1">(cuda_compile_to_external_module) 
<a name="l1598"><span class="ln">1598 </span></a>        </span><span class="s2">set</span><span class="s1">(cuda_build_comment_string </span><span class="s3">&quot;Building NVCC ${cuda_compile_to_external_module_type} file ${generated_file_relative_path}&quot;</span><span class="s1">) 
<a name="l1599"><span class="ln">1599 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1600"><span class="ln">1600 </span></a>        </span><span class="s2">set</span><span class="s1">(cuda_build_comment_string </span><span class="s3">&quot;Building NVCC (${cuda_build_type}) object ${generated_file_relative_path}&quot;</span><span class="s1">) 
<a name="l1601"><span class="ln">1601 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1602"><span class="ln">1602 </span></a></span>
<a name="l1603"><span class="ln">1603 </span></a>      <span class="s2">set</span><span class="s1">(_verbatim VERBATIM) 
<a name="l1604"><span class="ln">1604 </span></a>      </span><span class="s2">if</span><span class="s1">(ccbin_flags </span><span class="s2">MATCHES </span><span class="s3">&quot;\\$\\(VCInstallDir\\)&quot;</span><span class="s1">) 
<a name="l1605"><span class="ln">1605 </span></a>        </span><span class="s2">set</span><span class="s1">(_verbatim </span><span class="s3">&quot;&quot;</span><span class="s1">) 
<a name="l1606"><span class="ln">1606 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1607"><span class="ln">1607 </span></a></span>
<a name="l1608"><span class="ln">1608 </span></a>      <span class="s0"># Build the generated file and dependency file ##########################</span>
<a name="l1609"><span class="ln">1609 </span></a>      <span class="s2">add_custom_command</span><span class="s1">( 
<a name="l1610"><span class="ln">1610 </span></a>        OUTPUT </span><span class="s2">${generated_file}</span>
<a name="l1611"><span class="ln">1611 </span></a>        <span class="s0"># These output files depend on the source_file and the contents of cmake_dependency_file</span>
<a name="l1612"><span class="ln">1612 </span></a>        <span class="s2">${main_dep}</span>
<a name="l1613"><span class="ln">1613 </span></a>        <span class="s5">DEPENDS </span><span class="s2">${CUDA_NVCC_DEPEND}</span>
<a name="l1614"><span class="ln">1614 </span></a>        <span class="s5">DEPENDS </span><span class="s2">${custom_target_script}</span>
<a name="l1615"><span class="ln">1615 </span></a>        <span class="s0"># Make sure the output directory exists before trying to write to it.</span>
<a name="l1616"><span class="ln">1616 </span></a>        <span class="s2">COMMAND ${CMAKE_COMMAND} </span><span class="s1">-E make_directory </span><span class="s3">&quot;${generated_file_path}&quot;</span>
<a name="l1617"><span class="ln">1617 </span></a>        <span class="s2">COMMAND ${CMAKE_COMMAND} </span><span class="s1">ARGS 
<a name="l1618"><span class="ln">1618 </span></a>          -D verbose:</span><span class="s2">BOOL</span><span class="s1">=</span><span class="s2">${verbose_output}</span>
<a name="l1619"><span class="ln">1619 </span></a>          <span class="s2">${ccbin_flags}</span>
<a name="l1620"><span class="ln">1620 </span></a>          <span class="s1">-D build_configuration:</span><span class="s2">STRING</span><span class="s1">=</span><span class="s2">${CUDA_build_configuration}</span>
<a name="l1621"><span class="ln">1621 </span></a>          <span class="s1">-D </span><span class="s3">&quot;generated_file:STRING=${generated_file}&quot;</span>
<a name="l1622"><span class="ln">1622 </span></a>          <span class="s1">-D </span><span class="s3">&quot;generated_cubin_file:STRING=${generated_cubin_file}&quot;</span>
<a name="l1623"><span class="ln">1623 </span></a>          <span class="s1">-P </span><span class="s3">&quot;${custom_target_script}&quot;</span>
<a name="l1624"><span class="ln">1624 </span></a>        <span class="s5">WORKING_DIRECTORY </span><span class="s3">&quot;${cuda_compile_intermediate_directory}&quot;</span>
<a name="l1625"><span class="ln">1625 </span></a>        <span class="s2">COMMENT </span><span class="s3">&quot;${cuda_build_comment_string}&quot;</span>
<a name="l1626"><span class="ln">1626 </span></a>        <span class="s2">${_verbatim}</span>
<a name="l1627"><span class="ln">1627 </span></a>        <span class="s1">) 
<a name="l1628"><span class="ln">1628 </span></a></span>
<a name="l1629"><span class="ln">1629 </span></a>      <span class="s0"># Make sure the build system knows the file is generated.</span>
<a name="l1630"><span class="ln">1630 </span></a>      <span class="s2">set_source_files_properties</span><span class="s1">(</span><span class="s2">${generated_file} </span><span class="s1">PROPERTIES </span><span class="s5">GENERATED </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l1631"><span class="ln">1631 </span></a></span>
<a name="l1632"><span class="ln">1632 </span></a>      <span class="s2">list</span><span class="s1">(APPEND _cuda_wrap_generated_files </span><span class="s2">${generated_file}</span><span class="s1">) 
<a name="l1633"><span class="ln">1633 </span></a></span>
<a name="l1634"><span class="ln">1634 </span></a>      <span class="s0"># Add the other files that we want cmake to clean on a cleanup ##########</span>
<a name="l1635"><span class="ln">1635 </span></a>      <span class="s2">list</span><span class="s1">(APPEND CUDA_ADDITIONAL_CLEAN_FILES </span><span class="s3">&quot;${cmake_dependency_file}&quot;</span><span class="s1">) 
<a name="l1636"><span class="ln">1636 </span></a>      </span><span class="s2">list</span><span class="s1">(REMOVE_DUPLICATES CUDA_ADDITIONAL_CLEAN_FILES) 
<a name="l1637"><span class="ln">1637 </span></a>      </span><span class="s2">set</span><span class="s1">(CUDA_ADDITIONAL_CLEAN_FILES </span><span class="s2">${CUDA_ADDITIONAL_CLEAN_FILES} CACHE INTERNAL </span><span class="s3">&quot;List of intermediate files that are part of the cuda dependency scanning.&quot;</span><span class="s1">) 
<a name="l1638"><span class="ln">1638 </span></a></span>
<a name="l1639"><span class="ln">1639 </span></a>    <span class="s2">endif</span><span class="s1">() 
<a name="l1640"><span class="ln">1640 </span></a>  </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1641"><span class="ln">1641 </span></a></span>
<a name="l1642"><span class="ln">1642 </span></a>  <span class="s0"># Set the return parameter</span>
<a name="l1643"><span class="ln">1643 </span></a>  <span class="s2">set</span><span class="s1">(</span><span class="s2">${generated_files} ${_cuda_wrap_generated_files}</span><span class="s1">) 
<a name="l1644"><span class="ln">1644 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1645"><span class="ln">1645 </span></a></span>
<a name="l1646"><span class="ln">1646 </span></a><span class="s2">function</span><span class="s1">(_cuda_get_important_host_flags important_flags flag_string) 
<a name="l1647"><span class="ln">1647 </span></a>  </span><span class="s2">if</span><span class="s1">(</span><span class="s4">CMAKE_GENERATOR </span><span class="s2">MATCHES </span><span class="s3">&quot;Visual Studio&quot;</span><span class="s1">) 
<a name="l1648"><span class="ln">1648 </span></a>    </span><span class="s2">string</span><span class="s1">(REGEX MATCHALL </span><span class="s3">&quot;/M[DT][d]?&quot; </span><span class="s1">flags </span><span class="s3">&quot;${flag_string}&quot;</span><span class="s1">) 
<a name="l1649"><span class="ln">1649 </span></a>    </span><span class="s2">list</span><span class="s1">(APPEND </span><span class="s2">${important_flags} ${flags}</span><span class="s1">) 
<a name="l1650"><span class="ln">1650 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1651"><span class="ln">1651 </span></a>    </span><span class="s2">string</span><span class="s1">(REGEX MATCHALL </span><span class="s3">&quot;-fPIC&quot; </span><span class="s1">flags </span><span class="s3">&quot;${flag_string}&quot;</span><span class="s1">) 
<a name="l1652"><span class="ln">1652 </span></a>    </span><span class="s2">list</span><span class="s1">(APPEND </span><span class="s2">${important_flags} ${flags}</span><span class="s1">) 
<a name="l1653"><span class="ln">1653 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1654"><span class="ln">1654 </span></a>  </span><span class="s2">set</span><span class="s1">(</span><span class="s2">${important_flags} </span><span class="s1">${</span><span class="s2">${important_flags}</span><span class="s1">} PARENT_SCOPE) 
<a name="l1655"><span class="ln">1655 </span></a></span><span class="s2">endfunction</span><span class="s1">() 
<a name="l1656"><span class="ln">1656 </span></a></span>
<a name="l1657"><span class="ln">1657 </span></a><span class="s0">###############################################################################</span>
<a name="l1658"><span class="ln">1658 </span></a><span class="s0">###############################################################################</span>
<a name="l1659"><span class="ln">1659 </span></a><span class="s0"># Separable Compilation Link</span>
<a name="l1660"><span class="ln">1660 </span></a><span class="s0">###############################################################################</span>
<a name="l1661"><span class="ln">1661 </span></a><span class="s0">###############################################################################</span>
<a name="l1662"><span class="ln">1662 </span></a>
<a name="l1663"><span class="ln">1663 </span></a><span class="s0"># Compute the filename to be used by CUDA_LINK_SEPARABLE_COMPILATION_OBJECTS</span>
<a name="l1664"><span class="ln">1664 </span></a><span class="s2">function</span><span class="s1">(CUDA_COMPUTE_SEPARABLE_COMPILATION_OBJECT_FILE_NAME output_file_var cuda_target object_files) 
<a name="l1665"><span class="ln">1665 </span></a>  </span><span class="s2">if </span><span class="s1">(object_files) 
<a name="l1666"><span class="ln">1666 </span></a>    </span><span class="s2">set</span><span class="s1">(generated_extension ${CMAKE_</span><span class="s2">${CUDA_C_OR_CXX}</span><span class="s1">_OUTPUT_EXTENSION}) 
<a name="l1667"><span class="ln">1667 </span></a>    </span><span class="s2">set</span><span class="s1">(output_file </span><span class="s3">&quot;${CMAKE_CURRENT_BINARY_DIR}/CMakeFiles/${cuda_target}.dir/${CMAKE_CFG_INTDIR}/${cuda_target}_intermediate_link${generated_extension}&quot;</span><span class="s1">) 
<a name="l1668"><span class="ln">1668 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1669"><span class="ln">1669 </span></a>    </span><span class="s2">set</span><span class="s1">(output_file) 
<a name="l1670"><span class="ln">1670 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1671"><span class="ln">1671 </span></a></span>
<a name="l1672"><span class="ln">1672 </span></a>  <span class="s2">set</span><span class="s1">(</span><span class="s2">${output_file_var} </span><span class="s3">&quot;${output_file}&quot; </span><span class="s1">PARENT_SCOPE) 
<a name="l1673"><span class="ln">1673 </span></a></span><span class="s2">endfunction</span><span class="s1">() 
<a name="l1674"><span class="ln">1674 </span></a></span>
<a name="l1675"><span class="ln">1675 </span></a><span class="s0"># Setup the build rule for the separable compilation intermediate link file.</span>
<a name="l1676"><span class="ln">1676 </span></a><span class="s2">function</span><span class="s1">(CUDA_LINK_SEPARABLE_COMPILATION_OBJECTS output_file cuda_target options object_files) 
<a name="l1677"><span class="ln">1677 </span></a>  </span><span class="s2">if </span><span class="s1">(object_files) 
<a name="l1678"><span class="ln">1678 </span></a></span>
<a name="l1679"><span class="ln">1679 </span></a>    <span class="s2">set_source_files_properties</span><span class="s1">(</span><span class="s3">&quot;${output_file}&quot;</span>
<a name="l1680"><span class="ln">1680 </span></a>      <span class="s1">PROPERTIES 
<a name="l1681"><span class="ln">1681 </span></a>      </span><span class="s5">EXTERNAL_OBJECT </span><span class="s2">TRUE </span><span class="s0"># This is an object file not to be compiled, but only</span>
<a name="l1682"><span class="ln">1682 </span></a>                           <span class="s0"># be linked.</span>
<a name="l1683"><span class="ln">1683 </span></a>      <span class="s5">GENERATED </span><span class="s2">TRUE       </span><span class="s0"># This file is generated during the build</span>
<a name="l1684"><span class="ln">1684 </span></a>      <span class="s1">) 
<a name="l1685"><span class="ln">1685 </span></a></span>
<a name="l1686"><span class="ln">1686 </span></a>    <span class="s0"># For now we are ignoring all the configuration specific flags.</span>
<a name="l1687"><span class="ln">1687 </span></a>    <span class="s2">set</span><span class="s1">(nvcc_flags) 
<a name="l1688"><span class="ln">1688 </span></a>    CUDA_PARSE_NVCC_OPTIONS(nvcc_flags </span><span class="s2">${options}</span><span class="s1">) 
<a name="l1689"><span class="ln">1689 </span></a>    </span><span class="s2">if</span><span class="s1">(CUDA_64_BIT_DEVICE_CODE) 
<a name="l1690"><span class="ln">1690 </span></a>      </span><span class="s2">list</span><span class="s1">(APPEND nvcc_flags -m64) 
<a name="l1691"><span class="ln">1691 </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l1692"><span class="ln">1692 </span></a>      </span><span class="s2">list</span><span class="s1">(APPEND nvcc_flags -m32) 
<a name="l1693"><span class="ln">1693 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1694"><span class="ln">1694 </span></a>    </span><span class="s0"># If -ccbin, --compiler-bindir has been specified, don't do anything.  Otherwise add it here.</span>
<a name="l1695"><span class="ln">1695 </span></a>    <span class="s2">list</span><span class="s1">( FIND nvcc_flags </span><span class="s3">&quot;-ccbin&quot; </span><span class="s1">ccbin_found0 ) 
<a name="l1696"><span class="ln">1696 </span></a>    </span><span class="s2">list</span><span class="s1">( FIND nvcc_flags </span><span class="s3">&quot;--compiler-bindir&quot; </span><span class="s1">ccbin_found1 ) 
<a name="l1697"><span class="ln">1697 </span></a>    </span><span class="s2">if</span><span class="s1">( ccbin_found0 </span><span class="s2">LESS </span><span class="s1">0 </span><span class="s2">AND </span><span class="s1">ccbin_found1 </span><span class="s2">LESS </span><span class="s1">0 </span><span class="s2">AND </span><span class="s1">CUDA_HOST_COMPILER ) 
<a name="l1698"><span class="ln">1698 </span></a>      </span><span class="s0"># Match VERBATIM check below.</span>
<a name="l1699"><span class="ln">1699 </span></a>      <span class="s2">if</span><span class="s1">(CUDA_HOST_COMPILER </span><span class="s2">MATCHES </span><span class="s3">&quot;\\$\\(VCInstallDir\\)&quot;</span><span class="s1">) 
<a name="l1700"><span class="ln">1700 </span></a>        </span><span class="s2">list</span><span class="s1">(APPEND nvcc_flags -ccbin </span><span class="s3">&quot;\&quot;${CUDA_HOST_COMPILER}\&quot;&quot;</span><span class="s1">) 
<a name="l1701"><span class="ln">1701 </span></a>      </span><span class="s2">else</span><span class="s1">() 
<a name="l1702"><span class="ln">1702 </span></a>        </span><span class="s2">list</span><span class="s1">(APPEND nvcc_flags -ccbin </span><span class="s3">&quot;${CUDA_HOST_COMPILER}&quot;</span><span class="s1">) 
<a name="l1703"><span class="ln">1703 </span></a>      </span><span class="s2">endif</span><span class="s1">() 
<a name="l1704"><span class="ln">1704 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1705"><span class="ln">1705 </span></a></span>
<a name="l1706"><span class="ln">1706 </span></a>    <span class="s0"># Create a list of flags specified by CUDA_NVCC_FLAGS_${CONFIG} and CMAKE_${CUDA_C_OR_CXX}_FLAGS*</span>
<a name="l1707"><span class="ln">1707 </span></a>    <span class="s2">set</span><span class="s1">(config_specific_flags) 
<a name="l1708"><span class="ln">1708 </span></a>    </span><span class="s2">set</span><span class="s1">(flags) 
<a name="l1709"><span class="ln">1709 </span></a>    </span><span class="s2">foreach</span><span class="s1">(config </span><span class="s2">${CUDA_configuration_types}</span><span class="s1">) 
<a name="l1710"><span class="ln">1710 </span></a>      </span><span class="s2">string</span><span class="s1">(TOUPPER </span><span class="s2">${config} </span><span class="s1">config_upper) 
<a name="l1711"><span class="ln">1711 </span></a>      </span><span class="s0"># Add config specific flags</span>
<a name="l1712"><span class="ln">1712 </span></a>      <span class="s2">foreach</span><span class="s1">(f ${CUDA_NVCC_FLAGS_</span><span class="s2">${config_upper}</span><span class="s1">}) 
<a name="l1713"><span class="ln">1713 </span></a>        </span><span class="s2">list</span><span class="s1">(APPEND config_specific_flags $&lt;$&lt;CONFIG:</span><span class="s2">${config}</span><span class="s1">&gt;:</span><span class="s2">${f}</span><span class="s1">&gt;) 
<a name="l1714"><span class="ln">1714 </span></a>      </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1715"><span class="ln">1715 </span></a>      </span><span class="s2">set</span><span class="s1">(important_host_flags) 
<a name="l1716"><span class="ln">1716 </span></a>      _cuda_get_important_host_flags(important_host_flags </span><span class="s3">&quot;${CMAKE_${CUDA_C_OR_CXX}_FLAGS_${config_upper}}&quot;</span><span class="s1">) 
<a name="l1717"><span class="ln">1717 </span></a>      </span><span class="s2">foreach</span><span class="s1">(f </span><span class="s2">${important_host_flags}</span><span class="s1">) 
<a name="l1718"><span class="ln">1718 </span></a>        </span><span class="s2">list</span><span class="s1">(APPEND flags $&lt;$&lt;CONFIG:</span><span class="s2">${config}</span><span class="s1">&gt;:-Xcompiler&gt; $&lt;$&lt;CONFIG:</span><span class="s2">${config}</span><span class="s1">&gt;:</span><span class="s2">${f}</span><span class="s1">&gt;) 
<a name="l1719"><span class="ln">1719 </span></a>      </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1720"><span class="ln">1720 </span></a>    </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1721"><span class="ln">1721 </span></a>    </span><span class="s0"># Add CMAKE_${CUDA_C_OR_CXX}_FLAGS</span>
<a name="l1722"><span class="ln">1722 </span></a>    <span class="s2">set</span><span class="s1">(important_host_flags) 
<a name="l1723"><span class="ln">1723 </span></a>    _cuda_get_important_host_flags(important_host_flags </span><span class="s3">&quot;${CMAKE_${CUDA_C_OR_CXX}_FLAGS}&quot;</span><span class="s1">) 
<a name="l1724"><span class="ln">1724 </span></a>    </span><span class="s2">foreach</span><span class="s1">(f </span><span class="s2">${important_host_flags}</span><span class="s1">) 
<a name="l1725"><span class="ln">1725 </span></a>      </span><span class="s2">list</span><span class="s1">(APPEND flags -Xcompiler </span><span class="s2">${f}</span><span class="s1">) 
<a name="l1726"><span class="ln">1726 </span></a>    </span><span class="s2">endforeach</span><span class="s1">() 
<a name="l1727"><span class="ln">1727 </span></a></span>
<a name="l1728"><span class="ln">1728 </span></a>    <span class="s0"># Add our general CUDA_NVCC_FLAGS with the configuration specific flags</span>
<a name="l1729"><span class="ln">1729 </span></a>    <span class="s2">set</span><span class="s1">(nvcc_flags </span><span class="s2">${CUDA_NVCC_FLAGS} ${config_specific_flags} ${nvcc_flags}</span><span class="s1">) 
<a name="l1730"><span class="ln">1730 </span></a></span>
<a name="l1731"><span class="ln">1731 </span></a>    <span class="s2">file</span><span class="s1">(RELATIVE_PATH output_file_relative_path </span><span class="s3">&quot;${CMAKE_BINARY_DIR}&quot; &quot;${output_file}&quot;</span><span class="s1">) 
<a name="l1732"><span class="ln">1732 </span></a></span>
<a name="l1733"><span class="ln">1733 </span></a>    <span class="s0"># Some generators don't handle the multiple levels of custom command</span>
<a name="l1734"><span class="ln">1734 </span></a>    <span class="s0"># dependencies correctly (obj1 depends on file1, obj2 depends on obj1), so</span>
<a name="l1735"><span class="ln">1735 </span></a>    <span class="s0"># we work around that issue by compiling the intermediate link object as a</span>
<a name="l1736"><span class="ln">1736 </span></a>    <span class="s0"># pre-link custom command in that situation.</span>
<a name="l1737"><span class="ln">1737 </span></a>    <span class="s2">set</span><span class="s1">(do_obj_build_rule </span><span class="s2">TRUE</span><span class="s1">) 
<a name="l1738"><span class="ln">1738 </span></a>    </span><span class="s2">if </span><span class="s1">(</span><span class="s4">MSVC_VERSION </span><span class="s2">GREATER </span><span class="s1">1599 </span><span class="s2">AND </span><span class="s4">MSVC_VERSION </span><span class="s2">LESS </span><span class="s1">1800) 
<a name="l1739"><span class="ln">1739 </span></a>      </span><span class="s0"># VS 2010 and 2012 have this problem.</span>
<a name="l1740"><span class="ln">1740 </span></a>      <span class="s2">set</span><span class="s1">(do_obj_build_rule </span><span class="s2">FALSE</span><span class="s1">) 
<a name="l1741"><span class="ln">1741 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1742"><span class="ln">1742 </span></a></span>
<a name="l1743"><span class="ln">1743 </span></a>    <span class="s2">set</span><span class="s1">(_verbatim VERBATIM) 
<a name="l1744"><span class="ln">1744 </span></a>    </span><span class="s2">if</span><span class="s1">(nvcc_flags </span><span class="s2">MATCHES </span><span class="s3">&quot;\\$\\(VCInstallDir\\)&quot;</span><span class="s1">) 
<a name="l1745"><span class="ln">1745 </span></a>      </span><span class="s2">set</span><span class="s1">(_verbatim </span><span class="s3">&quot;&quot;</span><span class="s1">) 
<a name="l1746"><span class="ln">1746 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1747"><span class="ln">1747 </span></a></span>
<a name="l1748"><span class="ln">1748 </span></a>    <span class="s2">if </span><span class="s1">(do_obj_build_rule) 
<a name="l1749"><span class="ln">1749 </span></a>      </span><span class="s2">add_custom_command</span><span class="s1">( 
<a name="l1750"><span class="ln">1750 </span></a>        OUTPUT </span><span class="s2">${output_file}</span>
<a name="l1751"><span class="ln">1751 </span></a>        <span class="s5">DEPENDS </span><span class="s2">${object_files}</span>
<a name="l1752"><span class="ln">1752 </span></a>        <span class="s2">COMMAND ${CUDA_NVCC_EXECUTABLE} ${nvcc_flags} </span><span class="s1">-dlink </span><span class="s2">${object_files} </span><span class="s1">-o </span><span class="s2">${output_file}</span>
<a name="l1753"><span class="ln">1753 </span></a>        <span class="s2">${flags}</span>
<a name="l1754"><span class="ln">1754 </span></a>        <span class="s2">COMMENT </span><span class="s3">&quot;Building NVCC intermediate link file ${output_file_relative_path}&quot;</span>
<a name="l1755"><span class="ln">1755 </span></a>        <span class="s1">COMMAND_EXPAND_LISTS 
<a name="l1756"><span class="ln">1756 </span></a>        </span><span class="s2">${_verbatim}</span>
<a name="l1757"><span class="ln">1757 </span></a>        <span class="s1">) 
<a name="l1758"><span class="ln">1758 </span></a>    </span><span class="s2">else</span><span class="s1">() 
<a name="l1759"><span class="ln">1759 </span></a>      </span><span class="s2">get_filename_component</span><span class="s1">(output_file_dir </span><span class="s3">&quot;${output_file}&quot; </span><span class="s1">DIRECTORY) 
<a name="l1760"><span class="ln">1760 </span></a>      </span><span class="s2">add_custom_command</span><span class="s1">( 
<a name="l1761"><span class="ln">1761 </span></a>        </span><span class="s2">TARGET ${cuda_target}</span>
<a name="l1762"><span class="ln">1762 </span></a>        <span class="s1">PRE_LINK 
<a name="l1763"><span class="ln">1763 </span></a>        </span><span class="s2">COMMAND ${CMAKE_COMMAND} </span><span class="s1">-E echo </span><span class="s3">&quot;Building NVCC intermediate link file ${output_file_relative_path}&quot;</span>
<a name="l1764"><span class="ln">1764 </span></a>        <span class="s2">COMMAND ${CMAKE_COMMAND} </span><span class="s1">-E make_directory </span><span class="s3">&quot;${output_file_dir}&quot;</span>
<a name="l1765"><span class="ln">1765 </span></a>        <span class="s2">COMMAND ${CUDA_NVCC_EXECUTABLE} ${nvcc_flags} ${flags} </span><span class="s1">-dlink </span><span class="s2">${object_files} </span><span class="s1">-o </span><span class="s3">&quot;${output_file}&quot;</span>
<a name="l1766"><span class="ln">1766 </span></a>        <span class="s1">COMMAND_EXPAND_LISTS 
<a name="l1767"><span class="ln">1767 </span></a>        </span><span class="s2">${_verbatim}</span>
<a name="l1768"><span class="ln">1768 </span></a>        <span class="s1">) 
<a name="l1769"><span class="ln">1769 </span></a>    </span><span class="s2">endif</span><span class="s1">() 
<a name="l1770"><span class="ln">1770 </span></a> </span><span class="s2">endif</span><span class="s1">() 
<a name="l1771"><span class="ln">1771 </span></a></span><span class="s2">endfunction</span><span class="s1">() 
<a name="l1772"><span class="ln">1772 </span></a></span>
<a name="l1773"><span class="ln">1773 </span></a><span class="s0">###############################################################################</span>
<a name="l1774"><span class="ln">1774 </span></a><span class="s0">###############################################################################</span>
<a name="l1775"><span class="ln">1775 </span></a><span class="s0"># ADD LIBRARY</span>
<a name="l1776"><span class="ln">1776 </span></a><span class="s0">###############################################################################</span>
<a name="l1777"><span class="ln">1777 </span></a><span class="s0">###############################################################################</span>
<a name="l1778"><span class="ln">1778 </span></a><span class="s2">macro</span><span class="s1">(CUDA_ADD_LIBRARY cuda_target) 
<a name="l1779"><span class="ln">1779 </span></a></span>
<a name="l1780"><span class="ln">1780 </span></a>  <span class="s1">CUDA_ADD_CUDA_INCLUDE_ONCE() 
<a name="l1781"><span class="ln">1781 </span></a></span>
<a name="l1782"><span class="ln">1782 </span></a>  <span class="s0"># Separate the sources from the options</span>
<a name="l1783"><span class="ln">1783 </span></a>  <span class="s1">CUDA_GET_SOURCES_AND_OPTIONS(_sources _cmake_options _options </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1784"><span class="ln">1784 </span></a>  CUDA_BUILD_SHARED_LIBRARY(_cuda_shared_flag </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1785"><span class="ln">1785 </span></a>  </span><span class="s0"># Create custom commands and targets for each file.</span>
<a name="l1786"><span class="ln">1786 </span></a>  <span class="s1">CUDA_WRAP_SRCS( </span><span class="s2">${cuda_target} </span><span class="s1">OBJ _generated_files </span><span class="s2">${_sources}</span>
<a name="l1787"><span class="ln">1787 </span></a>    <span class="s2">${_cmake_options} ${_cuda_shared_flag}</span>
<a name="l1788"><span class="ln">1788 </span></a>    <span class="s1">OPTIONS </span><span class="s2">${_options} </span><span class="s1">) 
<a name="l1789"><span class="ln">1789 </span></a></span>
<a name="l1790"><span class="ln">1790 </span></a>  <span class="s0"># Compute the file name of the intermedate link file used for separable</span>
<a name="l1791"><span class="ln">1791 </span></a>  <span class="s0"># compilation.</span>
<a name="l1792"><span class="ln">1792 </span></a>  <span class="s1">CUDA_COMPUTE_SEPARABLE_COMPILATION_OBJECT_FILE_NAME(link_file </span><span class="s2">${cuda_target} </span><span class="s3">&quot;${${cuda_target}_SEPARABLE_COMPILATION_OBJECTS}&quot;</span><span class="s1">) 
<a name="l1793"><span class="ln">1793 </span></a></span>
<a name="l1794"><span class="ln">1794 </span></a>  <span class="s0"># Add the library.</span>
<a name="l1795"><span class="ln">1795 </span></a>  <span class="s2">add_library</span><span class="s1">(</span><span class="s2">${cuda_target} ${_cmake_options}</span>
<a name="l1796"><span class="ln">1796 </span></a>    <span class="s2">${_generated_files}</span>
<a name="l1797"><span class="ln">1797 </span></a>    <span class="s2">${_sources}</span>
<a name="l1798"><span class="ln">1798 </span></a>    <span class="s2">${link_file}</span>
<a name="l1799"><span class="ln">1799 </span></a>    <span class="s1">) 
<a name="l1800"><span class="ln">1800 </span></a></span>
<a name="l1801"><span class="ln">1801 </span></a>  <span class="s0"># Add a link phase for the separable compilation if it has been enabled.  If</span>
<a name="l1802"><span class="ln">1802 </span></a>  <span class="s0"># it has been enabled then the ${cuda_target}_SEPARABLE_COMPILATION_OBJECTS</span>
<a name="l1803"><span class="ln">1803 </span></a>  <span class="s0"># variable will have been defined.</span>
<a name="l1804"><span class="ln">1804 </span></a>  <span class="s1">CUDA_LINK_SEPARABLE_COMPILATION_OBJECTS(</span><span class="s3">&quot;${link_file}&quot; </span><span class="s2">${cuda_target} </span><span class="s3">&quot;${_options}&quot; &quot;${${cuda_target}_SEPARABLE_COMPILATION_OBJECTS}&quot;</span><span class="s1">) 
<a name="l1805"><span class="ln">1805 </span></a></span>
<a name="l1806"><span class="ln">1806 </span></a>  <span class="s2">target_link_libraries</span><span class="s1">(</span><span class="s2">${cuda_target} ${CUDA_LINK_LIBRARIES_KEYWORD}</span>
<a name="l1807"><span class="ln">1807 </span></a>    <span class="s2">${CUDA_LIBRARIES}</span>
<a name="l1808"><span class="ln">1808 </span></a>    <span class="s1">) 
<a name="l1809"><span class="ln">1809 </span></a></span>
<a name="l1810"><span class="ln">1810 </span></a>  <span class="s2">if</span><span class="s1">(CUDA_SEPARABLE_COMPILATION) 
<a name="l1811"><span class="ln">1811 </span></a>    </span><span class="s2">target_link_libraries</span><span class="s1">(</span><span class="s2">${cuda_target} ${CUDA_LINK_LIBRARIES_KEYWORD}</span>
<a name="l1812"><span class="ln">1812 </span></a>      <span class="s2">${CUDA_cudadevrt_LIBRARY}</span>
<a name="l1813"><span class="ln">1813 </span></a>      <span class="s1">) 
<a name="l1814"><span class="ln">1814 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1815"><span class="ln">1815 </span></a></span>
<a name="l1816"><span class="ln">1816 </span></a>  <span class="s0"># We need to set the linker language based on what the expected generated file</span>
<a name="l1817"><span class="ln">1817 </span></a>  <span class="s0"># would be. CUDA_C_OR_CXX is computed based on CUDA_HOST_COMPILATION_CPP.</span>
<a name="l1818"><span class="ln">1818 </span></a>  <span class="s2">set_target_properties</span><span class="s1">(</span><span class="s2">${cuda_target}</span>
<a name="l1819"><span class="ln">1819 </span></a>    <span class="s1">PROPERTIES 
<a name="l1820"><span class="ln">1820 </span></a>    </span><span class="s5">LINKER_LANGUAGE </span><span class="s2">${CUDA_C_OR_CXX}</span>
<a name="l1821"><span class="ln">1821 </span></a>    <span class="s1">) 
<a name="l1822"><span class="ln">1822 </span></a></span>
<a name="l1823"><span class="ln">1823 </span></a><span class="s2">endmacro</span><span class="s1">() 
<a name="l1824"><span class="ln">1824 </span></a></span>
<a name="l1825"><span class="ln">1825 </span></a>
<a name="l1826"><span class="ln">1826 </span></a><span class="s0">###############################################################################</span>
<a name="l1827"><span class="ln">1827 </span></a><span class="s0">###############################################################################</span>
<a name="l1828"><span class="ln">1828 </span></a><span class="s0"># ADD EXECUTABLE</span>
<a name="l1829"><span class="ln">1829 </span></a><span class="s0">###############################################################################</span>
<a name="l1830"><span class="ln">1830 </span></a><span class="s0">###############################################################################</span>
<a name="l1831"><span class="ln">1831 </span></a><span class="s2">macro</span><span class="s1">(CUDA_ADD_EXECUTABLE cuda_target) 
<a name="l1832"><span class="ln">1832 </span></a></span>
<a name="l1833"><span class="ln">1833 </span></a>  <span class="s1">CUDA_ADD_CUDA_INCLUDE_ONCE() 
<a name="l1834"><span class="ln">1834 </span></a></span>
<a name="l1835"><span class="ln">1835 </span></a>  <span class="s0"># Separate the sources from the options</span>
<a name="l1836"><span class="ln">1836 </span></a>  <span class="s1">CUDA_GET_SOURCES_AND_OPTIONS(_sources _cmake_options _options </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1837"><span class="ln">1837 </span></a>  </span><span class="s0"># Create custom commands and targets for each file.</span>
<a name="l1838"><span class="ln">1838 </span></a>  <span class="s1">CUDA_WRAP_SRCS( </span><span class="s2">${cuda_target} </span><span class="s1">OBJ _generated_files </span><span class="s2">${_sources} </span><span class="s1">OPTIONS </span><span class="s2">${_options} </span><span class="s1">) 
<a name="l1839"><span class="ln">1839 </span></a></span>
<a name="l1840"><span class="ln">1840 </span></a>  <span class="s0"># Compute the file name of the intermedate link file used for separable</span>
<a name="l1841"><span class="ln">1841 </span></a>  <span class="s0"># compilation.</span>
<a name="l1842"><span class="ln">1842 </span></a>  <span class="s1">CUDA_COMPUTE_SEPARABLE_COMPILATION_OBJECT_FILE_NAME(link_file </span><span class="s2">${cuda_target} </span><span class="s3">&quot;${${cuda_target}_SEPARABLE_COMPILATION_OBJECTS}&quot;</span><span class="s1">) 
<a name="l1843"><span class="ln">1843 </span></a></span>
<a name="l1844"><span class="ln">1844 </span></a>  <span class="s0"># Add the library.</span>
<a name="l1845"><span class="ln">1845 </span></a>  <span class="s2">add_executable</span><span class="s1">(</span><span class="s2">${cuda_target} ${_cmake_options}</span>
<a name="l1846"><span class="ln">1846 </span></a>    <span class="s2">${_generated_files}</span>
<a name="l1847"><span class="ln">1847 </span></a>    <span class="s2">${_sources}</span>
<a name="l1848"><span class="ln">1848 </span></a>    <span class="s2">${link_file}</span>
<a name="l1849"><span class="ln">1849 </span></a>    <span class="s1">) 
<a name="l1850"><span class="ln">1850 </span></a></span>
<a name="l1851"><span class="ln">1851 </span></a>  <span class="s0"># Add a link phase for the separable compilation if it has been enabled.  If</span>
<a name="l1852"><span class="ln">1852 </span></a>  <span class="s0"># it has been enabled then the ${cuda_target}_SEPARABLE_COMPILATION_OBJECTS</span>
<a name="l1853"><span class="ln">1853 </span></a>  <span class="s0"># variable will have been defined.</span>
<a name="l1854"><span class="ln">1854 </span></a>  <span class="s1">CUDA_LINK_SEPARABLE_COMPILATION_OBJECTS(</span><span class="s3">&quot;${link_file}&quot; </span><span class="s2">${cuda_target} </span><span class="s3">&quot;${_options}&quot; &quot;${${cuda_target}_SEPARABLE_COMPILATION_OBJECTS}&quot;</span><span class="s1">) 
<a name="l1855"><span class="ln">1855 </span></a></span>
<a name="l1856"><span class="ln">1856 </span></a>  <span class="s2">target_link_libraries</span><span class="s1">(</span><span class="s2">${cuda_target} ${CUDA_LINK_LIBRARIES_KEYWORD}</span>
<a name="l1857"><span class="ln">1857 </span></a>    <span class="s2">${CUDA_LIBRARIES}</span>
<a name="l1858"><span class="ln">1858 </span></a>    <span class="s1">) 
<a name="l1859"><span class="ln">1859 </span></a></span>
<a name="l1860"><span class="ln">1860 </span></a>  <span class="s0"># We need to set the linker language based on what the expected generated file</span>
<a name="l1861"><span class="ln">1861 </span></a>  <span class="s0"># would be. CUDA_C_OR_CXX is computed based on CUDA_HOST_COMPILATION_CPP.</span>
<a name="l1862"><span class="ln">1862 </span></a>  <span class="s2">set_target_properties</span><span class="s1">(</span><span class="s2">${cuda_target}</span>
<a name="l1863"><span class="ln">1863 </span></a>    <span class="s1">PROPERTIES 
<a name="l1864"><span class="ln">1864 </span></a>    </span><span class="s5">LINKER_LANGUAGE </span><span class="s2">${CUDA_C_OR_CXX}</span>
<a name="l1865"><span class="ln">1865 </span></a>    <span class="s1">) 
<a name="l1866"><span class="ln">1866 </span></a></span>
<a name="l1867"><span class="ln">1867 </span></a><span class="s2">endmacro</span><span class="s1">() 
<a name="l1868"><span class="ln">1868 </span></a></span>
<a name="l1869"><span class="ln">1869 </span></a>
<a name="l1870"><span class="ln">1870 </span></a><span class="s0">###############################################################################</span>
<a name="l1871"><span class="ln">1871 </span></a><span class="s0">###############################################################################</span>
<a name="l1872"><span class="ln">1872 </span></a><span class="s0"># (Internal) helper for manually added cuda source files with specific targets</span>
<a name="l1873"><span class="ln">1873 </span></a><span class="s0">###############################################################################</span>
<a name="l1874"><span class="ln">1874 </span></a><span class="s0">###############################################################################</span>
<a name="l1875"><span class="ln">1875 </span></a><span class="s2">macro</span><span class="s1">(cuda_compile_base cuda_target format generated_files) 
<a name="l1876"><span class="ln">1876 </span></a>  </span><span class="s0"># Update a counter in this directory, to keep phony target names unique.</span>
<a name="l1877"><span class="ln">1877 </span></a>  <span class="s2">set</span><span class="s1">(_cuda_target </span><span class="s3">&quot;${cuda_target}&quot;</span><span class="s1">) 
<a name="l1878"><span class="ln">1878 </span></a>  </span><span class="s2">get_property</span><span class="s1">(_counter DIRECTORY PROPERTY _cuda_internal_phony_counter) 
<a name="l1879"><span class="ln">1879 </span></a>  </span><span class="s2">if</span><span class="s1">(_counter) 
<a name="l1880"><span class="ln">1880 </span></a>    </span><span class="s2">math</span><span class="s1">(EXPR _counter </span><span class="s3">&quot;${_counter} + 1&quot;</span><span class="s1">) 
<a name="l1881"><span class="ln">1881 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1882"><span class="ln">1882 </span></a>    </span><span class="s2">set</span><span class="s1">(_counter 1) 
<a name="l1883"><span class="ln">1883 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1884"><span class="ln">1884 </span></a>  </span><span class="s2">string</span><span class="s1">(APPEND _cuda_target </span><span class="s3">&quot;_${_counter}&quot;</span><span class="s1">) 
<a name="l1885"><span class="ln">1885 </span></a>  </span><span class="s2">set_property</span><span class="s1">(DIRECTORY PROPERTY _cuda_internal_phony_counter </span><span class="s2">${_counter}</span><span class="s1">) 
<a name="l1886"><span class="ln">1886 </span></a></span>
<a name="l1887"><span class="ln">1887 </span></a>  <span class="s0"># Separate the sources from the options</span>
<a name="l1888"><span class="ln">1888 </span></a>  <span class="s1">CUDA_GET_SOURCES_AND_OPTIONS(_sources _cmake_options _options </span><span class="s2">${ARGN}</span><span class="s1">) 
<a name="l1889"><span class="ln">1889 </span></a></span>
<a name="l1890"><span class="ln">1890 </span></a>  <span class="s0"># Create custom commands and targets for each file.</span>
<a name="l1891"><span class="ln">1891 </span></a>  <span class="s1">CUDA_WRAP_SRCS( </span><span class="s2">${_cuda_target} ${format} </span><span class="s1">_generated_files </span><span class="s2">${_sources}</span>
<a name="l1892"><span class="ln">1892 </span></a>                  <span class="s2">${_cmake_options} </span><span class="s1">OPTIONS </span><span class="s2">${_options} </span><span class="s1">PHONY) 
<a name="l1893"><span class="ln">1893 </span></a></span>
<a name="l1894"><span class="ln">1894 </span></a>  <span class="s2">set</span><span class="s1">( </span><span class="s2">${generated_files} ${_generated_files}</span><span class="s1">) 
<a name="l1895"><span class="ln">1895 </span></a></span>
<a name="l1896"><span class="ln">1896 </span></a><span class="s2">endmacro</span><span class="s1">() 
<a name="l1897"><span class="ln">1897 </span></a></span>
<a name="l1898"><span class="ln">1898 </span></a><span class="s0">###############################################################################</span>
<a name="l1899"><span class="ln">1899 </span></a><span class="s0">###############################################################################</span>
<a name="l1900"><span class="ln">1900 </span></a><span class="s0"># CUDA COMPILE</span>
<a name="l1901"><span class="ln">1901 </span></a><span class="s0">###############################################################################</span>
<a name="l1902"><span class="ln">1902 </span></a><span class="s0">###############################################################################</span>
<a name="l1903"><span class="ln">1903 </span></a><span class="s2">macro</span><span class="s1">(CUDA_COMPILE generated_files) 
<a name="l1904"><span class="ln">1904 </span></a>  cuda_compile_base(cuda_compile OBJ </span><span class="s2">${generated_files} ${ARGN}</span><span class="s1">) 
<a name="l1905"><span class="ln">1905 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1906"><span class="ln">1906 </span></a></span>
<a name="l1907"><span class="ln">1907 </span></a><span class="s0">###############################################################################</span>
<a name="l1908"><span class="ln">1908 </span></a><span class="s0">###############################################################################</span>
<a name="l1909"><span class="ln">1909 </span></a><span class="s0"># CUDA COMPILE PTX</span>
<a name="l1910"><span class="ln">1910 </span></a><span class="s0">###############################################################################</span>
<a name="l1911"><span class="ln">1911 </span></a><span class="s0">###############################################################################</span>
<a name="l1912"><span class="ln">1912 </span></a><span class="s2">macro</span><span class="s1">(CUDA_COMPILE_PTX generated_files) 
<a name="l1913"><span class="ln">1913 </span></a>  cuda_compile_base(cuda_compile_ptx PTX </span><span class="s2">${generated_files} ${ARGN}</span><span class="s1">) 
<a name="l1914"><span class="ln">1914 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1915"><span class="ln">1915 </span></a></span>
<a name="l1916"><span class="ln">1916 </span></a><span class="s0">###############################################################################</span>
<a name="l1917"><span class="ln">1917 </span></a><span class="s0">###############################################################################</span>
<a name="l1918"><span class="ln">1918 </span></a><span class="s0"># CUDA COMPILE FATBIN</span>
<a name="l1919"><span class="ln">1919 </span></a><span class="s0">###############################################################################</span>
<a name="l1920"><span class="ln">1920 </span></a><span class="s0">###############################################################################</span>
<a name="l1921"><span class="ln">1921 </span></a><span class="s2">macro</span><span class="s1">(CUDA_COMPILE_FATBIN generated_files) 
<a name="l1922"><span class="ln">1922 </span></a>  cuda_compile_base(cuda_compile_fatbin FATBIN </span><span class="s2">${generated_files} ${ARGN}</span><span class="s1">) 
<a name="l1923"><span class="ln">1923 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1924"><span class="ln">1924 </span></a></span>
<a name="l1925"><span class="ln">1925 </span></a><span class="s0">###############################################################################</span>
<a name="l1926"><span class="ln">1926 </span></a><span class="s0">###############################################################################</span>
<a name="l1927"><span class="ln">1927 </span></a><span class="s0"># CUDA COMPILE CUBIN</span>
<a name="l1928"><span class="ln">1928 </span></a><span class="s0">###############################################################################</span>
<a name="l1929"><span class="ln">1929 </span></a><span class="s0">###############################################################################</span>
<a name="l1930"><span class="ln">1930 </span></a><span class="s2">macro</span><span class="s1">(CUDA_COMPILE_CUBIN generated_files) 
<a name="l1931"><span class="ln">1931 </span></a>  cuda_compile_base(cuda_compile_cubin CUBIN </span><span class="s2">${generated_files} ${ARGN}</span><span class="s1">) 
<a name="l1932"><span class="ln">1932 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1933"><span class="ln">1933 </span></a></span>
<a name="l1934"><span class="ln">1934 </span></a>
<a name="l1935"><span class="ln">1935 </span></a><span class="s0">###############################################################################</span>
<a name="l1936"><span class="ln">1936 </span></a><span class="s0">###############################################################################</span>
<a name="l1937"><span class="ln">1937 </span></a><span class="s0"># CUDA ADD CUFFT TO TARGET</span>
<a name="l1938"><span class="ln">1938 </span></a><span class="s0">###############################################################################</span>
<a name="l1939"><span class="ln">1939 </span></a><span class="s0">###############################################################################</span>
<a name="l1940"><span class="ln">1940 </span></a><span class="s2">macro</span><span class="s1">(CUDA_ADD_CUFFT_TO_TARGET </span><span class="s2">target</span><span class="s1">) 
<a name="l1941"><span class="ln">1941 </span></a>  </span><span class="s2">if </span><span class="s1">(CUDA_BUILD_EMULATION) 
<a name="l1942"><span class="ln">1942 </span></a>    </span><span class="s2">target_link_libraries</span><span class="s1">(</span><span class="s2">${target} ${CUDA_LINK_LIBRARIES_KEYWORD} ${CUDA_cufftemu_LIBRARY}</span><span class="s1">) 
<a name="l1943"><span class="ln">1943 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1944"><span class="ln">1944 </span></a>    </span><span class="s2">target_link_libraries</span><span class="s1">(</span><span class="s2">${target} ${CUDA_LINK_LIBRARIES_KEYWORD} ${CUDA_cufft_LIBRARY}</span><span class="s1">) 
<a name="l1945"><span class="ln">1945 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1946"><span class="ln">1946 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1947"><span class="ln">1947 </span></a></span>
<a name="l1948"><span class="ln">1948 </span></a><span class="s0">###############################################################################</span>
<a name="l1949"><span class="ln">1949 </span></a><span class="s0">###############################################################################</span>
<a name="l1950"><span class="ln">1950 </span></a><span class="s0"># CUDA ADD CUBLAS TO TARGET</span>
<a name="l1951"><span class="ln">1951 </span></a><span class="s0">###############################################################################</span>
<a name="l1952"><span class="ln">1952 </span></a><span class="s0">###############################################################################</span>
<a name="l1953"><span class="ln">1953 </span></a><span class="s2">macro</span><span class="s1">(CUDA_ADD_CUBLAS_TO_TARGET </span><span class="s2">target</span><span class="s1">) 
<a name="l1954"><span class="ln">1954 </span></a>  </span><span class="s2">if </span><span class="s1">(CUDA_BUILD_EMULATION) 
<a name="l1955"><span class="ln">1955 </span></a>    </span><span class="s2">target_link_libraries</span><span class="s1">(</span><span class="s2">${target} ${CUDA_LINK_LIBRARIES_KEYWORD} ${CUDA_cublasemu_LIBRARY}</span><span class="s1">) 
<a name="l1956"><span class="ln">1956 </span></a>  </span><span class="s2">else</span><span class="s1">() 
<a name="l1957"><span class="ln">1957 </span></a>    </span><span class="s2">target_link_libraries</span><span class="s1">(</span><span class="s2">${target} ${CUDA_LINK_LIBRARIES_KEYWORD} ${CUDA_cublas_LIBRARY} ${CUDA_cublas_device_LIBRARY} ${CUDA_cublasLt_LIBRARY}</span><span class="s1">) 
<a name="l1958"><span class="ln">1958 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1959"><span class="ln">1959 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1960"><span class="ln">1960 </span></a></span>
<a name="l1961"><span class="ln">1961 </span></a><span class="s0">###############################################################################</span>
<a name="l1962"><span class="ln">1962 </span></a><span class="s0">###############################################################################</span>
<a name="l1963"><span class="ln">1963 </span></a><span class="s0"># CUDA BUILD CLEAN TARGET</span>
<a name="l1964"><span class="ln">1964 </span></a><span class="s0">###############################################################################</span>
<a name="l1965"><span class="ln">1965 </span></a><span class="s0">###############################################################################</span>
<a name="l1966"><span class="ln">1966 </span></a><span class="s2">macro</span><span class="s1">(CUDA_BUILD_CLEAN_TARGET) 
<a name="l1967"><span class="ln">1967 </span></a>  </span><span class="s0"># Call this after you add all your CUDA targets, and you will get a</span>
<a name="l1968"><span class="ln">1968 </span></a>  <span class="s0"># convenience target.  You should also make clean after running this target</span>
<a name="l1969"><span class="ln">1969 </span></a>  <span class="s0"># to get the build system to generate all the code again.</span>
<a name="l1970"><span class="ln">1970 </span></a>
<a name="l1971"><span class="ln">1971 </span></a>  <span class="s2">set</span><span class="s1">(cuda_clean_target_name clean_cuda_depends) 
<a name="l1972"><span class="ln">1972 </span></a>  </span><span class="s2">if </span><span class="s1">(</span><span class="s4">CMAKE_GENERATOR </span><span class="s2">MATCHES </span><span class="s3">&quot;Visual Studio&quot;</span><span class="s1">) 
<a name="l1973"><span class="ln">1973 </span></a>    </span><span class="s2">string</span><span class="s1">(TOUPPER </span><span class="s2">${cuda_clean_target_name} </span><span class="s1">cuda_clean_target_name) 
<a name="l1974"><span class="ln">1974 </span></a>  </span><span class="s2">endif</span><span class="s1">() 
<a name="l1975"><span class="ln">1975 </span></a>  </span><span class="s2">add_custom_target</span><span class="s1">(</span><span class="s2">${cuda_clean_target_name}</span>
<a name="l1976"><span class="ln">1976 </span></a>    <span class="s2">COMMAND ${CMAKE_COMMAND} </span><span class="s1">-E remove </span><span class="s2">${CUDA_ADDITIONAL_CLEAN_FILES}</span><span class="s1">) 
<a name="l1977"><span class="ln">1977 </span></a></span>
<a name="l1978"><span class="ln">1978 </span></a>  <span class="s0"># Clear out the variable, so the next time we configure it will be empty.</span>
<a name="l1979"><span class="ln">1979 </span></a>  <span class="s0"># This is useful so that the files won't persist in the list after targets</span>
<a name="l1980"><span class="ln">1980 </span></a>  <span class="s0"># have been removed.</span>
<a name="l1981"><span class="ln">1981 </span></a>  <span class="s2">set</span><span class="s1">(CUDA_ADDITIONAL_CLEAN_FILES </span><span class="s3">&quot;&quot; </span><span class="s2">CACHE INTERNAL </span><span class="s3">&quot;List of intermediate files that are part of the cuda dependency scanning.&quot;</span><span class="s1">) 
<a name="l1982"><span class="ln">1982 </span></a></span><span class="s2">endmacro</span><span class="s1">() 
<a name="l1983"><span class="ln">1983 </span></a></span></pre>
</body>
</html>